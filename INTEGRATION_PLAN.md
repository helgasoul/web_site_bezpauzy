# ÐŸÐ¾ÑˆÐ°Ð³Ð¾Ð²Ñ‹Ð¹ Ð¿Ð»Ð°Ð½ Ð¸Ð½Ñ‚ÐµÐ³Ñ€Ð°Ñ†Ð¸Ð¸ Ð±Ð¾Ñ‚Ð° Ð¸ ÑÐ°Ð¹Ñ‚Ð°

## Ð¦ÐµÐ»ÑŒ
ÐÐ°ÑÑ‚Ñ€Ð¾Ð¸Ñ‚ÑŒ ÑÐ²ÑÐ·ÑŒ Ð¼ÐµÐ¶Ð´Ñƒ Telegram Ð±Ð¾Ñ‚Ð¾Ð¼ Ð¸ ÑÐ°Ð¹Ñ‚Ð¾Ð¼ Ð´Ð»Ñ:
1. ÐŸÑ€Ð¸Ð²ÑÐ·ÐºÐ¸ Telegram ID Ðº Ð°ÐºÐºÐ°ÑƒÐ½Ñ‚Ñƒ Ð½Ð° ÑÐ°Ð¹Ñ‚Ðµ (ÐºÐ¾Ð³Ð´Ð° Ð¿Ð¾Ð»ÑŒÐ·Ð¾Ð²Ð°Ñ‚ÐµÐ»ÑŒ Ñ€ÐµÐ³Ð¸ÑÑ‚Ñ€Ð¸Ñ€ÑƒÐµÑ‚ÑÑ Ð½Ð° ÑÐ°Ð¹Ñ‚Ðµ Ð¸ Ñ…Ð¾Ñ‡ÐµÑ‚ Ð¾Ð±Ñ‰Ð°Ñ‚ÑŒÑÑ Ñ Ð•Ð²Ð¾Ð¹)
2. ÐžÑ‚Ð¿Ñ€Ð°Ð²ÐºÐ¸ ÑÑÑ‹Ð»ÐºÐ¸ Ð½Ð° ÑÐ°Ð¹Ñ‚ Ð¸Ð· Ð±Ð¾Ñ‚Ð° (ÐºÐ¾Ð³Ð´Ð° Ð¿Ð¾Ð»ÑŒÐ·Ð¾Ð²Ð°Ñ‚ÐµÐ»ÑŒ Ð¸Ð· Ð±Ð¾Ñ‚Ð° Ð¿ÐµÑ€ÐµÑ…Ð¾Ð´Ð¸Ñ‚ Ð½Ð° ÑÐ°Ð¹Ñ‚)

## ÐšÑ€Ð°Ñ‚ÐºÐ°Ñ ÑÐ²Ð¾Ð´ÐºÐ°

**Ð§ÐÐ¡Ð¢Ð¬ 1:** ÐžÐ±Ñ€Ð°Ð±Ð¾Ñ‚ÐºÐ° ÐºÐ¾Ð¼Ð°Ð½Ð´Ñ‹ `/start link_ÐšÐžÐ”` (ÑˆÐ°Ð³Ð¸ 1-10)
- Ð”Ð¾Ð±Ð°Ð²Ð¸Ñ‚ÑŒ Ð¿Ñ€Ð¾Ð²ÐµÑ€ÐºÑƒ Ð¿Ð°Ñ€Ð°Ð¼ÐµÑ‚Ñ€Ð° `link_` Ð² ÐºÐ¾Ð¼Ð°Ð½Ð´Ðµ `/start`
- Ð˜Ð·Ð²Ð»ÐµÑ‡ÑŒ ÐºÐ¾Ð´ Ð¸Ð· ÐºÐ¾Ð¼Ð°Ð½Ð´Ñ‹
- ÐÐ°Ð¹Ñ‚Ð¸ ÐºÐ¾Ð´ Ð² Ð‘Ð” Ð¸ Ð¿Ñ€Ð¾Ð²ÐµÑ€Ð¸Ñ‚ÑŒ ÐµÐ³Ð¾ Ð²Ð°Ð»Ð¸Ð´Ð½Ð¾ÑÑ‚ÑŒ
- ÐžÐ±Ð½Ð¾Ð²Ð¸Ñ‚ÑŒ `telegram_id` Ð² ÐºÐ¾Ð´Ðµ Ð¸ Ð² Ñ‚Ð°Ð±Ð»Ð¸Ñ†Ðµ Ð¿Ð¾Ð»ÑŒÐ·Ð¾Ð²Ð°Ñ‚ÐµÐ»ÐµÐ¹
- ÐžÑ‚Ð¿Ñ€Ð°Ð²Ð¸Ñ‚ÑŒ ÑÐ¾Ð¾Ð±Ñ‰ÐµÐ½Ð¸Ðµ Ð¾Ð± ÑƒÑÐ¿ÐµÑ…Ðµ Ð¸Ð»Ð¸ Ð¾ÑˆÐ¸Ð±ÐºÐµ

**Ð§ÐÐ¡Ð¢Ð¬ 2:** ÐžÑ‚Ð¿Ñ€Ð°Ð²ÐºÐ° ÑÑÑ‹Ð»ÐºÐ¸ Ð½Ð° ÑÐ°Ð¹Ñ‚ Ð¸Ð· Ð±Ð¾Ñ‚Ð° (ÑˆÐ°Ð³Ð¸ 11-13)
- Ð“ÐµÐ½ÐµÑ€Ð¸Ñ€Ð¾Ð²Ð°Ñ‚ÑŒ ÑÑÑ‹Ð»ÐºÑƒ Ñ `tg_id` Ð¿Ð¾ÑÐ»Ðµ Ð¾Ñ‚Ð²ÐµÑ‚Ð° AI Agent
- Ð”Ð¾Ð±Ð°Ð²Ð¸Ñ‚ÑŒ ÑÑÑ‹Ð»ÐºÑƒ Ð² ÑÐ¾Ð¾Ð±Ñ‰ÐµÐ½Ð¸Ðµ Ð±Ð¾Ñ‚Ð°
- Ð”Ð¾Ð±Ð°Ð²Ð¸Ñ‚ÑŒ ÐºÐ½Ð¾Ð¿ÐºÑƒ "ÐžÑ‚ÐºÑ€Ñ‹Ñ‚ÑŒ ÑÐ°Ð¹Ñ‚"

---

## Ð§ÐÐ¡Ð¢Ð¬ 1: ÐžÐ±Ñ€Ð°Ð±Ð¾Ñ‚ÐºÐ° ÐºÐ¾Ð¼Ð°Ð½Ð´Ñ‹ `/start link_ÐšÐžÐ”` Ð´Ð»Ñ Ð¿Ñ€Ð¸Ð²ÑÐ·ÐºÐ¸ Ð°ÐºÐºÐ°ÑƒÐ½Ñ‚Ð°

### Ð¨ÐÐ“ 1: Ð”Ð¾Ð±Ð°Ð²Ð¸Ñ‚ÑŒ ÑƒÐ·ÐµÐ» "If" Ð´Ð»Ñ Ð¿Ñ€Ð¾Ð²ÐµÑ€ÐºÐ¸ Ð¿Ð°Ñ€Ð°Ð¼ÐµÑ‚Ñ€Ð° `link_`

**Ð“Ð´Ðµ:** ÐŸÐ¾ÑÐ»Ðµ ÑƒÐ·Ð»Ð° "If" (id: `c1f92bf0-af49-45b4-9313-e03920eb8ccd`), ÐºÐ¾Ñ‚Ð¾Ñ€Ñ‹Ð¹ Ð¿Ñ€Ð¾Ð²ÐµÑ€ÑÐµÑ‚ `/start`

**Ð§Ñ‚Ð¾ Ð´ÐµÐ»Ð°Ñ‚ÑŒ:**
1. ÐÐ°Ð¹Ð´Ð¸Ñ‚Ðµ ÑƒÐ·ÐµÐ» **"If"** (Ð¿Ð¾Ð·Ð¸Ñ†Ð¸Ñ: 896, 1216)
2. ÐŸÐ¾ÑÐ»Ðµ Ð½ÐµÐ³Ð¾ (Ð½Ð° Ð²Ñ‹Ñ…Ð¾Ð´Ðµ TRUE) Ð´Ð¾Ð±Ð°Ð²ÑŒÑ‚Ðµ Ð½Ð¾Ð²Ñ‹Ð¹ ÑƒÐ·ÐµÐ» **"If"**
3. ÐÐ°Ð·Ð¾Ð²Ð¸Ñ‚Ðµ ÐµÐ³Ð¾: **"If link_code"**

**ÐŸÐ°Ñ€Ð°Ð¼ÐµÑ‚Ñ€Ñ‹ Ð½Ð¾Ð²Ð¾Ð³Ð¾ ÑƒÐ·Ð»Ð° "If link_code":**

**Ð’ÐºÐ»Ð°Ð´ÐºÐ° "Parameters":**

1. **Ð¡ÐµÐºÑ†Ð¸Ñ "Conditions":**
   - **Ð ÐµÐ¶Ð¸Ð¼:** Ð’Ñ‹Ð±ÐµÑ€Ð¸Ñ‚Ðµ **"Expression"** (Ð¸Ð»Ð¸ "Fixed" ÐµÑÐ»Ð¸ Expression Ð½Ðµ Ñ€Ð°Ð±Ð¾Ñ‚Ð°ÐµÑ‚)
   
   - **Ð£ÑÐ»Ð¾Ð²Ð¸Ðµ 1:**
     - **Left Value (Ð—Ð½Ð°Ñ‡ÐµÐ½Ð¸Ðµ ÑÐ»ÐµÐ²Ð°):**
       ```
       {{ $('Telegram Trigger').item.json.message.text }}
       ```
       (ÐÐ°Ð¶Ð¼Ð¸Ñ‚Ðµ Ð½Ð° Ð¸ÐºÐ¾Ð½ÐºÑƒ "T" ÑÐ¿Ñ€Ð°Ð²Ð° Ð¾Ñ‚ Ð¿Ð¾Ð»Ñ, Ñ‡Ñ‚Ð¾Ð±Ñ‹ Ð¿ÐµÑ€ÐµÐºÐ»ÑŽÑ‡Ð¸Ñ‚ÑŒÑÑ Ð² Ñ€ÐµÐ¶Ð¸Ð¼ Ð²Ñ‹Ñ€Ð°Ð¶ÐµÐ½Ð¸Ñ)
     
     - **Operator (ÐžÐ¿ÐµÑ€Ð°Ñ‚Ð¾Ñ€):**
       Ð’Ñ‹Ð±ÐµÑ€Ð¸Ñ‚Ðµ Ð¸Ð· Ð²Ñ‹Ð¿Ð°Ð´Ð°ÑŽÑ‰ÐµÐ³Ð¾ ÑÐ¿Ð¸ÑÐºÐ°: **"contains"** (ÑÐ¾Ð´ÐµÑ€Ð¶Ð¸Ñ‚)
     
     - **Right Value (Ð—Ð½Ð°Ñ‡ÐµÐ½Ð¸Ðµ ÑÐ¿Ñ€Ð°Ð²Ð°):**
       ```
       link_
       ```
       (Ð¿Ñ€Ð¾ÑÑ‚Ð¾ Ñ‚ÐµÐºÑÑ‚ `link_` Ð±ÐµÐ· ÐºÐ°Ð²Ñ‹Ñ‡ÐµÐº)
   
   - **Combinator:** ÐžÑÑ‚Ð°Ð²ÑŒÑ‚Ðµ **"and"** (Ð¿Ð¾ ÑƒÐ¼Ð¾Ð»Ñ‡Ð°Ð½Ð¸ÑŽ)

2. **Ð¡ÐµÐºÑ†Ð¸Ñ "Convert types where required":**
   - Ð’ÐºÐ»ÑŽÑ‡Ð¸Ñ‚Ðµ Ð¿ÐµÑ€ÐµÐºÐ»ÑŽÑ‡Ð°Ñ‚ÐµÐ»ÑŒ (ÐµÑÐ»Ð¸ Ð´Ð¾ÑÑ‚ÑƒÐ¿ÐµÐ½)

3. **Ð¡ÐµÐºÑ†Ð¸Ñ "Options":**
   - ÐžÑÑ‚Ð°Ð²ÑŒÑ‚Ðµ Ð¿Ð¾ ÑƒÐ¼Ð¾Ð»Ñ‡Ð°Ð½Ð¸ÑŽ

**ÐŸÑ€Ð¾Ð²ÐµÑ€ÐºÐ°:**
- ÐÐ°Ð¶Ð¼Ð¸Ñ‚Ðµ **"Execute step"** (ÐºÑ€Ð°ÑÐ½Ð°Ñ ÐºÐ½Ð¾Ð¿ÐºÐ° Ð²Ð²ÐµÑ€Ñ…Ñƒ)
- ÐŸÑ€Ð¾Ð²ÐµÑ€ÑŒÑ‚Ðµ OUTPUT:
  - ÐšÐ¾Ð¼Ð°Ð½Ð´Ð° `/start link_ABC123` â†’ Ð´Ð¾Ð»Ð¶Ð½Ð¾ Ð±Ñ‹Ñ‚ÑŒ **TRUE**
  - ÐšÐ¾Ð¼Ð°Ð½Ð´Ð° `/start` â†’ Ð´Ð¾Ð»Ð¶Ð½Ð¾ Ð±Ñ‹Ñ‚ÑŒ **FALSE**

**Ð¡Ð¾ÐµÐ´Ð¸Ð½ÐµÐ½Ð¸Ñ:**
- Ð’Ñ…Ð¾Ð´: Ð¾Ñ‚ ÑƒÐ·Ð»Ð° **"If"** (Ð²Ñ‹Ñ…Ð¾Ð´ TRUE - ÐºÐ¾Ð³Ð´Ð° `/start` Ð½Ð°Ð¹Ð´ÐµÐ½)
- Ð’Ñ‹Ñ…Ð¾Ð´ TRUE: Ð±ÑƒÐ´ÐµÑ‚ Ð¸ÑÐ¿Ð¾Ð»ÑŒÐ·Ð¾Ð²Ð°Ð½ Ð´Ð»Ñ Ð¾Ð±Ñ€Ð°Ð±Ð¾Ñ‚ÐºÐ¸ Ð¿Ñ€Ð¸Ð²ÑÐ·ÐºÐ¸ (ÑˆÐ°Ð³ 2)
- Ð’Ñ‹Ñ…Ð¾Ð´ FALSE: Ð±ÑƒÐ´ÐµÑ‚ Ð¸ÑÐ¿Ð¾Ð»ÑŒÐ·Ð¾Ð²Ð°Ð½ Ð´Ð»Ñ Ð¾Ð±Ñ‹Ñ‡Ð½Ð¾Ð³Ð¾ Ð¿Ñ€Ð¸Ð²ÐµÑ‚ÑÑ‚Ð²Ð¸Ñ (ÑˆÐ°Ð³ 3)

---

### Ð¨ÐÐ“ 2: Ð”Ð¾Ð±Ð°Ð²Ð¸Ñ‚ÑŒ ÑƒÐ·ÐµÐ» "Code" Ð´Ð»Ñ Ð¸Ð·Ð²Ð»ÐµÑ‡ÐµÐ½Ð¸Ñ ÐºÐ¾Ð´Ð°

**Ð“Ð´Ðµ:** ÐŸÐ¾ÑÐ»Ðµ ÑƒÐ·Ð»Ð° "If link_code" (Ð²Ñ‹Ñ…Ð¾Ð´ TRUE)

**Ð§Ñ‚Ð¾ Ð´ÐµÐ»Ð°Ñ‚ÑŒ:**
1. Ð”Ð¾Ð±Ð°Ð²ÑŒÑ‚Ðµ ÑƒÐ·ÐµÐ» **"Code"**
2. ÐÐ°Ð·Ð¾Ð²Ð¸Ñ‚Ðµ ÐµÐ³Ð¾: **"Extract link code"**

**ÐŸÐ°Ñ€Ð°Ð¼ÐµÑ‚Ñ€Ñ‹ ÑƒÐ·Ð»Ð° "Code":**
- **Type:** `n8n-nodes-base.code`
- **Language:** JavaScript
- **Code:**
```javascript
// Ð˜Ð·Ð²Ð»ÐµÐºÐ°ÐµÐ¼ ÐºÐ¾Ð´ Ð¸Ð· ÐºÐ¾Ð¼Ð°Ð½Ð´Ñ‹ /start link_ÐšÐžÐ”
const messageText = $('Telegram Trigger').first().json.message.text || '';
const telegramId = $('Telegram Trigger').first().json.message.from.id;

// ÐŸÑ€Ð¾Ð²ÐµÑ€ÑÐµÐ¼ Ñ„Ð¾Ñ€Ð¼Ð°Ñ‚: /start link_ÐšÐžÐ” (Ð¼Ð¾Ð¶ÐµÑ‚ Ð±Ñ‹Ñ‚ÑŒ Ñ Ð¿Ñ€Ð¾Ð±ÐµÐ»Ð¾Ð¼ Ð¸Ð»Ð¸ Ð±ÐµÐ·)
const linkMatch = messageText.match(/\/start\s+link_([A-Z0-9]{6})/i);

if (!linkMatch || !linkMatch[1]) {
  return [{
      message_text: messageText
    }
  }];
}

const code = linkMatch[1].toUpperCase();

return [{
  json: {
    code: code,
    telegram_id: telegramId,
    user_id: null // Ð‘ÑƒÐ´ÐµÑ‚ Ð·Ð°Ð¿Ð¾Ð»Ð½ÐµÐ½Ð¾ Ð¸Ð· Ð‘Ð”
  }
}];    json: {
      error: 'Invalid link code format',
      telegram_id: telegramId,

```

**Ð¡Ð¾ÐµÐ´Ð¸Ð½ÐµÐ½Ð¸Ñ:**
- Ð’Ñ…Ð¾Ð´: Ð¾Ñ‚ ÑƒÐ·Ð»Ð° **"If link_code"** (Ð²Ñ‹Ñ…Ð¾Ð´ TRUE)

---

### Ð¨ÐÐ“ 3: Ð”Ð¾Ð±Ð°Ð²Ð¸Ñ‚ÑŒ ÑƒÐ·ÐµÐ» "Supabase" Ð´Ð»Ñ Ð¿Ð¾Ð¸ÑÐºÐ° ÐºÐ¾Ð´Ð° Ð² Ð‘Ð”

**Ð“Ð´Ðµ:** ÐŸÐ¾ÑÐ»Ðµ ÑƒÐ·Ð»Ð° "Extract link code"

**Ð§Ñ‚Ð¾ Ð´ÐµÐ»Ð°Ñ‚ÑŒ:**
1. Ð”Ð¾Ð±Ð°Ð²ÑŒÑ‚Ðµ ÑƒÐ·ÐµÐ» **"Supabase"**
2. ÐÐ°Ð·Ð¾Ð²Ð¸Ñ‚Ðµ ÐµÐ³Ð¾: **"Get link code from DB"**

**ÐŸÐ°Ñ€Ð°Ð¼ÐµÑ‚Ñ€Ñ‹ ÑƒÐ·Ð»Ð° "Supabase":**
- **Type:** `n8n-nodes-base.supabase`
- **Operation:** `getAll`
- **Table:** `menohub_telegram_auth_codes`
- **Filter Type:** `manual`
- **Filters (Conditions):**
  - **Condition 1:**
    - **Key Name:** `code`
    - **Condition:** `equals`
    - **Key Value:** `={{ $json.code }}`
  - **Condition 2:**
    - **Key Name:** `used`
    - **Condition:** `equals`
    - **Key Value:** `false`
  - **Condition 3:**
    - **Key Name:** `expires_at`
    - **Condition:** `greater than`
    - **Key Value:** `={{ $now }}`
- **Return All:** `false`
- **Limit:** `1`
- **Always Output Data:** `true`

**Ð’Ð°Ð¶Ð½Ð¾:** Ð’ n8n Supabase ÑƒÐ·ÐµÐ» Ð¼Ð¾Ð¶ÐµÑ‚ Ñ‚Ñ€ÐµÐ±Ð¾Ð²Ð°Ñ‚ÑŒ Ð´Ñ€ÑƒÐ³Ð¾Ð¹ ÑÐ¸Ð½Ñ‚Ð°ÐºÑÐ¸Ñ Ð´Ð»Ñ Ñ„Ð¸Ð»ÑŒÑ‚Ñ€Ð¾Ð². Ð•ÑÐ»Ð¸ Ð½Ðµ Ñ€Ð°Ð±Ð¾Ñ‚Ð°ÐµÑ‚, Ð¿Ð¾Ð¿Ñ€Ð¾Ð±ÑƒÐ¹Ñ‚Ðµ:
- **Filter Type:** `string`
- **Filter String:** `code=eq.{{ $json.code }}&used=eq.false&expires_at=gt.{{ $now }}`

**Ð¡Ð¾ÐµÐ´Ð¸Ð½ÐµÐ½Ð¸Ñ:**
- Ð’Ñ…Ð¾Ð´: Ð¾Ñ‚ ÑƒÐ·Ð»Ð° **"Extract link code"**

---

### Ð¨ÐÐ“ 4: Ð”Ð¾Ð±Ð°Ð²Ð¸Ñ‚ÑŒ ÑƒÐ·ÐµÐ» "If" Ð´Ð»Ñ Ð¿Ñ€Ð¾Ð²ÐµÑ€ÐºÐ¸ Ð½Ð°Ð¹Ð´ÐµÐ½ Ð»Ð¸ ÐºÐ¾Ð´

**Ð“Ð´Ðµ:** ÐŸÐ¾ÑÐ»Ðµ ÑƒÐ·Ð»Ð° "Get link code from DB"

**Ð§Ñ‚Ð¾ Ð´ÐµÐ»Ð°Ñ‚ÑŒ:**
1. Ð”Ð¾Ð±Ð°Ð²ÑŒÑ‚Ðµ ÑƒÐ·ÐµÐ» **"If"**
2. ÐÐ°Ð·Ð¾Ð²Ð¸Ñ‚Ðµ ÐµÐ³Ð¾: **"If code found"**

**ÐŸÐ°Ñ€Ð°Ð¼ÐµÑ‚Ñ€Ñ‹ ÑƒÐ·Ð»Ð° "If":**
- **Type:** `n8n-nodes-base.if`
- **Conditions:**
  - **Left Value:** `={{ $json.id }}`
  - **Operator:** `exists`
  - **Single Value:** `true`
  - **Case Sensitive:** `true`
  - **Type Validation:** `strict`

**Ð¡Ð¾ÐµÐ´Ð¸Ð½ÐµÐ½Ð¸Ñ:**
- Ð’Ñ…Ð¾Ð´: Ð¾Ñ‚ ÑƒÐ·Ð»Ð° **"Get link code from DB"**
- Ð’Ñ‹Ñ…Ð¾Ð´ TRUE: ÐºÐ¾Ð´ Ð½Ð°Ð¹Ð´ÐµÐ½, Ð¿Ñ€Ð¾Ð´Ð¾Ð»Ð¶Ð°ÐµÐ¼ Ð¿Ñ€Ð¸Ð²ÑÐ·ÐºÑƒ (ÑˆÐ°Ð³ 5)
- Ð’Ñ‹Ñ…Ð¾Ð´ FALSE: ÐºÐ¾Ð´ Ð½Ðµ Ð½Ð°Ð¹Ð´ÐµÐ½, Ð¾Ñ‚Ð¿Ñ€Ð°Ð²Ð»ÑÐµÐ¼ ÑÐ¾Ð¾Ð±Ñ‰ÐµÐ½Ð¸Ðµ Ð¾Ð± Ð¾ÑˆÐ¸Ð±ÐºÐµ (ÑˆÐ°Ð³ 6)

---

### Ð¨ÐÐ“ 5: Ð”Ð¾Ð±Ð°Ð²Ð¸Ñ‚ÑŒ ÑƒÐ·ÐµÐ» "Supabase" Ð´Ð»Ñ Ð¾Ð±Ð½Ð¾Ð²Ð»ÐµÐ½Ð¸Ñ ÐºÐ¾Ð´Ð° Ñ telegram_id

**Ð“Ð´Ðµ:** ÐŸÐ¾ÑÐ»Ðµ ÑƒÐ·Ð»Ð° "If code found" (Ð²Ñ‹Ñ…Ð¾Ð´ TRUE)

**Ð§Ñ‚Ð¾ Ð´ÐµÐ»Ð°Ñ‚ÑŒ:**
1. Ð”Ð¾Ð±Ð°Ð²ÑŒÑ‚Ðµ ÑƒÐ·ÐµÐ» **"Supabase"**
2. ÐÐ°Ð·Ð¾Ð²Ð¸Ñ‚Ðµ ÐµÐ³Ð¾: **"Update code with telegram_id"**

**ÐŸÐ°Ñ€Ð°Ð¼ÐµÑ‚Ñ€Ñ‹ ÑƒÐ·Ð»Ð° "Supabase":**
- **Type:** `n8n-nodes-base.supabase`
- **Operation:** `update`
- **Table:** `menohub_telegram_auth_codes`
- **Filters:**
  - **Key Name:** `id`
  - **Condition:** `equals`
  - **Key Value:** `={{ $json.id }}`
- **Fields (Field Values):**
  - **Field 1:**
    - **Field ID:** `telegram_id`
    - **Field Value:** `={{ $('Extract link code').item.json.telegram_id }}`
  - **Field 2:**
    - **Field ID:** `used`
    - **Field Value:** `true`

**Ð’Ð°Ð¶Ð½Ð¾:** Ð˜ÑÐ¿Ð¾Ð»ÑŒÐ·ÑƒÐ¹Ñ‚Ðµ Ð´Ð°Ð½Ð½Ñ‹Ðµ Ð¸Ð· ÑƒÐ·Ð»Ð° "Get link code from DB", Ð° Ð½Ðµ Ð¸Ð· "Extract link code" Ð´Ð»Ñ Ð¿Ð¾Ð»ÑƒÑ‡ÐµÐ½Ð¸Ñ `id` ÐºÐ¾Ð´Ð°:
- **Key Value (Ð´Ð»Ñ Ñ„Ð¸Ð»ÑŒÑ‚Ñ€Ð°):** `={{ $json.id }}` (Ð¸Ð· ÑƒÐ·Ð»Ð° "Get link code from DB")

**Ð¡Ð¾ÐµÐ´Ð¸Ð½ÐµÐ½Ð¸Ñ:**
- Ð’Ñ…Ð¾Ð´: Ð¾Ñ‚ ÑƒÐ·Ð»Ð° **"If code found"** (Ð²Ñ‹Ñ…Ð¾Ð´ TRUE)

---

### Ð¨ÐÐ“ 6: Ð”Ð¾Ð±Ð°Ð²Ð¸Ñ‚ÑŒ ÑƒÐ·ÐµÐ» "Supabase" Ð´Ð»Ñ Ð¾Ð±Ð½Ð¾Ð²Ð»ÐµÐ½Ð¸Ñ Ð¿Ð¾Ð»ÑŒÐ·Ð¾Ð²Ð°Ñ‚ÐµÐ»Ñ

**Ð“Ð´Ðµ:** ÐŸÐ¾ÑÐ»Ðµ ÑƒÐ·Ð»Ð° "Update code with telegram_id"

**Ð§Ñ‚Ð¾ Ð´ÐµÐ»Ð°Ñ‚ÑŒ:**
1. Ð”Ð¾Ð±Ð°Ð²ÑŒÑ‚Ðµ ÑƒÐ·ÐµÐ» **"Supabase"**
2. ÐÐ°Ð·Ð¾Ð²Ð¸Ñ‚Ðµ ÐµÐ³Ð¾: **"Update user telegram_id"`

**ÐŸÐ°Ñ€Ð°Ð¼ÐµÑ‚Ñ€Ñ‹ ÑƒÐ·Ð»Ð° "Supabase":**
- **Type:** `n8n-nodes-base.supabase`
- **Operation:** `update`
- **Table:** `menohub_users`
- **Filters:**
  - **Key Name:** `id`
  - **Condition:** `equals`
  - **Key Value:** `={{ $json.user_id }}`
- **Fields (Field Values):**
  - **Field:**
    - **Field ID:** `telegram_id`
    - **Field Value:** `={{ $('Extract link code').item.json.telegram_id }}`

**Ð’Ð°Ð¶Ð½Ð¾:** Ð˜ÑÐ¿Ð¾Ð»ÑŒÐ·ÑƒÐ¹Ñ‚Ðµ `user_id` Ð¸Ð· ÑƒÐ·Ð»Ð° "Get link code from DB":
- **Key Value (Ð´Ð»Ñ Ñ„Ð¸Ð»ÑŒÑ‚Ñ€Ð°):** `={{ $('Get link code from DB').item.json.user_id }}`

**Ð¡Ð¾ÐµÐ´Ð¸Ð½ÐµÐ½Ð¸Ñ:**
- Ð’Ñ…Ð¾Ð´: Ð¾Ñ‚ ÑƒÐ·Ð»Ð° **"Update code with telegram_id"`

---

### Ð¨ÐÐ“ 7: Ð”Ð¾Ð±Ð°Ð²Ð¸Ñ‚ÑŒ ÑƒÐ·ÐµÐ» "Code" Ð´Ð»Ñ Ð³ÐµÐ½ÐµÑ€Ð°Ñ†Ð¸Ð¸ ÑÑÑ‹Ð»ÐºÐ¸ Ð½Ð° ÑÐ°Ð¹Ñ‚

**Ð“Ð´Ðµ:** ÐŸÐ¾ÑÐ»Ðµ ÑƒÐ·Ð»Ð° "Update user telegram_id"

**Ð§Ñ‚Ð¾ Ð´ÐµÐ»Ð°Ñ‚ÑŒ:**
1. Ð”Ð¾Ð±Ð°Ð²ÑŒÑ‚Ðµ ÑƒÐ·ÐµÐ» **"Code"**
2. ÐÐ°Ð·Ð¾Ð²Ð¸Ñ‚Ðµ ÐµÐ³Ð¾: **"Generate website link for success"**

**ÐŸÐ°Ñ€Ð°Ð¼ÐµÑ‚Ñ€Ñ‹ ÑƒÐ·Ð»Ð° "Code":**
- **Type:** `n8n-nodes-base.code`
- **Language:** JavaScript
- **Code:**
```javascript
const telegramId = $('Extract link code').item.json.telegram_id;
const baseUrl = 'https://bezpauzy.com'; // Ð—Ð°Ð¼ÐµÐ½Ð¸Ñ‚Ðµ Ð½Ð° Ð²Ð°Ñˆ Ð´Ð¾Ð¼ÐµÐ½

// Ð“ÐµÐ½ÐµÑ€Ð¸Ñ€ÑƒÐµÐ¼ ÑÑÑ‹Ð»ÐºÑƒ Ñ telegram_id Ð´Ð»Ñ Ð°Ð²Ñ‚Ð¾Ð¼Ð°Ñ‚Ð¸Ñ‡ÐµÑÐºÐ¾Ð³Ð¾ Ð²Ñ…Ð¾Ð´Ð°
const websiteLink = `${baseUrl}?tg_id=${telegramId}`;

return [{
  json: {
    ...$input.first().json,
    website_link: websiteLink,
    telegram_id: telegramId
  }
}];
```

**Ð¡Ð¾ÐµÐ´Ð¸Ð½ÐµÐ½Ð¸Ñ:**
- Ð’Ñ…Ð¾Ð´: Ð¾Ñ‚ ÑƒÐ·Ð»Ð° **"Update user telegram_id"**

---

### Ð¨ÐÐ“ 7.1: Ð”Ð¾Ð±Ð°Ð²Ð¸Ñ‚ÑŒ ÑƒÐ·ÐµÐ» "Telegram" Ð´Ð»Ñ Ð¾Ñ‚Ð¿Ñ€Ð°Ð²ÐºÐ¸ ÑÐ¾Ð¾Ð±Ñ‰ÐµÐ½Ð¸Ñ Ð¾Ð± ÑƒÑÐ¿ÐµÑ…Ðµ

**Ð“Ð´Ðµ:** ÐŸÐ¾ÑÐ»Ðµ ÑƒÐ·Ð»Ð° "Generate website link for success"

**Ð§Ñ‚Ð¾ Ð´ÐµÐ»Ð°Ñ‚ÑŒ:**
1. Ð”Ð¾Ð±Ð°Ð²ÑŒÑ‚Ðµ ÑƒÐ·ÐµÐ» **"Telegram"**
2. ÐÐ°Ð·Ð¾Ð²Ð¸Ñ‚Ðµ ÐµÐ³Ð¾: **"Send success message"**

**ÐŸÐ°Ñ€Ð°Ð¼ÐµÑ‚Ñ€Ñ‹ ÑƒÐ·Ð»Ð° "Telegram":**
- **Type:** `n8n-nodes-base.telegram`
- **Operation:** `sendMessage`
- **Chat ID:** `={{ $('Telegram Trigger').item.json.message.chat.id }}`
- **Text:**
```
âœ… ÐÐºÐºÐ°ÑƒÐ½Ñ‚ ÑƒÑÐ¿ÐµÑˆÐ½Ð¾ Ð¿Ñ€Ð¸Ð²ÑÐ·Ð°Ð½!

Ð’Ð°Ñˆ Telegram ID Ñ‚ÐµÐ¿ÐµÑ€ÑŒ ÑÐ²ÑÐ·Ð°Ð½ Ñ Ð°ÐºÐºÐ°ÑƒÐ½Ñ‚Ð¾Ð¼ Ð½Ð° ÑÐ°Ð¹Ñ‚Ðµ. Ð’Ñ‹ Ð¼Ð¾Ð¶ÐµÑ‚Ðµ:
â€¢ ÐžÐ±Ñ‰Ð°Ñ‚ÑŒÑÑ Ñ Ð•Ð²Ð¾Ð¹ Ð½Ð° ÑÐ°Ð¹Ñ‚Ðµ
â€¢ Ð¡Ð¾Ñ…Ñ€Ð°Ð½ÑÑ‚ÑŒ Ñ€ÐµÐ·ÑƒÐ»ÑŒÑ‚Ð°Ñ‚Ñ‹ ÐºÐ²Ð¸Ð·Ð¾Ð²
â€¢ ÐŸÐ¾Ð»ÑƒÑ‡Ð¸Ñ‚ÑŒ Ð´Ð¾ÑÑ‚ÑƒÐ¿ Ð² ÐºÐ¾Ð¼Ð¼ÑŒÑŽÐ½Ð¸Ñ‚Ð¸
```
- **Reply Markup:** `inlineKeyboard`
- **Inline Keyboard:**
  - **Row 1:**
    - **Button 1:**
      - **Text:** `ðŸŒ Ð’ÐµÑ€Ð½ÑƒÑ‚ÑŒÑÑ Ð½Ð° ÑÐ°Ð¹Ñ‚`
      - **Additional Fields:**
        - **URL:** `={{ $json.website_link }}`
- **Additional Fields:**
  - **Parse Mode:** `HTML`
  - **Append Attribution:** `false`

**Ð¡Ð¾ÐµÐ´Ð¸Ð½ÐµÐ½Ð¸Ñ:**
- Ð’Ñ…Ð¾Ð´: Ð¾Ñ‚ ÑƒÐ·Ð»Ð° **"Update user telegram_id"**

---

### Ð¨ÐÐ“ 8: Ð”Ð¾Ð±Ð°Ð²Ð¸Ñ‚ÑŒ ÑƒÐ·ÐµÐ» "Telegram" Ð´Ð»Ñ Ð¾Ñ‚Ð¿Ñ€Ð°Ð²ÐºÐ¸ ÑÐ¾Ð¾Ð±Ñ‰ÐµÐ½Ð¸Ñ Ð¾Ð± Ð¾ÑˆÐ¸Ð±ÐºÐµ

**Ð“Ð´Ðµ:** ÐŸÐ¾ÑÐ»Ðµ ÑƒÐ·Ð»Ð° "If code found" (Ð²Ñ‹Ñ…Ð¾Ð´ FALSE)

**Ð§Ñ‚Ð¾ Ð´ÐµÐ»Ð°Ñ‚ÑŒ:**
1. Ð”Ð¾Ð±Ð°Ð²ÑŒÑ‚Ðµ ÑƒÐ·ÐµÐ» **"Telegram"**
2. ÐÐ°Ð·Ð¾Ð²Ð¸Ñ‚Ðµ ÐµÐ³Ð¾: **"Send error message"`

**ÐŸÐ°Ñ€Ð°Ð¼ÐµÑ‚Ñ€Ñ‹ ÑƒÐ·Ð»Ð° "Telegram":**
- **Type:** `n8n-nodes-base.telegram`
- **Operation:** `sendMessage`
- **Chat ID:** `={{ $('Telegram Trigger').item.json.message.chat.id }}`
- **Text:**
```
âŒ ÐšÐ¾Ð´ Ð¿Ñ€Ð¸Ð²ÑÐ·ÐºÐ¸ Ð½Ðµ Ð½Ð°Ð¹Ð´ÐµÐ½ Ð¸Ð»Ð¸ Ð¸ÑÑ‚ÐµÐº

Ð’Ð¾Ð·Ð¼Ð¾Ð¶Ð½Ñ‹Ðµ Ð¿Ñ€Ð¸Ñ‡Ð¸Ð½Ñ‹:
â€¢ ÐšÐ¾Ð´ ÑƒÐ¶Ðµ Ð¸ÑÐ¿Ð¾Ð»ÑŒÐ·Ð¾Ð²Ð°Ð½
â€¢ ÐšÐ¾Ð´ Ð¸ÑÑ‚ÐµÐº (Ð´ÐµÐ¹ÑÑ‚Ð²Ð¸Ñ‚ÐµÐ»ÐµÐ½ 10 Ð¼Ð¸Ð½ÑƒÑ‚)
â€¢ ÐÐµÐ²ÐµÑ€Ð½Ñ‹Ð¹ Ñ„Ð¾Ñ€Ð¼Ð°Ñ‚ ÐºÐ¾Ð´Ð°

ÐŸÐ¾Ð¶Ð°Ð»ÑƒÐ¹ÑÑ‚Ð°, ÑÐ³ÐµÐ½ÐµÑ€Ð¸Ñ€ÑƒÐ¹Ñ‚Ðµ Ð½Ð¾Ð²Ñ‹Ð¹ ÐºÐ¾Ð´ Ð½Ð° ÑÐ°Ð¹Ñ‚Ðµ.
```
- **Additional Fields:**
  - **Parse Mode:** `HTML`
  - **Append Attribution:** `false`

**Ð¡Ð¾ÐµÐ´Ð¸Ð½ÐµÐ½Ð¸Ñ:**
- Ð’Ñ…Ð¾Ð´: Ð¾Ñ‚ ÑƒÐ·Ð»Ð° **"If code found"** (Ð²Ñ‹Ñ…Ð¾Ð´ FALSE)

---

### Ð¨ÐÐ“ 9: ÐžÐ±Ð½Ð¾Ð²Ð¸Ñ‚ÑŒ ÑÐ¾ÐµÐ´Ð¸Ð½ÐµÐ½Ð¸Ñ ÑƒÐ·Ð»Ð° "If" (Ð½Ð°Ñ‡Ð°Ð»ÑŒÐ½Ñ‹Ð¹)

**Ð“Ð´Ðµ:** Ð£Ð·ÐµÐ» "If" (id: `c1f92bf0-af49-45b4-9313-e03920eb8ccd`)

**Ð§Ñ‚Ð¾ Ð´ÐµÐ»Ð°Ñ‚ÑŒ:**
1. ÐÐ°Ð¹Ð´Ð¸Ñ‚Ðµ ÑƒÐ·ÐµÐ» **"If"** (Ð¿Ñ€Ð¾Ð²ÐµÑ€ÑÐµÑ‚ `/start`)
2. Ð˜Ð·Ð¼ÐµÐ½Ð¸Ñ‚Ðµ ÑÐ¾ÐµÐ´Ð¸Ð½ÐµÐ½Ð¸Ñ:
   - **Ð’Ñ‹Ñ…Ð¾Ð´ TRUE:** Ð¿Ð¾Ð´ÐºÐ»ÑŽÑ‡Ð¸Ñ‚Ðµ Ðº ÑƒÐ·Ð»Ñƒ **"If link_code"** (Ð½Ð¾Ð²Ñ‹Ð¹ ÑƒÐ·ÐµÐ» Ð¸Ð· ÑˆÐ°Ð³Ð° 1)
   - **Ð’Ñ‹Ñ…Ð¾Ð´ FALSE:** Ð¾ÑÑ‚Ð°Ð²ÑŒÑ‚Ðµ ÐºÐ°Ðº ÐµÑÑ‚ÑŒ (Ð¸Ð»Ð¸ Ð¿Ð¾Ð´ÐºÐ»ÑŽÑ‡Ð¸Ñ‚Ðµ Ðº ÑÑƒÑ‰ÐµÑÑ‚Ð²ÑƒÑŽÑ‰ÐµÐ¼Ñƒ flow)

---

### Ð¨ÐÐ“ 10: ÐžÐ±Ð½Ð¾Ð²Ð¸Ñ‚ÑŒ ÑÐ¾ÐµÐ´Ð¸Ð½ÐµÐ½Ð¸Ñ ÑƒÐ·Ð»Ð° "If link_code"

**Ð“Ð´Ðµ:** Ð£Ð·ÐµÐ» "If link_code" (Ð½Ð¾Ð²Ñ‹Ð¹ ÑƒÐ·ÐµÐ» Ð¸Ð· ÑˆÐ°Ð³Ð° 1)

**Ð§Ñ‚Ð¾ Ð´ÐµÐ»Ð°Ñ‚ÑŒ:**
1. ÐÐ°Ð¹Ð´Ð¸Ñ‚Ðµ ÑƒÐ·ÐµÐ» **"If link_code"**
2. ÐÐ°ÑÑ‚Ñ€Ð¾Ð¹Ñ‚Ðµ ÑÐ¾ÐµÐ´Ð¸Ð½ÐµÐ½Ð¸Ñ:
   - **Ð’Ñ‹Ñ…Ð¾Ð´ TRUE:** Ð¿Ð¾Ð´ÐºÐ»ÑŽÑ‡Ð¸Ñ‚Ðµ Ðº ÑƒÐ·Ð»Ñƒ **"Extract link code"** (ÑˆÐ°Ð³ 2)
   - **Ð’Ñ‹Ñ…Ð¾Ð´ FALSE:** Ð¿Ð¾Ð´ÐºÐ»ÑŽÑ‡Ð¸Ñ‚Ðµ Ðº ÑƒÐ·Ð»Ñƒ **"Send a text message"** (ÑÑƒÑ‰ÐµÑÑ‚Ð²ÑƒÑŽÑ‰Ð¸Ð¹ ÑƒÐ·ÐµÐ» Ñ Ð¿Ñ€Ð¸Ð²ÐµÑ‚ÑÑ‚Ð²Ð¸ÐµÐ¼, id: `0abe787f-55da-4bc2-878a-c23c2b75741a`)

---

## Ð§ÐÐ¡Ð¢Ð¬ 2: ÐžÑ‚Ð¿Ñ€Ð°Ð²ÐºÐ° ÑÑÑ‹Ð»ÐºÐ¸ Ð½Ð° ÑÐ°Ð¹Ñ‚ Ð¸Ð· Ð±Ð¾Ñ‚Ð° (Flow 3)

### Ð¨ÐÐ“ 11: Ð”Ð¾Ð±Ð°Ð²Ð¸Ñ‚ÑŒ ÑƒÐ·ÐµÐ» "Code" Ð´Ð»Ñ Ð³ÐµÐ½ÐµÑ€Ð°Ñ†Ð¸Ð¸ ÑÑÑ‹Ð»ÐºÐ¸ Ð½Ð° ÑÐ°Ð¹Ñ‚

**Ð“Ð´Ðµ:** ÐŸÐ¾ÑÐ»Ðµ ÑƒÐ·Ð»Ð° "Code" (id: `fdb61a7b-f196-4903-a5d9-feb97d74ba93`), ÐºÐ¾Ñ‚Ð¾Ñ€Ñ‹Ð¹ Ñ€Ð°Ð·Ð±Ð¸Ð²Ð°ÐµÑ‚ Ð¾Ñ‚Ð²ÐµÑ‚ Ð½Ð° Ñ‡Ð°ÑÑ‚Ð¸, Ð½Ð¾ ÐŸÐ•Ð Ð•Ð” ÑƒÐ·Ð»Ð¾Ð¼ "Send a text message4"

**Ð§Ñ‚Ð¾ Ð´ÐµÐ»Ð°Ñ‚ÑŒ:**
1. ÐÐ°Ð¹Ð´Ð¸Ñ‚Ðµ ÑƒÐ·ÐµÐ» **"Code"** (id: `fdb61a7b-f196-4903-a5d9-feb97d74ba93`, Ð¿Ð¾Ð·Ð¸Ñ†Ð¸Ñ: 5344, 928)
2. ÐŸÐ¾ÑÐ»Ðµ Ð½ÐµÐ³Ð¾ Ð´Ð¾Ð±Ð°Ð²ÑŒÑ‚Ðµ Ð½Ð¾Ð²Ñ‹Ð¹ ÑƒÐ·ÐµÐ» **"Code"**
3. ÐÐ°Ð·Ð¾Ð²Ð¸Ñ‚Ðµ ÐµÐ³Ð¾: **"Generate website link"`

**ÐŸÐ°Ñ€Ð°Ð¼ÐµÑ‚Ñ€Ñ‹ ÑƒÐ·Ð»Ð° "Code":**
- **Type:** `n8n-nodes-base.code`
- **Language:** JavaScript
- **Code:**
```javascript
const telegramId = $('Telegram Trigger').first().json.message.from.id;
const baseUrl = 'https://bezpauzy.com'; // Ð—Ð°Ð¼ÐµÐ½Ð¸Ñ‚Ðµ Ð½Ð° Ð²Ð°Ñˆ Ð´Ð¾Ð¼ÐµÐ½

// Ð“ÐµÐ½ÐµÑ€Ð¸Ñ€ÑƒÐµÐ¼ ÑÑÑ‹Ð»ÐºÑƒ Ñ telegram_id
const websiteLink = `${baseUrl}?tg_id=${telegramId}`;

return [{
  json: {
    ...$input.first().json,
    website_link: websiteLink,
    telegram_id: telegramId
  }
}];
```

**Ð¡Ð¾ÐµÐ´Ð¸Ð½ÐµÐ½Ð¸Ñ:**
- Ð’Ñ…Ð¾Ð´: Ð¾Ñ‚ ÑƒÐ·Ð»Ð° **"Code"** (id: `fdb61a7b-f196-4903-a5d9-feb97d74ba93`)

---

### Ð¨ÐÐ“ 12: ÐžÐ±Ð½Ð¾Ð²Ð¸Ñ‚ÑŒ ÑƒÐ·ÐµÐ» "Send a text message4" Ð´Ð»Ñ Ð´Ð¾Ð±Ð°Ð²Ð»ÐµÐ½Ð¸Ñ ÑÑÑ‹Ð»ÐºÐ¸

**Ð“Ð´Ðµ:** Ð£Ð·ÐµÐ» "Send a text message4" (id: `a68c2b5b-3453-4ea6-9bbd-15a26f8097e9`, Ð¿Ð¾Ð·Ð¸Ñ†Ð¸Ñ: 5568, 928)

**Ð§Ñ‚Ð¾ Ð´ÐµÐ»Ð°Ñ‚ÑŒ:**
1. ÐÐ°Ð¹Ð´Ð¸Ñ‚Ðµ ÑƒÐ·ÐµÐ» **"Send a text message4"** (Ð¾Ñ‚Ð¿Ñ€Ð°Ð²Ð»ÑÐµÑ‚ Ð¾Ñ‚Ð²ÐµÑ‚ Ð¾Ñ‚ AI Agent)
2. **ÐžÐ¢ÐšÐ›Ð®Ð§Ð˜Ð¢Ð•** ÑÑ‚Ð°Ñ€Ð¾Ðµ ÑÐ¾ÐµÐ´Ð¸Ð½ÐµÐ½Ð¸Ðµ Ð¾Ñ‚ ÑƒÐ·Ð»Ð° "Code" (id: `fdb61a7b-f196-4903-a5d9-feb97d74ba93`)
3. ÐžÐ±Ð½Ð¾Ð²Ð¸Ñ‚Ðµ Ð¿Ð°Ñ€Ð°Ð¼ÐµÑ‚Ñ€ **Text:**
   - Ð—Ð°Ð¼ÐµÐ½Ð¸Ñ‚Ðµ Ñ‚ÐµÐºÑƒÑ‰Ð¸Ð¹ Ñ‚ÐµÐºÑÑ‚ Ð½Ð°:
   ```
   {{ $json.message_text }}
   
   ðŸŒ Ð¥Ð¾Ñ‚Ð¸Ñ‚Ðµ ÑÐ¾Ñ…Ñ€Ð°Ð½Ð¸Ñ‚ÑŒ ÑÑ‚Ð¾Ñ‚ Ð¾Ñ‚Ð²ÐµÑ‚ Ð¸Ð»Ð¸ Ð¿Ð¾ÑÐ¼Ð¾Ñ‚Ñ€ÐµÑ‚ÑŒ Ð¸ÑÑ‚Ð¾Ñ€Ð¸ÑŽ? ÐŸÐµÑ€ÐµÐ¹Ð´Ð¸Ñ‚Ðµ Ð½Ð° ÑÐ°Ð¹Ñ‚: {{ $json.website_link }}
   ```
   - Ð˜Ð»Ð¸ Ð´Ð¾Ð±Ð°Ð²ÑŒÑ‚Ðµ ÑÑÑ‹Ð»ÐºÑƒ Ð² ÐºÐ¾Ð½ÐµÑ† ÑÑƒÑ‰ÐµÑÑ‚Ð²ÑƒÑŽÑ‰ÐµÐ³Ð¾ Ñ‚ÐµÐºÑÑ‚Ð°

**Ð¡Ð¾ÐµÐ´Ð¸Ð½ÐµÐ½Ð¸Ñ:**
- Ð’Ñ…Ð¾Ð´: Ð¾Ñ‚ ÑƒÐ·Ð»Ð° **"Generate website link"** (ÑˆÐ°Ð³ 11) - **ÐÐžÐ’ÐžÐ• ÑÐ¾ÐµÐ´Ð¸Ð½ÐµÐ½Ð¸Ðµ**

---

## Ð§ÐÐ¡Ð¢Ð¬ 3: Ð”Ð¾Ð¿Ð¾Ð»Ð½Ð¸Ñ‚ÐµÐ»ÑŒÐ½Ñ‹Ðµ ÑƒÐ»ÑƒÑ‡ÑˆÐµÐ½Ð¸Ñ

### Ð¨ÐÐ“ 13: Ð”Ð¾Ð±Ð°Ð²Ð¸Ñ‚ÑŒ ÐºÐ½Ð¾Ð¿ÐºÑƒ "ÐžÑ‚ÐºÑ€Ñ‹Ñ‚ÑŒ ÑÐ°Ð¹Ñ‚" Ð² Ð¾Ñ‚Ð²ÐµÑ‚Ð°Ñ… Ð±Ð¾Ñ‚Ð°

**Ð“Ð´Ðµ:** Ð£Ð·ÐµÐ» "Send a text message4" (id: `a68c2b5b-3453-4ea6-9bbd-15a26f8097e9`)

**Ð§Ñ‚Ð¾ Ð´ÐµÐ»Ð°Ñ‚ÑŒ:**
1. ÐÐ°Ð¹Ð´Ð¸Ñ‚Ðµ ÑƒÐ·ÐµÐ» **"Send a text message4"**
2. Ð’ Ð¿Ð°Ñ€Ð°Ð¼ÐµÑ‚Ñ€Ðµ **Reply Markup** â†’ **Inline Keyboard** Ð´Ð¾Ð±Ð°Ð²ÑŒÑ‚Ðµ Ð½Ð¾Ð²ÑƒÑŽ ÑÑ‚Ñ€Ð¾ÐºÑƒ (row):
   - **Button 1:**
     - **Text:** `ðŸŒ ÐžÑ‚ÐºÑ€Ñ‹Ñ‚ÑŒ ÑÐ°Ð¹Ñ‚`
     - **Additional Fields:**
       - **URL:** `={{ $json.website_link }}`

---

## Ð˜Ñ‚Ð¾Ð³Ð¾Ð²Ð°Ñ ÑÑ…ÐµÐ¼Ð° ÑÐ¾ÐµÐ´Ð¸Ð½ÐµÐ½Ð¸Ð¹:

```
Telegram Trigger
    â†“
If (/start Ð¿Ñ€Ð¾Ð²ÐµÑ€ÐºÐ°)
    â”œâ”€ TRUE â†’ If link_code
    â”‚           â”œâ”€ TRUE â†’ Extract link code â†’ Get link code from DB â†’ If code found
    â”‚           â”‚                                                          â”œâ”€ TRUE â†’ Update code â†’ Update user â†’ Generate website link â†’ Send success (Ñ ÐºÐ½Ð¾Ð¿ÐºÐ¾Ð¹)
    â”‚           â”‚                                                          â””â”€ FALSE â†’ Send error
    â”‚           â””â”€ FALSE â†’ Send a text message (Ð¿Ñ€Ð¸Ð²ÐµÑ‚ÑÑ‚Ð²Ð¸Ðµ)
    â””â”€ FALSE â†’ (ÑÑƒÑ‰ÐµÑÑ‚Ð²ÑƒÑŽÑ‰Ð¸Ð¹ flow)
```

---

## Ð’Ð°Ð¶Ð½Ñ‹Ðµ Ð·Ð°Ð¼ÐµÑ‡Ð°Ð½Ð¸Ñ:

1. **Ð”Ð¾Ð¼ÐµÐ½ ÑÐ°Ð¹Ñ‚Ð°:** Ð—Ð°Ð¼ÐµÐ½Ð¸Ñ‚Ðµ `https://bezpauzy.com` Ð½Ð° Ð²Ð°Ñˆ Ñ€ÐµÐ°Ð»ÑŒÐ½Ñ‹Ð¹ Ð´Ð¾Ð¼ÐµÐ½ Ð² ÑˆÐ°Ð³Ðµ 11
2. **ÐŸÑ€Ð¾Ð²ÐµÑ€ÐºÐ° ÐºÐ¾Ð´Ð°:** ÐšÐ¾Ð´ Ð´ÐµÐ¹ÑÑ‚Ð²Ð¸Ñ‚ÐµÐ»ÐµÐ½ 10 Ð¼Ð¸Ð½ÑƒÑ‚ (Ð¿Ñ€Ð¾Ð²ÐµÑ€ÑÐµÑ‚ÑÑ Ð² ÑˆÐ°Ð³Ðµ 3)
3. **Ð‘ÐµÐ·Ð¾Ð¿Ð°ÑÐ½Ð¾ÑÑ‚ÑŒ:** ÐšÐ¾Ð´ Ð¸ÑÐ¿Ð¾Ð»ÑŒÐ·ÑƒÐµÑ‚ÑÑ Ñ‚Ð¾Ð»ÑŒÐºÐ¾ Ð¾Ð´Ð¸Ð½ Ñ€Ð°Ð· (Ð¿Ð¾Ð¼ÐµÑ‡Ð°ÐµÑ‚ÑÑ ÐºÐ°Ðº `used = true`)
4. **ÐžÐ±Ñ€Ð°Ð±Ð¾Ñ‚ÐºÐ° Ð¾ÑˆÐ¸Ð±Ð¾Ðº:** Ð•ÑÐ»Ð¸ ÐºÐ¾Ð´ Ð½Ðµ Ð½Ð°Ð¹Ð´ÐµÐ½, Ð¿Ð¾Ð»ÑŒÐ·Ð¾Ð²Ð°Ñ‚ÐµÐ»ÑŒ Ð¿Ð¾Ð»ÑƒÑ‡Ð°ÐµÑ‚ Ð¿Ð¾Ð½ÑÑ‚Ð½Ð¾Ðµ ÑÐ¾Ð¾Ð±Ñ‰ÐµÐ½Ð¸Ðµ

---

## Ð¢ÐµÑÑ‚Ð¸Ñ€Ð¾Ð²Ð°Ð½Ð¸Ðµ:

1. Ð—Ð°Ñ€ÐµÐ³Ð¸ÑÑ‚Ñ€Ð¸Ñ€ÑƒÐ¹Ñ‚ÐµÑÑŒ Ð½Ð° ÑÐ°Ð¹Ñ‚Ðµ
2. Ð¡Ð³ÐµÐ½ÐµÑ€Ð¸Ñ€ÑƒÐ¹Ñ‚Ðµ ÐºÐ¾Ð´ Ð¿Ñ€Ð¸Ð²ÑÐ·ÐºÐ¸
3. ÐžÑ‚ÐºÑ€Ð¾Ð¹Ñ‚Ðµ Ð±Ð¾Ñ‚Ð° Ñ ÐºÐ¾Ð¼Ð°Ð½Ð´Ð¾Ð¹ `/start link_ÐšÐžÐ”`
4. ÐŸÑ€Ð¾Ð²ÐµÑ€ÑŒÑ‚Ðµ, Ñ‡Ñ‚Ð¾ Ð°ÐºÐºÐ°ÑƒÐ½Ñ‚ Ð¿Ñ€Ð¸Ð²ÑÐ·Ð°Ð½
5. ÐŸÑ€Ð¾Ð²ÐµÑ€ÑŒÑ‚Ðµ Ð¾Ñ‚Ð¿Ñ€Ð°Ð²ÐºÑƒ ÑÑÑ‹Ð»ÐºÐ¸ Ð½Ð° ÑÐ°Ð¹Ñ‚ Ð¸Ð· Ð±Ð¾Ñ‚Ð°

---

## Ð”Ð¾Ð¿Ð¾Ð»Ð½Ð¸Ñ‚ÐµÐ»ÑŒÐ½Ñ‹Ðµ Ð¸Ð½ÑÑ‚Ñ€ÑƒÐºÑ†Ð¸Ð¸ Ð¿Ð¾ Ñ€Ð°Ð±Ð¾Ñ‚Ðµ Ñ n8n:

### ÐšÐ°Ðº Ð¿Ñ€Ð°Ð²Ð¸Ð»ÑŒÐ½Ð¾ ÑÑÑ‹Ð»Ð°Ñ‚ÑŒÑÑ Ð½Ð° Ð´Ð°Ð½Ð½Ñ‹Ðµ Ð¸Ð· Ð¿Ñ€ÐµÐ´Ñ‹Ð´ÑƒÑ‰Ð¸Ñ… ÑƒÐ·Ð»Ð¾Ð²:

Ð’ n8n Ð´Ð»Ñ Ð¿Ð¾Ð»ÑƒÑ‡ÐµÐ½Ð¸Ñ Ð´Ð°Ð½Ð½Ñ‹Ñ… Ð¸Ð· Ð¿Ñ€ÐµÐ´Ñ‹Ð´ÑƒÑ‰ÐµÐ³Ð¾ ÑƒÐ·Ð»Ð° Ð¸ÑÐ¿Ð¾Ð»ÑŒÐ·ÑƒÐ¹Ñ‚Ðµ:
- `$('Ð˜Ð¼Ñ ÑƒÐ·Ð»Ð°').item.json.Ð¿Ð¾Ð»Ðµ` - Ð´Ð»Ñ Ð¿Ð¾Ð»ÑƒÑ‡ÐµÐ½Ð¸Ñ Ð´Ð°Ð½Ð½Ñ‹Ñ… Ð¸Ð· ÐºÐ¾Ð½ÐºÑ€ÐµÑ‚Ð½Ð¾Ð³Ð¾ ÑƒÐ·Ð»Ð°
- `$json.Ð¿Ð¾Ð»Ðµ` - Ð´Ð»Ñ Ð¿Ð¾Ð»ÑƒÑ‡ÐµÐ½Ð¸Ñ Ð´Ð°Ð½Ð½Ñ‹Ñ… Ð¸Ð· Ð¿Ñ€ÐµÐ´Ñ‹Ð´ÑƒÑ‰ÐµÐ³Ð¾ ÑƒÐ·Ð»Ð° (Ñ‚ÐµÐºÑƒÑ‰ÐµÐ³Ð¾ ÐºÐ¾Ð½Ñ‚ÐµÐºÑÑ‚Ð°)

**ÐŸÑ€Ð¸Ð¼ÐµÑ€Ñ‹:**
- `$('Telegram Trigger').item.json.message.from.id` - Telegram ID Ð¸Ð· Ñ‚Ñ€Ð¸Ð³Ð³ÐµÑ€Ð°
- `$('Extract link code').item.json.code` - ÐºÐ¾Ð´ Ð¸Ð· ÑƒÐ·Ð»Ð° Ð¸Ð·Ð²Ð»ÐµÑ‡ÐµÐ½Ð¸Ñ
- `$json.user_id` - user_id Ð¸Ð· Ñ‚ÐµÐºÑƒÑ‰ÐµÐ³Ð¾ ÑƒÐ·Ð»Ð° (ÐµÑÐ»Ð¸ Ð¾Ð½ Ð±Ñ‹Ð» Ð² Ð¿Ñ€ÐµÐ´Ñ‹Ð´ÑƒÑ‰ÐµÐ¼)

### ÐŸÑ€Ð¾Ð²ÐµÑ€ÐºÐ° ÑÐ¾ÐµÐ´Ð¸Ð½ÐµÐ½Ð¸Ð¹:

ÐŸÐµÑ€ÐµÐ´ Ð¸Ð·Ð¼ÐµÐ½ÐµÐ½Ð¸ÐµÐ¼ ÑÐ¾ÐµÐ´Ð¸Ð½ÐµÐ½Ð¸Ð¹:
1. **Ð¡Ð¾Ñ…Ñ€Ð°Ð½Ð¸Ñ‚Ðµ Ñ‚ÐµÐºÑƒÑ‰Ð¸Ð¹ workflow** (ÑÐºÑÐ¿Ð¾Ñ€Ñ‚ Ð¸Ð»Ð¸ ÐºÐ¾Ð¿Ð¸Ñ)
2. **ÐŸÑ€Ð¾Ð²ÐµÑ€ÑŒÑ‚Ðµ**, ÐºÐ°ÐºÐ¸Ðµ ÑƒÐ·Ð»Ñ‹ Ð¿Ð¾Ð´ÐºÐ»ÑŽÑ‡ÐµÐ½Ñ‹ Ðº ÑƒÐ·Ð»Ñƒ "If" ÑÐµÐ¹Ñ‡Ð°Ñ
3. **ÐžÑ‚ÐºÐ»ÑŽÑ‡Ð¸Ñ‚Ðµ** ÑÑ‚Ð°Ñ€Ð¾Ðµ ÑÐ¾ÐµÐ´Ð¸Ð½ÐµÐ½Ð¸Ðµ Ð¿ÐµÑ€ÐµÐ´ Ð¿Ð¾Ð´ÐºÐ»ÑŽÑ‡ÐµÐ½Ð¸ÐµÐ¼ Ð½Ð¾Ð²Ð¾Ð³Ð¾
4. **ÐŸÑ€Ð¾Ñ‚ÐµÑÑ‚Ð¸Ñ€ÑƒÐ¹Ñ‚Ðµ** ÐºÐ°Ð¶Ð´Ñ‹Ð¹ ÑˆÐ°Ð³ Ð¾Ñ‚Ð´ÐµÐ»ÑŒÐ½Ð¾

### ÐžÑ‚Ð»Ð°Ð´ÐºÐ°:

Ð•ÑÐ»Ð¸ Ñ‡Ñ‚Ð¾-Ñ‚Ð¾ Ð½Ðµ Ñ€Ð°Ð±Ð¾Ñ‚Ð°ÐµÑ‚:
1. Ð’ÐºÐ»ÑŽÑ‡Ð¸Ñ‚Ðµ **"Execute Workflow"** Ð´Ð»Ñ ÐºÐ°Ð¶Ð´Ð¾Ð³Ð¾ ÑƒÐ·Ð»Ð° Ð¾Ñ‚Ð´ÐµÐ»ÑŒÐ½Ð¾
2. ÐŸÑ€Ð¾Ð²ÐµÑ€ÑŒÑ‚Ðµ **Output Data** ÐºÐ°Ð¶Ð´Ð¾Ð³Ð¾ ÑƒÐ·Ð»Ð°
3. Ð£Ð±ÐµÐ´Ð¸Ñ‚ÐµÑÑŒ, Ñ‡Ñ‚Ð¾ Ð´Ð°Ð½Ð½Ñ‹Ðµ Ð¿ÐµÑ€ÐµÐ´Ð°ÑŽÑ‚ÑÑ Ð¿Ñ€Ð°Ð²Ð¸Ð»ÑŒÐ½Ð¾ Ð¼ÐµÐ¶Ð´Ñƒ ÑƒÐ·Ð»Ð°Ð¼Ð¸
4. ÐŸÑ€Ð¾Ð²ÐµÑ€ÑŒÑ‚Ðµ Ð»Ð¾Ð³Ð¸ Ð² n8n (Execution Log)

---

## ÐÐ»ÑŒÑ‚ÐµÑ€Ð½Ð°Ñ‚Ð¸Ð²Ð½Ñ‹Ð¹ Ð²Ð°Ñ€Ð¸Ð°Ð½Ñ‚ (ÐµÑÐ»Ð¸ Ñ„Ð¸Ð»ÑŒÑ‚Ñ€Ñ‹ Supabase Ð½Ðµ Ñ€Ð°Ð±Ð¾Ñ‚Ð°ÑŽÑ‚):

Ð•ÑÐ»Ð¸ Ð² ÑˆÐ°Ð³Ðµ 3 Ñ„Ð¸Ð»ÑŒÑ‚Ñ€Ñ‹ Supabase Ð½Ðµ Ñ€Ð°Ð±Ð¾Ñ‚Ð°ÑŽÑ‚, Ð¸ÑÐ¿Ð¾Ð»ÑŒÐ·ÑƒÐ¹Ñ‚Ðµ ÑƒÐ·ÐµÐ» **"Code"** Ð´Ð»Ñ Ñ„Ð¸Ð»ÑŒÑ‚Ñ€Ð°Ñ†Ð¸Ð¸:

**Ð’Ð¼ÐµÑÑ‚Ð¾ ÑƒÐ·Ð»Ð° "Get link code from DB" Ð¸ÑÐ¿Ð¾Ð»ÑŒÐ·ÑƒÐ¹Ñ‚Ðµ:**

1. Ð£Ð·ÐµÐ» **"Supabase"** â†’ **Operation:** `getAll` â†’ **Table:** `menohub_telegram_auth_codes` â†’ **Return All:** `true`
2. Ð£Ð·ÐµÐ» **"Code"** Ð´Ð»Ñ Ñ„Ð¸Ð»ÑŒÑ‚Ñ€Ð°Ñ†Ð¸Ð¸:
```javascript
const code = $('Extract link code').item.json.code;
const allCodes = $input.all();

const foundCode = allCodes.find(item => {
  const codeData = item.json;
  return codeData.code === code 
    && codeData.used === false 
    && new Date(codeData.expires_at) > new Date();
});

if (!foundCode) {
  return [{
    json: {
      error: 'Code not found or expired',
      code: code
    }
  }];
}

return [foundCode];
```

