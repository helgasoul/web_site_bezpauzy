# –ê—É–¥–∏—Ç –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏ –ø—Ä–æ–µ–∫—Ç–∞ "–ë–µ–∑ |–ü–∞—É–∑—ã"

## üìã –û–±–∑–æ—Ä

–≠—Ç–æ—Ç –¥–æ–∫—É–º–µ–Ω—Ç —Å–æ–¥–µ—Ä–∂–∏—Ç –∞–Ω–∞–ª–∏–∑ —Ç–µ–∫—É—â–µ–≥–æ —Å–æ—Å—Ç–æ—è–Ω–∏—è –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏ –ø—Ä–æ–µ–∫—Ç–∞ –∏ —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏ –ø–æ —É–ª—É—á—à–µ–Ω–∏—é.

**–î–∞—Ç–∞ –∞—É–¥–∏—Ç–∞:** 2025-01-05  
**–í–µ—Ä—Å–∏—è Next.js:** 14.0.0  
**–ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö:** Supabase (PostgreSQL)

---

## üî¥ –ö—Ä–∏—Ç–∏—á–µ—Å–∫–∏–µ –ø—Ä–æ–±–ª–µ–º—ã

### 1. ‚úÖ Rate Limiting - –ò–°–ü–†–ê–í–õ–ï–ù–û
**–°—Ç–∞—Ç—É—Å:** –†–µ–∞–ª–∏–∑–æ–≤–∞–Ω–æ –≤ `middleware.ts` –∏ `lib/rate-limit.ts`

**–†–µ–∞–ª–∏–∑–∞—Ü–∏—è:**
- In-memory rate limiter (–¥–ª—è MVP)
- –†–∞–∑–Ω—ã–µ –ª–∏–º–∏—Ç—ã –¥–ª—è —Ä–∞–∑–Ω—ã—Ö —Ç–∏–ø–æ–≤ endpoints
- –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –æ—á–∏—Å—Ç–∫–∞ —Å—Ç–∞—Ä—ã—Ö –∑–∞–ø–∏—Å–µ–π
- HTTP –∑–∞–≥–æ–ª–æ–≤–∫–∏ —Å –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–µ–π –æ –ª–∏–º–∏—Ç–∞—Ö

**–õ–∏–º–∏—Ç—ã:**
- –ê—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è: 5 –∑–∞–ø—Ä–æ—Å–æ–≤ / 15 –º–∏–Ω—É—Ç
- –ü–æ–¥–ø–∏—Å–∫–∏: 3 –∑–∞–ø—Ä–æ—Å–∞ / —á–∞—Å
- –ß—É–≤—Å—Ç–≤–∏—Ç–µ–ª—å–Ω—ã–µ –æ–ø–µ—Ä–∞—Ü–∏–∏: 10 –∑–∞–ø—Ä–æ—Å–æ–≤ / —á–∞—Å
- –û–±—â–∏–µ API: 60 –∑–∞–ø—Ä–æ—Å–æ–≤ / –º–∏–Ω—É—Ç—É

**–î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è:** `docs/RATE_LIMITING.md`

**–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è –¥–ª—è production:** –ú–∏–≥—Ä–∏—Ä–æ–≤–∞—Ç—å –Ω–∞ Redis-based —Ä–µ—à–µ–Ω–∏–µ (Upstash –∏–ª–∏ —Å–≤–æ–π Redis)

### 2. ‚úÖ –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ —á—É–≤—Å—Ç–≤–∏—Ç–µ–ª—å–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö - –ò–°–ü–†–ê–í–õ–ï–ù–û
**–°—Ç–∞—Ç—É—Å:** –í—Å–µ `console.log` —Å —á—É–≤—Å—Ç–≤–∏—Ç–µ–ª—å–Ω—ã–º–∏ –¥–∞–Ω–Ω—ã–º–∏ –æ–±–µ—Ä–Ω—É—Ç—ã –≤ –ø—Ä–æ–≤–µ—Ä–∫—É `NODE_ENV === 'development'`

**–ò—Å–ø—Ä–∞–≤–ª–µ–Ω–æ –≤:**
- ‚úÖ `app/api/auth/telegram/get-session/route.ts` - –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ —Ç–æ–ª—å–∫–æ –≤ development
- ‚úÖ `app/api/quiz/save-results/route.ts` - —É–¥–∞–ª–µ–Ω—ã userId, insertData, —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã —Ç–µ—Å—Ç–æ–≤ –∏–∑ –ª–æ–≥–æ–≤
- ‚úÖ `app/api/quiz/get-results/route.ts` - —É–¥–∞–ª–µ–Ω userId –∏–∑ –ª–æ–≥–æ–≤
- ‚úÖ `app/api/auth/link-telegram/generate-code/route.ts` - —É–¥–∞–ª–µ–Ω—ã –∫–æ–¥—ã, —Å—Å—ã–ª–∫–∏, user.id –∏–∑ –ª–æ–≥–æ–≤

**–†–µ–∞–ª–∏–∑–∞—Ü–∏—è:**
- –í—Å–µ —á—É–≤—Å—Ç–≤–∏—Ç–µ–ª—å–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ –ª–æ–≥–∏—Ä—É—é—Ç—Å—è —Ç–æ–ª—å–∫–æ –≤ development —Ä–µ–∂–∏–º–µ
- –í production –ª–æ–≥–∏—Ä—É—é—Ç—Å—è —Ç–æ–ª—å–∫–æ –æ–±—â–∏–µ —Å–æ–æ–±—â–µ–Ω–∏—è –æ–± –æ—à–∏–±–∫–∞—Ö (–±–µ–∑ –¥–∞–Ω–Ω—ã—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π)
- –°–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É–µ—Ç —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è–º GDPR/–§–ó-152

### 3. ‚úÖ –ù–µ–±–µ–∑–æ–ø–∞—Å–Ω–æ–µ —Ö—Ä–∞–Ω–µ–Ω–∏–µ —Å–µ—Å—Å–∏–π - –ò–°–ü–†–ê–í–õ–ï–ù–û
**–°—Ç–∞—Ç—É—Å:** –†–µ–∞–ª–∏–∑–æ–≤–∞–Ω–∞ —Å–∏—Å—Ç–µ–º–∞ JWT —Å –ø–æ–¥–ø–∏—Å—å—é

**–†–µ–∞–ª–∏–∑–∞—Ü–∏—è:**
- ‚úÖ –°–æ–∑–¥–∞–Ω–∞ —É—Ç–∏–ª–∏—Ç–∞ `lib/auth/session.ts` –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å JWT
- ‚úÖ –í—Å–µ —Å–µ—Å—Å–∏–∏ —Ç–µ–ø–µ—Ä—å –∏—Å–ø–æ–ª—å–∑—É—é—Ç JWT —Å –ø–æ–¥–ø–∏—Å—å—é (HS256)
- ‚úÖ –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞ —Ü–µ–ª–æ—Å—Ç–Ω–æ—Å—Ç–∏ —Ç–æ–∫–µ–Ω–æ–≤
- ‚úÖ –°—Ä–æ–∫ –¥–µ–π—Å—Ç–≤–∏—è: 30 –¥–Ω–µ–π
- ‚úÖ –û–±—Ä–∞—Ç–Ω–∞—è —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç—å —Å legacy base64 —Ç–æ–∫–µ–Ω–∞–º–∏ (–¥–ª—è –º–∏–≥—Ä–∞—Ü–∏–∏)

**–û–±–Ω–æ–≤–ª–µ–Ω–Ω—ã–µ —Ñ–∞–π–ª—ã:**
- ‚úÖ –í—Å–µ auth endpoints (verify-code, register, login, etc.)
- ‚úÖ –í—Å–µ quiz endpoints (save-results, get-results, delete-result, history)
- ‚úÖ get-session endpoint

**–¢—Ä–µ–±—É–µ—Ç—Å—è:**
- –£—Å—Ç–∞–Ω–æ–≤–∏—Ç—å `jsonwebtoken`: `npm install jsonwebtoken @types/jsonwebtoken`
- –î–æ–±–∞–≤–∏—Ç—å `JWT_SECRET` –≤ `.env.local` (–º–∏–Ω–∏–º—É–º 32 —Å–∏–º–≤–æ–ª–∞)

**–î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è:** `docs/JWT_SESSION_SETUP.md`

### 4. ‚úÖ CORS –∑–∞—â–∏—Ç–∞ - –ò–°–ü–†–ê–í–õ–ï–ù–û
**–°—Ç–∞—Ç—É—Å:** –†–µ–∞–ª–∏–∑–æ–≤–∞–Ω–∞ –ø–æ–ª–Ω–∞—è CORS –∑–∞—â–∏—Ç–∞ —Å CSRF –ø—Ä–æ–≤–µ—Ä–∫–∞–º–∏

**–†–µ–∞–ª–∏–∑–∞—Ü–∏—è:**
- ‚úÖ CORS middleware –≤ `middleware.ts`
- ‚úÖ –°–ø–∏—Å–æ–∫ —Ä–∞–∑—Ä–µ—à–µ–Ω–Ω—ã—Ö origins (–Ω–∞—Å—Ç—Ä–∞–∏–≤–∞–µ—Ç—Å—è —á–µ—Ä–µ–∑ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è)
- ‚úÖ –ü—Ä–æ–≤–µ—Ä–∫–∞ Referer –¥–ª—è state-changing –∑–∞–ø—Ä–æ—Å–æ–≤ (POST, PUT, DELETE, PATCH)
- ‚úÖ –ë–ª–æ–∫–∏—Ä–æ–≤–∫–∞ –∑–∞–ø—Ä–æ—Å–æ–≤ —Å –Ω–µ—Ä–∞–∑—Ä–µ—à–µ–Ω–Ω—ã—Ö origins
- ‚úÖ –ü—Ä–∞–≤–∏–ª—å–Ω–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞ preflight –∑–∞–ø—Ä–æ—Å–æ–≤ (OPTIONS)

**–ù–∞—Å—Ç—Ä–æ–µ–Ω–æ:**
- –†–∞–∑—Ä–µ—à–µ–Ω–Ω—ã–µ origins: localhost, bezpauzy.com, NEXT_PUBLIC_SITE_URL
- Access-Control-Allow-Credentials: true (–¥–ª—è cookies)
- Access-Control-Max-Age: 24 —á–∞—Å–∞ (–¥–ª—è –∫–µ—à–∏—Ä–æ–≤–∞–Ω–∏—è preflight)

**–î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–∞—è –∑–∞—â–∏—Ç–∞:**
- –ü—Ä–æ–≤–µ—Ä–∫–∞ Referer –¥–ª—è POST/PUT/DELETE –∑–∞–ø—Ä–æ—Å–æ–≤
- –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –ø–æ–¥–æ–∑—Ä–∏—Ç–µ–ª—å–Ω—ã—Ö –∑–∞–ø—Ä–æ—Å–æ–≤ –≤ development

### 5. ‚úÖ Content Security Policy - –ò–°–ü–†–ê–í–õ–ï–ù–û
**–°—Ç–∞—Ç—É—Å:** –î–æ–±–∞–≤–ª–µ–Ω—ã Security Headers –∏ CSP –≤ `next.config.js`

**–†–µ–∞–ª–∏–∑–∞—Ü–∏—è:**
- ‚úÖ Security Headers –≤ `next.config.js` (X-Frame-Options, X-Content-Type-Options, etc.)
- ‚úÖ Content Security Policy (CSP) —Å —Ä–∞–∑—Ä–µ—à–µ–Ω–∏—è–º–∏ –¥–ª—è Next.js, Tailwind, Supabase
- ‚úÖ Permissions Policy (–±–ª–æ–∫–∏—Ä–æ–≤–∫–∞ –∫–∞–º–µ—Ä—ã, –º–∏–∫—Ä–æ—Ñ–æ–Ω–∞, –≥–µ–æ–ª–æ–∫–∞—Ü–∏–∏)
- ‚úÖ Strict-Transport-Security (HSTS)

**–ù–∞—Å—Ç—Ä–æ–µ–Ω–Ω—ã–µ –∑–∞–≥–æ–ª–æ–≤–∫–∏:**
- `X-Frame-Options: SAMEORIGIN` - –∑–∞—â–∏—Ç–∞ –æ—Ç clickjacking
- `X-Content-Type-Options: nosniff` - –∑–∞—â–∏—Ç–∞ –æ—Ç MIME type sniffing
- `X-XSS-Protection: 1; mode=block` - –∑–∞—â–∏—Ç–∞ –æ—Ç XSS
- `Content-Security-Policy` - –ø–æ–ª–∏—Ç–∏–∫–∞ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏ –∫–æ–Ω—Ç–µ–Ω—Ç–∞
- `Strict-Transport-Security` - –ø—Ä–∏–Ω—É–¥–∏—Ç–µ–ª—å–Ω—ã–π HTTPS
- `Referrer-Policy` - –∫–æ–Ω—Ç—Ä–æ–ª—å –ø–µ—Ä–µ–¥–∞—á–∏ referrer

**–†–∏—Å–∫–∏ (—É—Å—Ç—Ä–∞–Ω–µ–Ω—ã):**
- ‚úÖ XSS –∞—Ç–∞–∫–∏ - –∑–∞—â–∏—â–µ–Ω–æ CSP
- ‚úÖ Clickjacking - –∑–∞—â–∏—â–µ–Ω–æ X-Frame-Options
- ‚úÖ MIME type sniffing - –∑–∞—â–∏—â–µ–Ω–æ X-Content-Type-Options

---

## üü° –í–∞–∂–Ω—ã–µ –ø—Ä–æ–±–ª–µ–º—ã

### 6. ‚úÖ –ù–µ–ø–æ–ª–Ω–∞—è –≤–∞–ª–∏–¥–∞—Ü–∏—è –≤—Ö–æ–¥–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö - –ò–°–ü–†–ê–í–õ–ï–ù–û
**–°—Ç–∞—Ç—É—Å:** –î–æ–±–∞–≤–ª–µ–Ω–∞ –≤–∞–ª–∏–¥–∞—Ü–∏—è Zod –≤–æ –≤—Å–µ –∫—Ä–∏—Ç–∏—á–Ω—ã–µ API routes

**–†–µ–∞–ª–∏–∑–∞—Ü–∏—è:**
- ‚úÖ –°–æ–∑–¥–∞–Ω–∞ –±–∏–±–ª–∏–æ—Ç–µ–∫–∞ –≤–∞–ª–∏–¥–∞—Ü–∏–∏ `lib/validation/quiz.ts` –¥–ª—è —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤ —Ç–µ—Å—Ç–æ–≤
- ‚úÖ –î–æ–±–∞–≤–ª–µ–Ω–∞ Zod –≤–∞–ª–∏–¥–∞—Ü–∏—è –≤ `/api/quiz/save-results` - –ø—Ä–æ–≤–µ—Ä–∫–∞ –≤—Å–µ—Ö —Ç–∏–ø–æ–≤ —Ç–µ—Å—Ç–æ–≤
- ‚úÖ –î–æ–±–∞–≤–ª–µ–Ω–∞ Zod –≤–∞–ª–∏–¥–∞—Ü–∏—è –≤ `/api/chat/send-message` - –ø—Ä–æ–≤–µ—Ä–∫–∞ —Å–æ–æ–±—â–µ–Ω–∏–π
- ‚úÖ –§–æ—Ä—É–º —É–∂–µ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç Zod (`/api/forum/topics`, `/api/forum/topics/[topicId]/replies`)

**–í–∞–ª–∏–¥–∞—Ü–∏—è –≤–∫–ª—é—á–∞–µ—Ç:**
- –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ç–∏–ø–æ–≤ –¥–∞–Ω–Ω—ã—Ö (string, number, enum)
- –ü—Ä–æ–≤–µ—Ä–∫–∞ –¥–∏–∞–ø–∞–∑–æ–Ω–æ–≤ –∑–Ω–∞—á–µ–Ω–∏–π (min/max)
- –ü—Ä–æ–≤–µ—Ä–∫–∞ –æ–±—è–∑–∞—Ç–µ–ª—å–Ω—ã—Ö –ø–æ–ª–µ–π
- –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ñ–æ—Ä–º–∞—Ç–æ–≤ (email, UUID)
- –î–µ—Ç–∞–ª—å–Ω—ã–µ —Å–æ–æ–±—â–µ–Ω–∏—è –æ–± –æ—à–∏–±–∫–∞—Ö

**–§–∞–π–ª—ã —Å –≤–∞–ª–∏–¥–∞—Ü–∏–µ–π:**
- ‚úÖ `/api/newsletter/subscribe` - Zod
- ‚úÖ `/api/community/join` - Zod
- ‚úÖ `/api/quiz/save-results` - Zod (–Ω–æ–≤–æ–µ)
- ‚úÖ `/api/chat/send-message` - Zod (–Ω–æ–≤–æ–µ)
- ‚úÖ `/api/forum/topics` - Zod
- ‚úÖ `/api/forum/topics/[topicId]/replies` - Zod

### 7. –û—Ç—Å—É—Ç—Å—Ç–≤–∏–µ –∑–∞—â–∏—Ç—ã –æ—Ç SQL Injection
**–°—Ç–∞—Ç—É—Å:** –ß–∞—Å—Ç–∏—á–Ω–æ –∑–∞—â–∏—â–µ–Ω–æ (Supabase –∏—Å–ø–æ–ª—å–∑—É–µ—Ç –ø–∞—Ä–∞–º–µ—Ç—Ä–∏–∑–æ–≤–∞–Ω–Ω—ã–µ –∑–∞–ø—Ä–æ—Å—ã)

**–†–∏—Å–∫–∏:** –ü—Ä–∏ –ø—Ä—è–º—ã—Ö SQL –∑–∞–ø—Ä–æ—Å–∞—Ö (–µ—Å–ª–∏ –ø–æ—è–≤—è—Ç—Å—è –≤ –±—É–¥—É—â–µ–º)

**–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è:** –í—Å–µ–≥–¥–∞ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å Supabase client, –Ω–∏–∫–æ–≥–¥–∞ –Ω–µ –¥–µ–ª–∞—Ç—å –ø—Ä—è–º—ã–µ SQL –∑–∞–ø—Ä–æ—Å—ã.

### 8. ‚úÖ –ó–∞—â–∏—Ç–∞ –æ—Ç XSS - –ò–°–ü–†–ê–í–õ–ï–ù–û
**–°—Ç–∞—Ç—É—Å:** –†–µ–∞–ª–∏–∑–æ–≤–∞–Ω–∞ —Å–∞–Ω–∏—Ç–∏–∑–∞—Ü–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–æ–≥–æ –∫–æ–Ω—Ç–µ–Ω—Ç–∞ —Å –ø–æ–º–æ—â—å—é DOMPurify

**–†–µ–∞–ª–∏–∑–∞—Ü–∏—è:**
- ‚úÖ –£—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω `isomorphic-dompurify` –¥–ª—è —Å–µ—Ä–≤–µ—Ä–Ω–æ–π –∏ –∫–ª–∏–µ–Ω—Ç—Å–∫–æ–π —Å–∞–Ω–∏—Ç–∏–∑–∞—Ü–∏–∏
- ‚úÖ –°–æ–∑–¥–∞–Ω–∞ —É—Ç–∏–ª–∏—Ç–∞ `lib/utils/sanitize.ts` —Å —Ñ—É–Ω–∫—Ü–∏—è–º–∏ —Å–∞–Ω–∏—Ç–∏–∑–∞—Ü–∏–∏
- ‚úÖ –î–æ–±–∞–≤–ª–µ–Ω–∞ —Å–∞–Ω–∏—Ç–∏–∑–∞—Ü–∏—è –≤ API routes –ø–µ—Ä–µ–¥ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ–º –≤ –ë–î
- ‚úÖ React –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —ç–∫—Ä–∞–Ω–∏—Ä—É–µ—Ç —Ç–µ–∫—Å—Ç –≤ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–∞—Ö (–±–µ–∑–æ–ø–∞—Å–Ω–æ –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é)

**–°–∞–Ω–∏—Ç–∏–∑–∞—Ü–∏—è –¥–æ–±–∞–≤–ª–µ–Ω–∞ –≤:**
- ‚úÖ `/api/forum/topics` - —Å–∞–Ω–∏—Ç–∏–∑–∞—Ü–∏—è title, content, author_name
- ‚úÖ `/api/forum/topics/[topicId]/replies` - —Å–∞–Ω–∏—Ç–∏–∑–∞—Ü–∏—è content, author_name
- ‚úÖ `/api/chat/send-message` - —Å–∞–Ω–∏—Ç–∏–∑–∞—Ü–∏—è —Å–æ–æ–±—â–µ–Ω–∏–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π

**–§—É–Ω–∫—Ü–∏–∏ —Å–∞–Ω–∏—Ç–∏–∑–∞—Ü–∏–∏:**
- `sanitizeHTML()` - –¥–ª—è HTML –∫–æ–Ω—Ç–µ–Ω—Ç–∞ (—É–¥–∞–ª—è–µ—Ç –æ–ø–∞—Å–Ω—ã–µ —Ç–µ–≥–∏ –∏ –∞—Ç—Ä–∏–±—É—Ç—ã)
- `sanitizeText()` - –¥–ª—è plain text (—É–¥–∞–ª—è–µ—Ç –≤–µ—Å—å HTML)
- `sanitizeInput()` - –¥–ª—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–æ–≥–æ –≤–≤–æ–¥–∞ (—É–¥–∞–ª—è–µ—Ç HTML + –æ–≥—Ä–∞–Ω–∏—á–∏–≤–∞–µ—Ç –¥–ª–∏–Ω—É)
- `sanitizeForDisplay()` - –¥–ª—è –±–µ–∑–æ–ø–∞—Å–Ω–æ–≥–æ –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è (—Ä–∞–∑—Ä–µ—à–∞–µ—Ç –±–∞–∑–æ–≤–æ–µ —Ñ–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ)

**–ó–∞—â–∏—Ç–∞:**
- ‚úÖ –£–¥–∞–ª–µ–Ω–∏–µ –≤—Å–µ—Ö –æ–ø–∞—Å–Ω—ã—Ö HTML —Ç–µ–≥–æ–≤ –∏ –∞—Ç—Ä–∏–±—É—Ç–æ–≤
- ‚úÖ –£–¥–∞–ª–µ–Ω–∏–µ JavaScript —Å–æ–±—ã—Ç–∏–π (onclick, onerror, etc.)
- ‚úÖ –û–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–µ –¥–ª–∏–Ω—ã –∫–æ–Ω—Ç–µ–Ω—Ç–∞
- ‚úÖ –≠–∫—Ä–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ —Å–ø–µ—Ü–∏–∞–ª—å–Ω—ã—Ö —Å–∏–º–≤–æ–ª–æ–≤

### 9. –û—Ç—Å—É—Ç—Å—Ç–≤–∏–µ HTTPS enforcement
**–ü—Ä–æ–±–ª–µ–º–∞:** –ù–µ—Ç –ø—Ä–∏–Ω—É–¥–∏—Ç–µ–ª—å–Ω–æ–≥–æ —Ä–µ–¥–∏—Ä–µ–∫—Ç–∞ –Ω–∞ HTTPS.

**–†–µ—à–µ–Ω–∏–µ:** –ù–∞—Å—Ç—Ä–æ–∏—Ç—å –Ω–∞ —É—Ä–æ–≤–Ω–µ —Ö–æ—Å—Ç–∏–Ω–≥–∞ (Vercel –¥–µ–ª–∞–µ—Ç —ç—Ç–æ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏).

### 10. ‚úÖ –ó–∞—â–∏—Ç–∞ –æ—Ç Clickjacking - –ò–°–ü–†–ê–í–õ–ï–ù–û
**–°—Ç–∞—Ç—É—Å:** –†–µ–∞–ª–∏–∑–æ–≤–∞–Ω–∞ –∑–∞—â–∏—Ç–∞ –æ—Ç Clickjacking —á–µ—Ä–µ–∑ –∑–∞–≥–æ–ª–æ–≤–∫–∏ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏

**–†–µ–∞–ª–∏–∑–∞—Ü–∏—è:**
- ‚úÖ `X-Frame-Options: SAMEORIGIN` –≤ `next.config.js` - –∑–∞–ø—Ä–µ—â–∞–µ—Ç –≤—Å—Ç—Ä–∞–∏–≤–∞–Ω–∏–µ –≤ iframe —Å –¥—Ä—É–≥–∏—Ö –¥–æ–º–µ–Ω–æ–≤
- ‚úÖ `frame-ancestors 'self'` –≤ Content Security Policy - –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–∞—è –∑–∞—â–∏—Ç–∞ (—Å–æ–≤—Ä–µ–º–µ–Ω–Ω—ã–π —Å—Ç–∞–Ω–¥–∞—Ä—Ç)

**–ó–∞—â–∏—Ç–∞:**
- ‚úÖ –°—Ç—Ä–∞–Ω–∏—Ü—ã –º–æ–∂–Ω–æ –≤—Å—Ç—Ä–∞–∏–≤–∞—Ç—å —Ç–æ–ª—å–∫–æ —Å —Ç–æ–≥–æ –∂–µ –¥–æ–º–µ–Ω–∞ (SAMEORIGIN)
- ‚úÖ CSP frame-ancestors –±–ª–æ–∫–∏—Ä—É–µ—Ç –≤—Å—Ç—Ä–∞–∏–≤–∞–Ω–∏–µ —Å –¥—Ä—É–≥–∏—Ö –∏—Å—Ç–æ—á–Ω–∏–∫–æ–≤
- ‚úÖ –î–≤–æ–π–Ω–∞—è –∑–∞—â–∏—Ç–∞: X-Frame-Options (—Å—Ç–∞—Ä—ã–π –±—Ä–∞—É–∑–µ—Ä—ã) + CSP (—Å–æ–≤—Ä–µ–º–µ–Ω–Ω—ã–µ –±—Ä–∞—É–∑–µ—Ä—ã)

**–ù–∞—Å—Ç—Ä–æ–µ–Ω–æ –≤:**
- `next.config.js` - Security Headers –¥–ª—è –≤—Å–µ—Ö —Å—Ç—Ä–∞–Ω–∏—Ü

---

## üü¢ –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏ –ø–æ —É–ª—É—á—à–µ–Ω–∏—é

### 11. ‚úÖ Security Headers - –ò–°–ü–†–ê–í–õ–ï–ù–û
**–°—Ç–∞—Ç—É—Å:** –í—Å–µ Security Headers —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω—ã –≤ `next.config.js`

**–†–µ–∞–ª–∏–∑–æ–≤–∞–Ω–Ω—ã–µ –∑–∞–≥–æ–ª–æ–≤–∫–∏:**
- ‚úÖ `X-DNS-Prefetch-Control: on` - –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è DNS –∑–∞–ø—Ä–æ—Å–æ–≤
- ‚úÖ `Strict-Transport-Security` - –ø—Ä–∏–Ω—É–¥–∏—Ç–µ–ª—å–Ω—ã–π HTTPS (HSTS)
- ‚úÖ `X-Frame-Options: SAMEORIGIN` - –∑–∞—â–∏—Ç–∞ –æ—Ç Clickjacking
- ‚úÖ `X-Content-Type-Options: nosniff` - –∑–∞—â–∏—Ç–∞ –æ—Ç MIME type sniffing
- ‚úÖ `X-XSS-Protection: 1; mode=block` - –∑–∞—â–∏—Ç–∞ –æ—Ç XSS (legacy –±—Ä–∞—É–∑–µ—Ä—ã)
- ‚úÖ `Referrer-Policy: origin-when-cross-origin` - –∫–æ–Ω—Ç—Ä–æ–ª—å –ø–µ—Ä–µ–¥–∞—á–∏ referrer
- ‚úÖ `Permissions-Policy` - –±–ª–æ–∫–∏—Ä–æ–≤–∫–∞ –∫–∞–º–µ—Ä—ã, –º–∏–∫—Ä–æ—Ñ–æ–Ω–∞, –≥–µ–æ–ª–æ–∫–∞—Ü–∏–∏
- ‚úÖ `Content-Security-Policy` - –ø–æ–ª–∏—Ç–∏–∫–∞ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏ –∫–æ–Ω—Ç–µ–Ω—Ç–∞

**CSP –≤–∫–ª—é—á–∞–µ—Ç:**
- `default-src 'self'` - —Ç–æ–ª—å–∫–æ —Å —Ç–æ–≥–æ –∂–µ –¥–æ–º–µ–Ω–∞
- `script-src` - —Ä–∞–∑—Ä–µ—à–µ–Ω—ã —Å–∫—Ä–∏–ø—Ç—ã Next.js
- `style-src` - —Ä–∞–∑—Ä–µ—à–µ–Ω—ã —Å—Ç–∏–ª–∏ Tailwind
- `img-src` - —Ä–∞–∑—Ä–µ—à–µ–Ω—ã –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è (self, data, https, blob)
- `connect-src` - —Ä–∞–∑—Ä–µ—à–µ–Ω—ã –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è –∫ Supabase –∏ Upstash
- `frame-ancestors 'self'` - –∑–∞—â–∏—Ç–∞ –æ—Ç Clickjacking
- `frame-src` - —Ä–∞–∑—Ä–µ—à–µ–Ω—ã YouTube –∏ Vimeo –¥–ª—è –≤–∏–¥–µ–æ

**–ü—Ä–∏–º–µ–Ω—è–µ—Ç—Å—è –∫–æ –≤—Å–µ–º —Å—Ç—Ä–∞–Ω–∏—Ü–∞–º:** `source: '/:path*'`

### 12. ‚úÖ Rate Limiting - –ò–°–ü–†–ê–í–õ–ï–ù–û
**–°—Ç–∞—Ç—É—Å:** –†–µ–∞–ª–∏–∑–æ–≤–∞–Ω–æ –≤ `middleware.ts` —Å –ø–æ–¥–¥–µ—Ä–∂–∫–æ–π Upstash Redis

**–†–µ–∞–ª–∏–∑–∞—Ü–∏—è:**
- ‚úÖ Rate limiting –≤ `middleware.ts` –¥–ª—è –≤—Å–µ—Ö API routes
- ‚úÖ –ü–æ–¥–¥–µ—Ä–∂–∫–∞ Upstash Redis (production) –∏ in-memory fallback (development)
- ‚úÖ –†–∞–∑–Ω—ã–µ –ª–∏–º–∏—Ç—ã –¥–ª—è —Ä–∞–∑–Ω—ã—Ö —Ç–∏–ø–æ–≤ endpoints (auth, subscription, sensitive, api)
- ‚úÖ –ó–∞–≥–æ–ª–æ–≤–∫–∏ X-RateLimit-* –≤ –æ—Ç–≤–µ—Ç–∞—Ö

**–ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏:**
- Auth endpoints: 5 –∑–∞–ø—Ä–æ—Å–æ–≤ / 15 –º–∏–Ω—É—Ç
- Subscription endpoints: 3 –∑–∞–ø—Ä–æ—Å–∞ / 1 —á–∞—Å
- Sensitive endpoints: 10 –∑–∞–ø—Ä–æ—Å–æ–≤ / 1 —á–∞—Å
- General API: 60 –∑–∞–ø—Ä–æ—Å–æ–≤ / 1 –º–∏–Ω—É—Ç–∞

**–°–º. —Ç–∞–∫–∂–µ:** –ü—É–Ω–∫—Ç 1 (Rate Limiting) - –ø–æ–ª–Ω–∞—è —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—è

### 13. ‚úÖ –£–ª—É—á—à–∏—Ç—å –æ–±—Ä–∞–±–æ—Ç–∫—É –æ—à–∏–±–æ–∫ - –ò–°–ü–†–ê–í–õ–ï–ù–û
**–°—Ç–∞—Ç—É—Å:** –í—Å–µ API routes –æ–±–Ω–æ–≤–ª–µ–Ω—ã –¥–ª—è –±–µ–∑–æ–ø–∞—Å–Ω–æ–π –æ–±—Ä–∞–±–æ—Ç–∫–∏ –æ—à–∏–±–æ–∫

**–ò—Å–ø—Ä–∞–≤–ª–µ–Ω–Ω—ã–µ —Ñ–∞–π–ª—ã:**
- ‚úÖ `app/api/quiz/save-results/route.ts` - –¥–µ—Ç–∞–ª–∏ –æ—à–∏–±–æ–∫ —Ç–æ–ª—å–∫–æ –≤ development
- ‚úÖ `app/api/quiz/history/route.ts` - –¥–µ—Ç–∞–ª–∏ –æ—à–∏–±–æ–∫ —Ç–æ–ª—å–∫–æ –≤ development
- ‚úÖ `app/api/quiz/delete-result/route.ts` - –¥–µ—Ç–∞–ª–∏ –æ—à–∏–±–æ–∫ —Ç–æ–ª—å–∫–æ –≤ development
- ‚úÖ `app/api/quiz/get-results/route.ts` - –¥–µ—Ç–∞–ª–∏ –æ—à–∏–±–æ–∫ —Ç–æ–ª—å–∫–æ –≤ development
- ‚úÖ `app/api/quiz/*/pdf/route.ts` (frax, phenoage, inflammation, mrs) - –¥–µ—Ç–∞–ª–∏ –æ—à–∏–±–æ–∫ —Ç–æ–ª—å–∫–æ –≤ development
- ‚úÖ `app/api/auth/register/route.ts` - –¥–µ—Ç–∞–ª–∏ –æ—à–∏–±–æ–∫ —Ç–æ–ª—å–∫–æ –≤ development
- ‚úÖ `app/api/features/vote/route.ts` - –¥–µ—Ç–∞–ª–∏ –æ—à–∏–±–æ–∫ —Ç–æ–ª—å–∫–æ –≤ development
- ‚úÖ `app/api/video/welcome-video/route.ts` - –¥–µ—Ç–∞–ª–∏ –æ—à–∏–±–æ–∫ —Ç–æ–ª—å–∫–æ –≤ development
- ‚úÖ `app/api/debug/quiz-results/route.ts` - –¥–µ—Ç–∞–ª–∏ –æ—à–∏–±–æ–∫ —Ç–æ–ª—å–∫–æ –≤ development
- ‚úÖ `app/api/forum/topics/route.ts` - –¥–µ—Ç–∞–ª–∏ –≤–∞–ª–∏–¥–∞—Ü–∏–∏ —Ç–æ–ª—å–∫–æ –≤ development
- ‚úÖ `app/api/forum/topics/[topicId]/replies/route.ts` - –¥–µ—Ç–∞–ª–∏ –≤–∞–ª–∏–¥–∞—Ü–∏–∏ —Ç–æ–ª—å–∫–æ –≤ development
- ‚úÖ `app/api/community/join/route.ts` - –¥–µ—Ç–∞–ª–∏ –≤–∞–ª–∏–¥–∞—Ü–∏–∏ —Ç–æ–ª—å–∫–æ –≤ development
- ‚úÖ `app/api/community/check/route.ts` - –¥–µ—Ç–∞–ª–∏ –≤–∞–ª–∏–¥–∞—Ü–∏–∏ —Ç–æ–ª—å–∫–æ –≤ development
- ‚úÖ `app/api/chat/send-message/route.ts` - –¥–µ—Ç–∞–ª–∏ –≤–∞–ª–∏–¥–∞—Ü–∏–∏ —Ç–æ–ª—å–∫–æ –≤ development

**–†–µ–∞–ª–∏–∑–∞—Ü–∏—è:**
- –î–µ—Ç–∞–ª–∏ –æ—à–∏–±–æ–∫ (`details`, `message`, `stack`) –≤–æ–∑–≤—Ä–∞—â–∞—é—Ç—Å—è —Ç–æ–ª—å–∫–æ –≤ `NODE_ENV === 'development'`
- –í production –≤–æ–∑–≤—Ä–∞—â–∞—é—Ç—Å—è —Ç–æ–ª—å–∫–æ –æ–±—â–∏–µ —Å–æ–æ–±—â–µ–Ω–∏—è –æ–± –æ—à–∏–±–∫–∞—Ö
- –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –æ—à–∏–±–æ–∫ –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ —Ç–æ–ª—å–∫–æ –≤ development —Ä–µ–∂–∏–º–µ
- –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ spread operator –¥–ª—è —É—Å–ª–æ–≤–Ω–æ–≥–æ –¥–æ–±–∞–≤–ª–µ–Ω–∏—è –¥–µ—Ç–∞–ª–µ–π: `...(process.env.NODE_ENV === 'development' && { details: ... })`

### 14. ‚úÖ –î–æ–±–∞–≤–∏—Ç—å –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏ - –ò–°–ü–†–ê–í–õ–ï–ù–û
**–°—Ç–∞—Ç—É—Å:** –†–µ–∞–ª–∏–∑–æ–≤–∞–Ω–∞ —Å–∏—Å—Ç–µ–º–∞ –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏

**–†–µ–∞–ª–∏–∑–æ–≤–∞–Ω–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏:**
- ‚úÖ –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –ø–æ–¥–æ–∑—Ä–∏—Ç–µ–ª—å–Ω–æ–π –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏ (`lib/security/monitoring.ts`)
- ‚úÖ –û—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏–µ –Ω–µ—É–¥–∞—á–Ω—ã—Ö –ø–æ–ø—ã—Ç–æ–∫ –≤—Ö–æ–¥–∞ —Å –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–π –±–ª–æ–∫–∏—Ä–æ–≤–∫–æ–π
- ‚úÖ –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –Ω–µ–æ–±—ã—á–Ω—ã—Ö –ø–∞—Ç—Ç–µ—Ä–Ω–æ–≤ –∑–∞–ø—Ä–æ—Å–æ–≤
- ‚úÖ –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –ø—Ä–µ–≤—ã—à–µ–Ω–∏–π rate limit
- ‚úÖ –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –ø–æ–¥–æ–∑—Ä–∏—Ç–µ–ª—å–Ω—ã—Ö CORS –∑–∞–ø—Ä–æ—Å–æ–≤

**–§—É–Ω–∫—Ü–∏–∏ –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞:**
1. **`logSecurityEvent()`** - —Ü–µ–Ω—Ç—Ä–∞–ª–∏–∑–æ–≤–∞–Ω–Ω–æ–µ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ —Å–æ–±—ã—Ç–∏–π –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏
2. **`trackFailedLogin()`** - –æ—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏–µ –Ω–µ—É–¥–∞—á–Ω—ã—Ö –ø–æ–ø—ã—Ç–æ–∫ –≤—Ö–æ–¥–∞ (–ø–æ—Ä–æ–≥: 5 –ø–æ–ø—ã—Ç–æ–∫ –∑–∞ 15 –º–∏–Ω—É—Ç)
3. **`logRateLimitExceeded()`** - –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –ø—Ä–µ–≤—ã—à–µ–Ω–∏–π rate limit
4. **`logSuspiciousRequest()`** - –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –ø–æ–¥–æ–∑—Ä–∏—Ç–µ–ª—å–Ω—ã—Ö –∑–∞–ø—Ä–æ—Å–æ–≤ (CORS, –Ω–µ–æ–±—ã—á–Ω—ã–µ –ø–∞—Ç—Ç–µ—Ä–Ω—ã)
5. **`detectUnusualPattern()`** - –æ–±–Ω–∞—Ä—É–∂–µ–Ω–∏–µ –Ω–µ–æ–±—ã—á–Ω—ã—Ö –ø–∞—Ç—Ç–µ—Ä–Ω–æ–≤ (–±–æ–ª–µ–µ 20 —Å–æ–±—ã—Ç–∏–π –∑–∞ –º–∏–Ω—É—Ç—É)
6. **`getSecurityStats()`** - –ø–æ–ª—É—á–µ–Ω–∏–µ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏ –¥–ª—è IP
7. **`getRecentSecurityEvents()`** - –ø–æ–ª—É—á–µ–Ω–∏–µ –ø–æ—Å–ª–µ–¥–Ω–∏—Ö —Å–æ–±—ã—Ç–∏–π

**–ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è:**
- ‚úÖ `middleware.ts` - –ª–æ–≥–∏—Ä—É–µ—Ç –ø—Ä–µ–≤—ã—à–µ–Ω–∏—è rate limit –∏ –ø–æ–¥–æ–∑—Ä–∏—Ç–µ–ª—å–Ω—ã–µ CORS –∑–∞–ø—Ä–æ—Å—ã
- ‚úÖ `app/api/auth/website/login/route.ts` - –æ—Ç—Å–ª–µ–∂–∏–≤–∞–µ—Ç –Ω–µ—É–¥–∞—á–Ω—ã–µ –ø–æ–ø—ã—Ç–∫–∏ –≤—Ö–æ–¥–∞ –∏ –±–ª–æ–∫–∏—Ä—É–µ—Ç –ø–æ—Å–ª–µ 5 –ø–æ–ø—ã—Ç–æ–∫

**–£—Ä–æ–≤–Ω–∏ —Å–µ—Ä—å–µ–∑–Ω–æ—Å—Ç–∏:**
- `low` - –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–æ–Ω–Ω—ã–µ —Å–æ–±—ã—Ç–∏—è
- `medium` - –ø–æ–¥–æ–∑—Ä–∏—Ç–µ–ª—å–Ω–∞—è –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç—å
- `high` - –ø–æ—Ç–µ–Ω—Ü–∏–∞–ª—å–Ω–∞—è –∞—Ç–∞–∫–∞
- `critical` - –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∞—è —É–≥—Ä–æ–∑–∞ (–≤ production –º–æ–∂–Ω–æ –Ω–∞—Å—Ç—Ä–æ–∏—Ç—å –∞–ª–µ—Ä—Ç—ã)

**–ü—Ä–∏–º–µ—á–∞–Ω–∏–µ:** –í production —Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è:
- –°–æ—Ö—Ä–∞–Ω—è—Ç—å —Å–æ–±—ã—Ç–∏—è –≤ –ë–î (Supabase) –≤–º–µ—Å—Ç–æ in-memory
- –ù–∞—Å—Ç—Ä–æ–∏—Ç—å –∞–ª–µ—Ä—Ç—ã –¥–ª—è –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏—Ö —Å–æ–±—ã—Ç–∏–π (email/Slack)
- –ò–Ω—Ç–µ–≥—Ä–∏—Ä–æ–≤–∞—Ç—å —Å Sentry –¥–ª—è –æ—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏—è –æ—à–∏–±–æ–∫
- –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å Redis –¥–ª—è —Ä–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–Ω–æ–≥–æ —Ö—Ä–∞–Ω–µ–Ω–∏—è —Å—á–µ—Ç—á–∏–∫–æ–≤

### 15. ‚úÖ –†–µ–≥—É–ª—è—Ä–Ω—ã–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π - –ò–°–ü–†–ê–í–õ–ï–ù–û
**–°—Ç–∞—Ç—É—Å:** –î–æ–±–∞–≤–ª–µ–Ω—ã —Å–∫—Ä–∏–ø—Ç—ã –¥–ª—è —Ä–µ–≥—É–ª—è—Ä–Ω—ã—Ö –ø—Ä–æ–≤–µ—Ä–æ–∫ –∏ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–π

**–î–æ–±–∞–≤–ª–µ–Ω–Ω—ã–µ npm —Å–∫—Ä–∏–ø—Ç—ã:**
- ‚úÖ `npm run security:audit` - –ø—Ä–æ–≤–µ—Ä–∫–∞ —É—è–∑–≤–∏–º–æ—Å—Ç–µ–π
- ‚úÖ `npm run security:fix` - –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —É—è–∑–≤–∏–º–æ—Å—Ç–µ–π
- ‚úÖ `npm run security:check` - –ø—Ä–æ–≤–µ—Ä–∫–∞ —Å —É—Ä–æ–≤–Ω–µ–º moderate –∏ –≤—ã—à–µ
- ‚úÖ `npm run deps:outdated` - –ø—Ä–æ–≤–µ—Ä–∫–∞ —É—Å—Ç–∞—Ä–µ–≤—à–∏—Ö –ø–∞–∫–µ—Ç–æ–≤
- ‚úÖ `npm run deps:update` - –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ –ø–∞–∫–µ—Ç–æ–≤ –¥–æ –ø–æ—Å–ª–µ–¥–Ω–∏—Ö —Å–æ–≤–º–µ—Å—Ç–∏–º—ã—Ö –≤–µ—Ä—Å–∏–π
- ‚úÖ `npm run deps:check` - –ø–æ–ª–Ω–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞ (outdated + audit)

**–¢–µ–∫—É—â–∏–π —Å—Ç–∞—Ç—É—Å:**
- ‚úÖ –£—è–∑–≤–∏–º–æ—Å—Ç–∏: **0** (–ø—Ä–æ–≤–µ—Ä–µ–Ω–æ —á–µ—Ä–µ–∑ `npm audit`)
- ‚úÖ –í—Å–µ–≥–æ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π: 187 (159 prod, 25 optional, 4 peer)

**–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏:**
1. **–ï–∂–µ–Ω–µ–¥–µ–ª—å–Ω–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞:**
   ```bash
   npm run security:check
   npm run deps:outdated
   ```

2. **–ï–∂–µ–º–µ—Å—è—á–Ω–æ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ:**
   ```bash
   npm run security:fix
   npm run deps:update
   ```

3. **–ü–µ—Ä–µ–¥ –¥–µ–ø–ª–æ–µ–º:**
   ```bash
   npm run deps:check
   ```

4. **–ê–≤—Ç–æ–º–∞—Ç–∏–∑–∞—Ü–∏—è (CI/CD):**
   - –î–æ–±–∞–≤–∏—Ç—å `npm run security:check` –≤ CI pipeline
   - –ù–∞—Å—Ç—Ä–æ–∏—Ç—å –∞–ª–µ—Ä—Ç—ã –ø—Ä–∏ –æ–±–Ω–∞—Ä—É–∂–µ–Ω–∏–∏ –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏—Ö —É—è–∑–≤–∏–º–æ—Å—Ç–µ–π

**–î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è:** –°–º. `docs/DEPENDENCY_UPDATES.md`

---

## üìù –ü–ª–∞–Ω –¥–µ–π—Å—Ç–≤–∏–π

### –ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç 1 (–ö—Ä–∏—Ç–∏—á–Ω–æ - —Å–¥–µ–ª–∞—Ç—å –Ω–µ–º–µ–¥–ª–µ–Ω–Ω–æ)
1. ‚úÖ –£–¥–∞–ª–∏—Ç—å `console.log` —Å —á—É–≤—Å—Ç–≤–∏—Ç–µ–ª—å–Ω—ã–º–∏ –¥–∞–Ω–Ω—ã–º–∏ - **–í–´–ü–û–õ–ù–ï–ù–û**
2. ‚úÖ –î–æ–±–∞–≤–∏—Ç—å Security Headers –≤ `next.config.js` - **–í–´–ü–û–õ–ù–ï–ù–û**
3. ‚úÖ –†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å Rate Limiting –¥–ª—è API routes - **–í–´–ü–û–õ–ù–ï–ù–û**
4. ‚ö†Ô∏è –£–ª—É—á—à–∏—Ç—å —Å–∏—Å—Ç–µ–º—É —Å–µ—Å—Å–∏–π (JWT –∏–ª–∏ Supabase Auth) - **–í –ü–†–û–¶–ï–°–°–ï**

### –ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç 2 (–í–∞–∂–Ω–æ - —Å–¥–µ–ª–∞—Ç—å –≤ –±–ª–∏–∂–∞–π—à–µ–µ –≤—Ä–µ–º—è)
5. ‚úÖ –î–æ–±–∞–≤–∏—Ç—å CORS middleware
6. ‚úÖ –î–æ–±–∞–≤–∏—Ç—å –≤–∞–ª–∏–¥–∞—Ü–∏—é –≤–æ –≤—Å–µ API routes
7. ‚úÖ –î–æ–±–∞–≤–∏—Ç—å —Å–∞–Ω–∏—Ç–∏–∑–∞—Ü–∏—é –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–æ–≥–æ –∫–æ–Ω—Ç–µ–Ω—Ç–∞
8. ‚úÖ –ù–∞—Å—Ç—Ä–æ–∏—Ç—å –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏

### –ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç 3 (–ñ–µ–ª–∞—Ç–µ–ª—å–Ω–æ)
9. ‚úÖ –†–µ–≥—É–ª—è—Ä–Ω—ã–π –∞—É–¥–∏—Ç –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π
10. ‚úÖ –ù–∞—Å—Ç—Ä–æ–∏—Ç—å –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ —Å–∫–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ —É—è–∑–≤–∏–º–æ—Å—Ç–µ–π
11. ‚úÖ –î–æ–∫—É–º–µ–Ω—Ç–∏—Ä–æ–≤–∞—Ç—å –ø–æ–ª–∏—Ç–∏–∫—É –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏

---

## üîê –ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è

### –¢–µ–∫—É—â–∏–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ
- `NEXT_PUBLIC_SUPABASE_URL` - –ø—É–±–ª–∏—á–Ω—ã–π URL (–±–µ–∑–æ–ø–∞—Å–Ω–æ)
- `NEXT_PUBLIC_SUPABASE_ANON_KEY` - –ø—É–±–ª–∏—á–Ω—ã–π –∫–ª—é—á (–±–µ–∑–æ–ø–∞—Å–Ω–æ, –Ω–æ –Ω—É–∂–Ω–æ –Ω–∞—Å—Ç—Ä–æ–∏—Ç—å RLS)
- `N8N_WEBHOOK_URL` - –ø—Ä–∏–≤–∞—Ç–Ω—ã–π URL (–¥–æ–ª–∂–µ–Ω –±—ã—Ç—å –≤ `.env.local`, –Ω–µ –≤ git)

### –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏
- ‚úÖ –í—Å–µ —Å–µ–∫—Ä–µ—Ç–Ω—ã–µ –∫–ª—é—á–∏ –¥–æ–ª–∂–Ω—ã –±—ã—Ç—å –≤ `.env.local` (—É–∂–µ –≤ `.gitignore`)
- ‚úÖ –ù–∏–∫–æ–≥–¥–∞ –Ω–µ –∫–æ–º–º–∏—Ç–∏—Ç—å `.env.local` –≤ git
- ‚úÖ –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å —Ä–∞–∑–Ω—ã–µ –∫–ª—é—á–∏ –¥–ª—è dev/staging/production
- ‚úÖ –†–æ—Ç–∞—Ü–∏—è –∫–ª—é—á–µ–π –∫–∞–∂–¥—ã–µ 90 –¥–Ω–µ–π

---

## üõ°Ô∏è Supabase Security

### ‚úÖ Row Level Security (RLS) - –ò–°–ü–†–ê–í–õ–ï–ù–û
**–°—Ç–∞—Ç—É—Å:** RLS –Ω–∞—Å—Ç—Ä–æ–µ–Ω –∏ —É–ª—É—á—à–µ–Ω –Ω–∞ –≤—Å–µ—Ö –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏—Ö —Ç–∞–±–ª–∏—Ü–∞—Ö

**–†–µ–∞–ª–∏–∑–æ–≤–∞–Ω–æ:**
- ‚úÖ RLS –≤–∫–ª—é—á–µ–Ω –Ω–∞ –≤—Å–µ—Ö —Ç–∞–±–ª–∏—Ü–∞—Ö —Å –ø—Ä–µ—Ñ–∏–∫—Å–æ–º `menohub_`
- ‚úÖ –£–ª—É—á—à–µ–Ω—ã –ø–æ–ª–∏—Ç–∏–∫–∏ –¥–ª—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏—Ö –¥–∞–Ω–Ω—ã—Ö (quiz_results, saved_content)
- ‚úÖ –û–≥—Ä–∞–Ω–∏—á–µ–Ω –¥–æ—Å—Ç—É–ø –∫ —á—É–≤—Å—Ç–≤–∏—Ç–µ–ª—å–Ω—ã–º –¥–∞–Ω–Ω—ã–º (auth_codes)
- ‚úÖ –£–ª—É—á—à–µ–Ω—ã –ø–æ–ª–∏—Ç–∏–∫–∏ –¥–ª—è forum —Ç–∞–±–ª–∏—Ü
- ‚úÖ –°–æ–∑–¥–∞–Ω–∞ helper —Ñ—É–Ω–∫—Ü–∏—è `check_rls_status()` –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ RLS —Å—Ç–∞—Ç—É—Å–∞

**–¢–∏–ø—ã –ø–æ–ª–∏—Ç–∏–∫:**
1. **Service Role Only** - —Å—Ç—Ä–æ–≥–∏–π –¥–æ—Å—Ç—É–ø —Ç–æ–ª—å–∫–æ —á–µ—Ä–µ–∑ API (service role)
   - `menohub_quiz_results` - —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã —Ç–µ—Å—Ç–æ–≤
   - `menohub_user_saved_content` - —Å–æ—Ö—Ä–∞–Ω–µ–Ω–Ω—ã–π –∫–æ–Ω—Ç–µ–Ω—Ç
   - `menohub_telegram_auth_codes` - –∫–æ–¥—ã –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏
   - `menohub_users` - –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏

2. **Public Read, Service Write** - –ø—É–±–ª–∏—á–Ω–æ–µ —á—Ç–µ–Ω–∏–µ, –∑–∞–ø–∏—Å—å —á–µ—Ä–µ–∑ API
   - `menohub_blog_posts` - —Å—Ç–∞—Ç—å–∏ –±–ª–æ–≥–∞
   - `menohub_video_content` - –≤–∏–¥–µ–æ –∫–æ–Ω—Ç–µ–Ω—Ç
   - `menohub_forum_*` - —Ñ–æ—Ä—É–º

**–ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏:**
- **–î–≤—É—Ö—É—Ä–æ–≤–Ω–µ–≤–∞—è –∑–∞—â–∏—Ç–∞:**
  1. API Level - –ø—Ä–æ–≤–µ—Ä–∫–∞ JWT —Å–µ—Å—Å–∏–π –≤ API routes
  2. Database Level - RLS –ø–æ–ª–∏—Ç–∏–∫–∏ –≤ Supabase (–¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–∞—è –∑–∞—â–∏—Ç–∞)

**–ú–∏–≥—Ä–∞—Ü–∏—è:**
- `supabase/migrations/022_improve_rls_policies.sql` - —É–ª—É—á—à–µ–Ω–∏–µ –≤—Å–µ—Ö RLS –ø–æ–ª–∏—Ç–∏–∫

**–ü—Ä–æ–≤–µ—Ä–∫–∞ —Å—Ç–∞—Ç—É—Å–∞:**
```sql
SELECT * FROM check_rls_status();
```

**–î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è:** –°–º. `docs/SUPABASE_RLS.md`

### API Keys
- `NEXT_PUBLIC_SUPABASE_ANON_KEY` - –±–µ–∑–æ–ø–∞—Å–µ–Ω –¥–ª—è –∫–ª–∏–µ–Ω—Ç–∞ (–Ω–æ—Ä–º–∞–ª—å–Ω–æ)
- Service Role Key - –ù–ò–ö–û–ì–î–ê –Ω–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –Ω–∞ –∫–ª–∏–µ–Ω—Ç–µ (—Ç–æ–ª—å–∫–æ –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ)

---

## üìö –†–µ—Å—É—Ä—Å—ã

- [OWASP Top 10](https://owasp.org/www-project-top-ten/)
- [Next.js Security Best Practices](https://nextjs.org/docs/app/building-your-application/configuring/security-headers)
- [Supabase Security](https://supabase.com/docs/guides/platform/security)
- [GDPR Compliance](https://gdpr.eu/)

---

## ‚úÖ –ß–µ–∫-–ª–∏—Å—Ç –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏

- [x] –£–¥–∞–ª–µ–Ω—ã console.log —Å —á—É–≤—Å—Ç–≤–∏—Ç–µ–ª—å–Ω—ã–º–∏ –¥–∞–Ω–Ω—ã–º–∏ - **–í–´–ü–û–õ–ù–ï–ù–û**
- [x] –î–æ–±–∞–≤–ª–µ–Ω—ã Security Headers - **–í–´–ü–û–õ–ù–ï–ù–û**
- [x] –†–µ–∞–ª–∏–∑–æ–≤–∞–Ω Rate Limiting - **–í–´–ü–û–õ–ù–ï–ù–û**
- [ ] –£–ª—É—á—à–µ–Ω–∞ —Å–∏—Å—Ç–µ–º–∞ —Å–µ—Å—Å–∏–π - **–í –ü–†–û–¶–ï–°–°–ï**
- [x] –î–æ–±–∞–≤–ª–µ–Ω CORS middleware - **–í–´–ü–û–õ–ù–ï–ù–û** (–≤ middleware.ts)
- [ ] –í–∞–ª–∏–¥–∞—Ü–∏—è –≤–æ –≤—Å–µ—Ö API routes - **–ß–ê–°–¢–ò–ß–ù–û** (–µ—Å—Ç—å –≤ newsletter, community)
- [ ] –°–∞–Ω–∏—Ç–∏–∑–∞—Ü–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–æ–≥–æ –∫–æ–Ω—Ç–µ–Ω—Ç–∞ - **–¢–†–ï–ë–£–ï–¢–°–Ø**
- [ ] –ù–∞—Å—Ç—Ä–æ–µ–Ω –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ - **–¢–†–ï–ë–£–ï–¢–°–Ø**
- [ ] –ü—Ä–æ–≤–µ—Ä–µ–Ω—ã RLS –ø–æ–ª–∏—Ç–∏–∫–∏ –≤ Supabase - **–¢–†–ï–ë–£–ï–¢–°–Ø**
- [ ] –ü—Ä–æ–≤–µ–¥–µ–Ω npm audit - **–†–ï–ö–û–ú–ï–ù–î–£–ï–¢–°–Ø**
- [x] –î–æ–∫—É–º–µ–Ω—Ç–∏—Ä–æ–≤–∞–Ω–∞ –ø–æ–ª–∏—Ç–∏–∫–∞ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏ - **–í–´–ü–û–õ–ù–ï–ù–û**

---

**–ü–æ—Å–ª–µ–¥–Ω–µ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ:** 2025-01-05

