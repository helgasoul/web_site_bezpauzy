# –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –∞–Ω–∞–ª–∏—Ç–∏–∫–∏ –¥–ª—è –∞–¥–º–∏–Ω-–ø–∞–Ω–µ–ª–∏

## üìä –û–±–∑–æ—Ä

–†–∞–∑–¥–µ–ª "–ê–Ω–∞–ª–∏—Ç–∏–∫–∞" –≤ –∞–¥–º–∏–Ω-–ø–∞–Ω–µ–ª–∏ —Å–æ–±–∏—Ä–∞–µ—Ç –¥–∞–Ω–Ω—ã–µ –∏–∑ –Ω–µ—Å–∫–æ–ª—å–∫–∏—Ö –∏—Å—Ç–æ—á–Ω–∏–∫–æ–≤:

1. **–í–Ω—É—Ç—Ä–µ–Ω–Ω—è—è –ë–î (Supabase)** - –¥–∞–Ω–Ω—ã–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π, –∑–∞–∫–∞–∑–æ–≤, –ø–æ–¥–ø–∏—Å—á–∏–∫–æ–≤ –∏ —Ç.–¥.
2. **Yandex.Metrica** - —Ç—Ä–∞—Ñ–∏–∫ —Å–∞–π—Ç–∞, –ø–æ–≤–µ–¥–µ–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
3. **Google Analytics 4** - –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –º–µ—Ç—Ä–∏–∫–∏ —Ç—Ä–∞—Ñ–∏–∫–∞

---

## üéØ –ß—Ç–æ —É–∂–µ —Ä–∞–±–æ—Ç–∞–µ—Ç –±–µ–∑ –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–æ–π –Ω–∞—Å—Ç—Ä–æ–π–∫–∏

- ‚úÖ –ù–æ–≤—ã–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏
- ‚úÖ –ó–∞–ø—Ä–æ—Å—ã –≤ AI-—á–∞—Ç
- ‚úÖ –ù–æ–≤—ã–µ –ø–æ–¥–ø–∏—Å—á–∏–∫–∏
- ‚úÖ –ó–∞–∫–∞–∑—ã –∫–Ω–∏–≥
- ‚úÖ –í—ã—Ä—É—á–∫–∞
- ‚úÖ –û–±—Ä–∞—â–µ–Ω–∏—è –≤ –ø–æ–¥–¥–µ—Ä–∂–∫—É
- ‚úÖ –ü—Ä–æ–π–¥–µ–Ω–Ω—ã–µ —Ç–µ—Å—Ç—ã
- ‚úÖ –ì—Ä–∞—Ñ–∏–∫–∏ —Ç—Ä–µ–Ω–¥–æ–≤

–≠—Ç–∏ –¥–∞–Ω–Ω—ã–µ –±–µ—Ä—É—Ç—Å—è –∏–∑ –ë–î –∏ —Ä–∞–±–æ—Ç–∞—é—Ç —Å—Ä–∞–∑—É –ø–æ—Å–ª–µ —É—Å—Ç–∞–Ω–æ–≤–∫–∏.

---

## üîß –ù–∞—Å—Ç—Ä–æ–π–∫–∞ Yandex.Metrica

### 1. –°–æ–∑–¥–∞–π—Ç–µ —Å—á–µ—Ç—á–∏–∫ Yandex.Metrica

1. –ü–µ—Ä–µ–π–¥–∏—Ç–µ –Ω–∞ https://metrika.yandex.ru/
2. –°–æ–∑–¥–∞–π—Ç–µ –Ω–æ–≤—ã–π —Å—á–µ—Ç—á–∏–∫ –¥–ª—è –≤–∞—à–µ–≥–æ —Å–∞–π—Ç–∞
3. –°–∫–æ–ø–∏—Ä—É–π—Ç–µ ID —Å—á–µ—Ç—á–∏–∫–∞ (–Ω–∞–ø—Ä–∏–º–µ—Ä, `12345678`)

### 2. –î–æ–±–∞–≤—å—Ç–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—É—é –æ–∫—Ä—É–∂–µ–Ω–∏—è

–í `.env.local`:

```bash
NEXT_PUBLIC_YANDEX_METRIKA_ID=12345678
```

### 3. –ü–æ–ª—É—á–∏—Ç–µ OAuth —Ç–æ–∫–µ–Ω –¥–ª—è API

–î–ª—è –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏ –≤ –∞–¥–º–∏–Ω-–ø–∞–Ω–µ–ª–∏ –Ω—É–∂–µ–Ω OAuth —Ç–æ–∫–µ–Ω:

1. –°–æ–∑–¥–∞–π—Ç–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –Ω–∞ https://oauth.yandex.ru/client/new
2. –í—ã–±–µ—Ä–∏—Ç–µ –ø—Ä–∞–≤–∞: `metrika:read`
3. –ü–æ–ª—É—á–∏—Ç–µ —Ç–æ–∫–µ–Ω –ø–æ —Å—Å—ã–ª–∫–µ:
```
https://oauth.yandex.ru/authorize?response_type=token&client_id=YOUR_CLIENT_ID
```
4. –î–æ–±–∞–≤—å—Ç–µ —Ç–æ–∫–µ–Ω –≤ `.env.local`:

```bash
YANDEX_METRICA_OAUTH_TOKEN=your_oauth_token_here
```

### 4. –£—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ —Å—á–µ—Ç—á–∏–∫ –Ω–∞ —Å–∞–π—Ç

–î–æ–±–∞–≤—å—Ç–µ –∫–æ–¥ —Å—á–µ—Ç—á–∏–∫–∞ –≤ `app/layout.tsx` (–µ—Å–ª–∏ –µ—â–µ –Ω–µ –¥–æ–±–∞–≤–ª–µ–Ω):

```tsx
{process.env.NEXT_PUBLIC_YANDEX_METRIKA_ID && (
  <Script id="yandex-metrika" strategy="afterInteractive">
    {`
      (function(m,e,t,r,i,k,a){m[i]=m[i]||function(){(m[i].a=m[i].a||[]).push(arguments)};
      m[i].l=1*new Date();k=e.createElement(t),a=e.getElementsByTagName(t)[0],k.async=1,k.src=r,a.parentNode.insertBefore(k,a)})
      (window, document, "script", "https://mc.yandex.ru/metrika/tag.js", "ym");

      ym(${process.env.NEXT_PUBLIC_YANDEX_METRIKA_ID}, "init", {
        clickmap:true,
        trackLinks:true,
        accurateTrackBounce:true,
        webvisor:true
      });
    `}
  </Script>
)}
```

---

## üîß –ù–∞—Å—Ç—Ä–æ–π–∫–∞ Google Analytics 4

### 1. –°–æ–∑–¥–∞–π—Ç–µ property –≤ GA4

1. –ü–µ—Ä–µ–π–¥–∏—Ç–µ –Ω–∞ https://analytics.google.com/
2. –°–æ–∑–¥–∞–π—Ç–µ –Ω–æ–≤—ã–π property (GA4)
3. –°–æ–∑–¥–∞–π—Ç–µ Data Stream –¥–ª—è –≤–∞—à–µ–≥–æ —Å–∞–π—Ç–∞
4. –°–∫–æ–ø–∏—Ä—É–π—Ç–µ Measurement ID (—Ñ–æ—Ä–º–∞—Ç: `G-XXXXXXXXXX`)

### 2. –î–æ–±–∞–≤—å—Ç–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—É—é –æ–∫—Ä—É–∂–µ–Ω–∏—è

–í `.env.local`:

```bash
NEXT_PUBLIC_GA_MEASUREMENT_ID=G-XXXXXXXXXX
```

### 3. –£—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ GA4 –Ω–∞ —Å–∞–π—Ç

–î–æ–±–∞–≤—å—Ç–µ –∫–æ–¥ –≤ `app/layout.tsx`:

```tsx
{process.env.NEXT_PUBLIC_GA_MEASUREMENT_ID && (
  <>
    <Script
      src={`https://www.googletagmanager.com/gtag/js?id=${process.env.NEXT_PUBLIC_GA_MEASUREMENT_ID}`}
      strategy="afterInteractive"
    />
    <Script id="google-analytics" strategy="afterInteractive">
      {`
        window.dataLayer = window.dataLayer || [];
        function gtag(){dataLayer.push(arguments);}
        gtag('js', new Date());
        gtag('config', '${process.env.NEXT_PUBLIC_GA_MEASUREMENT_ID}');
      `}
    </Script>
  </>
)}
```

### 4. (–û–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ) –ù–∞—Å—Ç—Ä–æ–π—Ç–µ GA4 Data API

–î–ª—è –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏ –≤ –∞–¥–º–∏–Ω-–ø–∞–Ω–µ–ª–∏:

1. –°–æ–∑–¥–∞–π—Ç–µ Service Account –≤ Google Cloud Console
2. –î–∞–π—Ç–µ –¥–æ—Å—Ç—É–ø –∫ GA4 property
3. –°–∫–∞—á–∞–π—Ç–µ JSON –∫–ª—é—á
4. –î–æ–±–∞–≤—å—Ç–µ –≤ `.env.local`:

```bash
GA4_SERVICE_ACCOUNT_KEY='{"type":"service_account",...}'
GA4_PROPERTY_ID=123456789
```

**–ü—Ä–∏–º–µ—á–∞–Ω–∏–µ:** –≠—Ç–æ –æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω—ã–π —à–∞–≥. –ë–µ–∑ –Ω–µ–≥–æ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ GA4 –Ω–µ –±—É–¥–µ—Ç –æ—Ç–æ–±—Ä–∞–∂–∞—Ç—å—Å—è –≤ –∞–¥–º–∏–Ω-–ø–∞–Ω–µ–ª–∏, –Ω–æ —Å–±–æ—Ä –¥–∞–Ω–Ω—ã—Ö –±—É–¥–µ—Ç —Ä–∞–±–æ—Ç–∞—Ç—å.

---

## üìà –ú–µ—Ç—Ä–∏–∫–∏ –∏–∑ –≤–Ω–µ—à–Ω–∏—Ö –∏—Å—Ç–æ—á–Ω–∏–∫–æ–≤

### Yandex.Metrica –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–ª—è–µ—Ç:
- üë• –í–∏–∑–∏—Ç—ã (ym:s:visits)
- üëÄ –ü—Ä–æ—Å–º–æ—Ç—Ä—ã —Å—Ç—Ä–∞–Ω–∏—Ü (ym:s:pageviews)
- üë§ –£–Ω–∏–∫–∞–ª—å–Ω—ã–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ (ym:s:users)
- üìä –ü–æ–≤–µ–¥–µ–Ω–∏–µ –Ω–∞ —Å–∞–π—Ç–µ
- üåç –ì–µ–æ–≥—Ä–∞—Ñ–∏—è
- üì± –£—Å—Ç—Ä–æ–π—Å—Ç–≤–∞

### Google Analytics 4 –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–ª—è–µ—Ç:
- üìä –°–µ—Å—Å–∏–∏ –∏ engagement
- üéØ –ö–æ–Ω–≤–µ—Ä—Å–∏–∏
- üìÑ –ü–æ–ø—É–ª—è—Ä–Ω—ã–µ —Å—Ç—Ä–∞–Ω–∏—Ü—ã
- üîÑ User journey
- üì± –ö—Ä–æ—Å—Å-–ø–ª–∞—Ç—Ñ–æ—Ä–º–µ–Ω–Ω–∞—è –∞–Ω–∞–ª–∏—Ç–∏–∫–∞

---

## üîç –î–æ—Å—Ç—É–ø –∫ –∞–Ω–∞–ª–∏—Ç–∏–∫–µ

**–†–æ–ª–∏ —Å –¥–æ—Å—Ç—É–ø–æ–º:**
- ‚úÖ super_admin - –ø–æ–ª–Ω—ã–π –¥–æ—Å—Ç—É–ø
- ‚úÖ analyst - –ø–æ–ª–Ω—ã–π –¥–æ—Å—Ç—É–ø (–µ—Å–ª–∏ –¥–æ–±–∞–≤–ª–µ–Ω–∞ —Ä–æ–ª—å)
- ‚úÖ content_manager - –ø—Ä–æ—Å–º–æ—Ç—Ä
- ‚úÖ order_manager - –ø—Ä–æ—Å–º–æ—Ç—Ä
- ‚úÖ support_manager - –ø—Ä–æ—Å–º–æ—Ç—Ä

**URL:** `/admin/analytics`

---

## üêõ Troubleshooting

### Yandex.Metrica –Ω–µ –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç –¥–∞–Ω–Ω—ã–µ

1. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ, —á—Ç–æ —Å—á–µ—Ç—á–∏–∫ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω –Ω–∞ —Å–∞–π—Ç–µ
2. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ `NEXT_PUBLIC_YANDEX_METRIKA_ID` –≤ `.env.local`
3. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ OAuth —Ç–æ–∫–µ–Ω `YANDEX_METRICA_OAUTH_TOKEN`
4. –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ –ø—Ä–æ—à–ª–æ –¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –≤—Ä–µ–º–µ–Ω–∏ –¥–ª—è —Å–±–æ—Ä–∞ –¥–∞–Ω–Ω—ã—Ö (24 —á–∞—Å–∞)

### Google Analytics –Ω–µ –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç –¥–∞–Ω–Ω—ã–µ

1. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ, —á—Ç–æ GA4 —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω –Ω–∞ —Å–∞–π—Ç–µ
2. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ `NEXT_PUBLIC_GA_MEASUREMENT_ID` –≤ `.env.local`
3. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –≤ GA4 ‚Üí Realtime, —á—Ç–æ —Å–æ–±—ã—Ç–∏—è –ø—Ä–∏—Ö–æ–¥—è—Ç
4. –î–ª—è API –¥–æ—Å—Ç—É–ø–∞ –ø—Ä–æ–≤–µ—Ä—å—Ç–µ Service Account –∏ –ø—Ä–∞–≤–∞

### –í–Ω—É—Ç—Ä–µ–Ω–Ω–∏–µ –º–µ—Ç—Ä–∏–∫–∏ –Ω–µ —Ä–∞–±–æ—Ç–∞—é—Ç

1. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ Supabase
2. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ `SUPABASE_SERVICE_ROLE_KEY` –≤ `.env.local`
3. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ª–æ–≥–∏ –≤ –∫–æ–Ω—Å–æ–ª–∏ –±—Ä–∞—É–∑–µ—Ä–∞
4. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ, —á—Ç–æ —Ç–∞–±–ª–∏—Ü—ã —Å—É—â–µ—Å—Ç–≤—É—é—Ç –≤ –ë–î

---

## üìö –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ —Ä–µ—Å—É—Ä—Å—ã

- [Yandex.Metrica API](https://yandex.ru/dev/metrika/doc/api2/concept/about.html)
- [Google Analytics 4 Data API](https://developers.google.com/analytics/devguides/reporting/data/v1)
- [Next.js Analytics](https://nextjs.org/docs/app/building-your-application/optimizing/analytics)
