# –§–∏–Ω–∞–ª—å–Ω–æ–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ: –†–µ–∑—É–ª—å—Ç–∞—Ç—ã –∫–≤–∏–∑–æ–≤ –∏ –¥—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π

## üîç –°–∏—Ç—É–∞—Ü–∏—è

–ò–∑-–∑–∞ –ø—Ä–æ–±–ª–µ–º—ã —Å –ø—Ä–∏–≤—è–∑–∫–æ–π Telegram —Å–æ–∑–¥–∞–ª–∏—Å—å –¥–≤–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è:
- **id: 111** - `username: helgasoul`, `telegram_id: 0` 
  - –°–æ–∑–¥–∞–Ω –ø—Ä–∏ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏ –Ω–∞ —Å–∞–π—Ç–µ
  - –≠—Ç–æ –≤–∞—à –æ—Å–Ω–æ–≤–Ω–æ–π –∞–∫–∫–∞—É–Ω—Ç –Ω–∞ —Å–∞–π—Ç–µ ‚úÖ
  
- **id: 110** - `username: NULL`, `telegram_id: 374683580`
  - –°–æ–∑–¥–∞–Ω –≤ Telegram –±–æ—Ç–µ –ø—Ä–∏ —Å–æ–≥–ª–∞—Å–∏–∏
  - –ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å –±–æ—Ç–æ–º

**–†–µ–∑—É–ª—å—Ç–∞—Ç –∫–≤–∏–∑–∞** —Å–æ—Ö—Ä–∞–Ω–µ–Ω —Å `user_id = NULL`, –ø–æ—ç—Ç–æ–º—É –Ω–µ —Å–≤—è–∑–∞–Ω –Ω–∏ —Å –æ–¥–Ω–∏–º –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–º.

## ‚úÖ –†–µ—à–µ–Ω–∏–µ

### –®–∞–≥ 1: –û–±–Ω–æ–≤–∏—Ç—å —Ä–µ–∑—É–ª—å—Ç–∞—Ç –∫–≤–∏–∑–∞ –Ω–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è id: 111

–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å `id: 111` (helgasoul) - —ç—Ç–æ –≤–∞—à –æ—Å–Ω–æ–≤–Ω–æ–π –∞–∫–∫–∞—É–Ω—Ç –Ω–∞ —Å–∞–π—Ç–µ, –ø–æ—ç—Ç–æ–º—É —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã –∫–≤–∏–∑–æ–≤ –¥–æ–ª–∂–Ω—ã –±—ã—Ç—å —Å–≤—è–∑–∞–Ω—ã —Å –Ω–∏–º.

```sql
-- –û–±–Ω–æ–≤–∏—Ç—å —Ä–µ–∑—É–ª—å—Ç–∞—Ç –∫–≤–∏–∑–∞ MRS
UPDATE menohub_quiz_results
SET user_id = 111
WHERE id = 'd6c2df50-1f99-44d3-abc1-fcb78aa1fd52'
  AND user_id IS NULL;

-- –û–±–Ω–æ–≤–∏—Ç—å –≤—Å–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã —Å NULL user_id –ø–æ –≤–∞—à–µ–º—É email
UPDATE menohub_quiz_results
SET user_id = 111
WHERE user_id IS NULL
  AND email = 'o.s.puchkova@icloud.com';
```

### –®–∞–≥ 2: –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Ä–µ–∑—É–ª—å—Ç–∞—Ç

```sql
SELECT 
    qr.id,
    qr.user_id,
    qr.test_type,
    qr.total_score,
    qr.severity,
    u.username,
    u.telegram_id,
    CASE 
        WHEN qr.user_id = u.id THEN 'MATCH ‚úÖ'
        ELSE 'MISMATCH ‚ùå'
    END as link_status
FROM menohub_quiz_results qr
LEFT JOIN menohub_users u ON qr.user_id = u.id
WHERE qr.user_id = 111
ORDER BY qr.created_at DESC;
```

### –®–∞–≥ 3: –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –≤ –ª–∏—á–Ω–æ–º –∫–∞–±–∏–Ω–µ—Ç–µ

1. –û–±–Ω–æ–≤–∏—Ç–µ —Å—Ç—Ä–∞–Ω–∏—Ü—É –ª–∏—á–Ω–æ–≥–æ –∫–∞–±–∏–Ω–µ—Ç–∞ (Ctrl+F5 –∏–ª–∏ Cmd+Shift+R)
2. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ, –æ—Ç–æ–±—Ä–∞–∂–∞–µ—Ç—Å—è –ª–∏ —Ä–µ–∑—É–ª—å—Ç–∞—Ç –∫–≤–∏–∑–∞ MRS
3. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É –≤ –¥–∞—à–±–æ—Ä–¥–µ

## üîß –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ø—Ä–æ–±–ª–µ–º—ã —Å –¥—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏–µ–º –≤ –±—É–¥—É—â–µ–º

–ß—Ç–æ–±—ã –≤ –±—É–¥—É—â–µ–º –Ω–µ —Å–æ–∑–¥–∞–≤–∞–ª–∏—Å—å –¥—É–±–ª–∏–∫–∞—Ç—ã –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π, –Ω—É–∂–Ω–æ –∏—Å–ø—Ä–∞–≤–∏—Ç—å n8n workflow:

### –ü—Ä–æ–±–ª–µ–º–∞ –≤ n8n workflow

–ü—Ä–∏ –ø—Ä–∏–≤—è–∑–∫–µ Telegram —á–µ—Ä–µ–∑ –∫–æ–¥ —Å–æ–∑–¥–∞–µ—Ç—Å—è –Ω–æ–≤—ã–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –≤–º–µ—Å—Ç–æ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è —Å—É—â–µ—Å—Ç–≤—É—é—â–µ–≥–æ.

### –†–µ—à–µ–Ω–∏–µ (—É–∂–µ –æ–ø–∏—Å–∞–Ω–æ –≤ docs/n8n-fix-duplicate-users.md)

1. **–ò—Å–ø—Ä–∞–≤–∏—Ç—å —É–∑–µ–ª "Update user telegram_id"**:
   - –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å `website_user_id` –∏–∑ —É–∑–ª–∞ "Get link code from DB"
   - –§–∏–ª—å—Ç—Ä: `id = {{ $('Get link code from DB').item.json.website_user_id }}`

2. **–î–æ–±–∞–≤–∏—Ç—å –ø—Ä–æ–≤–µ—Ä–∫—É –ø–µ—Ä–µ–¥ —Å–æ–∑–¥–∞–Ω–∏–µ–º**:
   - –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Å—É—â–µ—Å—Ç–≤–æ–≤–∞–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –ø–æ `website_user_id`
   - –ï—Å–ª–∏ –Ω–∞–π–¥–µ–Ω - –æ–±–Ω–æ–≤–∏—Ç—å `telegram_id`
   - –ï—Å–ª–∏ –Ω–µ –Ω–∞–π–¥–µ–Ω - —Å–æ–∑–¥–∞—Ç—å –Ω–æ–≤—ã–π (–Ω–æ —ç—Ç–æ –Ω–µ –¥–æ–ª–∂–Ω–æ –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç—å)

3. **–ò—Å–ø—Ä–∞–≤–∏—Ç—å –ª–æ–≥–∏–∫—É –ø—Ä–∏ —Å–æ–≥–ª–∞—Å–∏–∏**:
   - –ü—Ä–æ–≤–µ—Ä—è—Ç—å —Å—É—â–µ—Å—Ç–≤–æ–≤–∞–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –ø–µ—Ä–µ–¥ —Å–æ–∑–¥–∞–Ω–∏–µ–º
   - –ï—Å–ª–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å —Å—É—â–µ—Å—Ç–≤—É–µ—Ç –Ω–∞ —Å–∞–π—Ç–µ - –æ–±–Ω–æ–≤–ª—è—Ç—å, –∞ –Ω–µ —Å–æ–∑–¥–∞–≤–∞—Ç—å –Ω–æ–≤—ã–π

## üìã –ß–µ–∫–ª–∏—Å—Ç –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è

### –î–ª—è —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤ –∫–≤–∏–∑–æ–≤ (—Å–¥–µ–ª–∞—Ç—å —Å–µ–π—á–∞—Å):

- [ ] –ü—Ä–∏–º–µ–Ω–∏—Ç—å –º–∏–≥—Ä–∞—Ü–∏—é 014 (–∏–∑–º–µ–Ω–∏—Ç—å —Ç–∏–ø user_id –Ω–∞ bigint)
- [ ] –û–±–Ω–æ–≤–∏—Ç—å —Ä–µ–∑—É–ª—å—Ç–∞—Ç –∫–≤–∏–∑–∞, —É—Å—Ç–∞–Ω–æ–≤–∏–≤ `user_id = 111`
- [ ] –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –≤ –ª–∏—á–Ω–æ–º –∫–∞–±–∏–Ω–µ—Ç–µ, —á—Ç–æ —Ä–µ–∑—É–ª—å—Ç–∞—Ç –æ—Ç–æ–±—Ä–∞–∂–∞–µ—Ç—Å—è

### –î–ª—è n8n workflow (–∏—Å–ø—Ä–∞–≤–∏—Ç—å –≤ –±—É–¥—É—â–µ–º):

- [ ] –ò—Å–ø—Ä–∞–≤–∏—Ç—å —É–∑–µ–ª "Update user telegram_id" –≤ n8n
- [ ] –î–æ–±–∞–≤–∏—Ç—å –ø—Ä–æ–≤–µ—Ä–∫—É —Å—É—â–µ—Å—Ç–≤–æ–≤–∞–Ω–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –ø–µ—Ä–µ–¥ —Å–æ–∑–¥–∞–Ω–∏–µ–º
- [ ] –ü—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å –ø—Ä–∏–≤—è–∑–∫—É Telegram, —á—Ç–æ–±—ã –Ω–µ —Å–æ–∑–¥–∞–≤–∞–ª–∏—Å—å –¥—É–±–ª–∏–∫–∞—Ç—ã

## üí° –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏

1. **–ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è id: 111** –¥–ª—è –≤—Å–µ—Ö —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤ –∫–≤–∏–∑–æ–≤ –Ω–∞ —Å–∞–π—Ç–µ
2. **–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å id: 110** –æ—Å—Ç–∞–≤—å—Ç–µ –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å Telegram –±–æ—Ç–æ–º (–µ—Å–ª–∏ –æ–Ω –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è)
3. **–ò—Å–ø—Ä–∞–≤—å—Ç–µ n8n workflow**, —á—Ç–æ–±—ã –≤ –±—É–¥—É—â–µ–º –Ω–µ —Å–æ–∑–¥–∞–≤–∞–ª–∏—Å—å –¥—É–±–ª–∏–∫–∞—Ç—ã
4. **–†–∞—Å—Å–º–æ—Ç—Ä–∏—Ç–µ –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å –æ–±—ä–µ–¥–∏–Ω–µ–Ω–∏—è** –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π, –µ—Å–ª–∏ –æ–±–∞ –∏—Å–ø–æ–ª—å–∑—É—é—Ç—Å—è –¥–ª—è –æ–¥–Ω–æ–≥–æ –∏ —Ç–æ–≥–æ –∂–µ

## üîÑ –ï—Å–ª–∏ –Ω—É–∂–Ω–æ –æ–±—ä–µ–¥–∏–Ω–∏—Ç—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π

–ï—Å–ª–∏ –æ–±–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –∏—Å–ø–æ–ª—å–∑—É—é—Ç—Å—è –∏ –Ω—É–∂–Ω–æ –æ–±—ä–µ–¥–∏–Ω–∏—Ç—å –∏—Ö:

```sql
-- 1. –û–±–Ω–æ–≤–∏—Ç—å telegram_id –≤ –æ—Å–Ω–æ–≤–Ω–æ–º –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ (id: 111)
UPDATE menohub_users
SET telegram_id = 374683580
WHERE id = 111
  AND telegram_id = 0;

-- 2. –û–±–Ω–æ–≤–∏—Ç—å –≤—Å–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã –Ω–∞ –æ—Å–Ω–æ–≤–Ω–æ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è (—É–∂–µ —Å–¥–µ–ª–∞–Ω–æ –≤—ã—à–µ)

-- 3. (–û–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ) –£–¥–∞–ª–∏—Ç—å –¥—É–±–ª–∏–∫–∞—Ç, –µ—Å–ª–∏ –æ–Ω –±–æ–ª—å—à–µ –Ω–µ –Ω—É–∂–µ–Ω
-- –í–ù–ò–ú–ê–ù–ò–ï: –£–¥–∞–ª–µ–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è —É–¥–∞–ª–∏—Ç –≤—Å–µ —Å–≤—è–∑–∞–Ω–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ!
-- DELETE FROM menohub_users WHERE id = 110;
```

## ‚úÖ –ü–æ—Å–ª–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è

–ü–æ—Å–ª–µ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è –≤—Å–µ—Ö —à–∞–≥–æ–≤:
- ‚úÖ –†–µ–∑—É–ª—å—Ç–∞—Ç—ã –∫–≤–∏–∑–æ–≤ –±—É–¥—É—Ç —Å–≤—è–∑–∞–Ω—ã —Å –ø—Ä–∞–≤–∏–ª—å–Ω—ã–º –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–º (id: 111)
- ‚úÖ –†–µ–∑—É–ª—å—Ç–∞—Ç—ã –±—É–¥—É—Ç –æ—Ç–æ–±—Ä–∞–∂–∞—Ç—å—Å—è –≤ –ª–∏—á–Ω–æ–º –∫–∞–±–∏–Ω–µ—Ç–µ
- ‚úÖ –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –≤ –¥–∞—à–±–æ—Ä–¥–µ –±—É–¥–µ—Ç –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ–π
- ‚úÖ –í –±—É–¥—É—â–µ–º –Ω–µ –±—É–¥—É—Ç —Å–æ–∑–¥–∞–≤–∞—Ç—å—Å—è –¥—É–±–ª–∏–∫–∞—Ç—ã –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π (–ø–æ—Å–ª–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è n8n)

