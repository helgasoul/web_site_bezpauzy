# –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ø—Ä–æ–±–ª–µ–º—ã —Å –¥—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏–µ–º –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π –∏ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞–º–∏ –∫–≤–∏–∑–æ–≤

## üîç –ü—Ä–æ–±–ª–µ–º–∞

–ò–∑-–∑–∞ –ø—Ä–æ–±–ª–µ–º—ã —Å –ø—Ä–∏–≤—è–∑–∫–æ–π Telegram —Å–æ–∑–¥–∞–ª–∏—Å—å –¥–≤–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è:
- **id: 111** - `username: helgasoul`, `telegram_id: 0` (—Å–æ–∑–¥–∞–Ω –ø—Ä–∏ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏ –Ω–∞ —Å–∞–π—Ç–µ)
- **id: 110** - `username: NULL`, `telegram_id: 374683580` (—Å–æ–∑–¥–∞–Ω –ø—Ä–∏ –ø—Ä–∏–≤—è–∑–∫–µ Telegram)

–†–µ–∑—É–ª—å—Ç–∞—Ç –∫–≤–∏–∑–∞ —Å–æ—Ö—Ä–∞–Ω–µ–Ω —Å `user_id = NULL`, –ø–æ—ç—Ç–æ–º—É –Ω–µ —Å–≤—è–∑–∞–Ω –Ω–∏ —Å –æ–¥–Ω–∏–º –∏–∑ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π.

## üí° –†–µ—à–µ–Ω–∏–µ

### –í–∞—Ä–∏–∞–Ω—Ç 1: –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è —Å username (—Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è)

–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å `id: 111` (helgasoul) - —ç—Ç–æ –≤–∞—à –æ—Å–Ω–æ–≤–Ω–æ–π –∞–∫–∫–∞—É–Ω—Ç –Ω–∞ —Å–∞–π—Ç–µ.

**–®–∞–≥ 1: –û–±–Ω–æ–≤–∏—Ç—å —Ä–µ–∑—É–ª—å—Ç–∞—Ç –∫–≤–∏–∑–∞ –Ω–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è id: 111**

```sql
UPDATE menohub_quiz_results
SET user_id = 111
WHERE id = 'd6c2df50-1f99-44d3-abc1-fcb78aa1fd52'
  AND user_id IS NULL;
```

**–®–∞–≥ 2: –û–±–Ω–æ–≤–∏—Ç—å –≤—Å–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã —Å NULL user_id –ø–æ email**

```sql
UPDATE menohub_quiz_results
SET user_id = 111
WHERE user_id IS NULL
  AND email = 'o.s.puchkova@icloud.com';
```

**–®–∞–≥ 3: (–û–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ) –û–±—ä–µ–¥–∏–Ω–∏—Ç—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π**

–ï—Å–ª–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å `id: 110` –±–æ–ª—å—à–µ –Ω–µ –Ω—É–∂–µ–Ω, –º–æ–∂–Ω–æ:
- –û—Å—Ç–∞–≤–∏—Ç—å –µ–≥–æ –∫–∞–∫ –µ—Å—Ç—å (–µ—Å–ª–∏ –æ–Ω –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –≤ Telegram –±–æ—Ç–µ)
- –ò–ª–∏ —É–¥–∞–ª–∏—Ç—å, –µ—Å–ª–∏ –æ–Ω –¥—É–±–ª–∏–∫–∞—Ç

### –í–∞—Ä–∏–∞–Ω—Ç 2: –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è —Å telegram_id

–ï—Å–ª–∏ –≤—ã —Ö–æ—Ç–∏—Ç–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è `id: 110` (—Å telegram_id: 374683580):

**–®–∞–≥ 1: –û–±–Ω–æ–≤–∏—Ç—å —Ä–µ–∑—É–ª—å—Ç–∞—Ç –∫–≤–∏–∑–∞**

```sql
UPDATE menohub_quiz_results
SET user_id = 110
WHERE id = 'd6c2df50-1f99-44d3-abc1-fcb78aa1fd52'
  AND user_id IS NULL;
```

**–®–∞–≥ 2: –û–±–Ω–æ–≤–∏—Ç—å username –¥–ª—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è id: 110**

```sql
UPDATE menohub_users
SET username = 'helgasoul'
WHERE id = 110
  AND username IS NULL;
```

## üîß –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ø—Ä–æ–±–ª–µ–º—ã —Å –¥—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏–µ–º –≤ –±—É–¥—É—â–µ–º

–ß—Ç–æ–±—ã –∏–∑–±–µ–∂–∞—Ç—å —Å–æ–∑–¥–∞–Ω–∏—è –¥—É–±–ª–∏–∫–∞—Ç–æ–≤ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π –ø—Ä–∏ –ø—Ä–∏–≤—è–∑–∫–µ Telegram:

### 1. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å n8n workflow

–í n8n workflow –ø—Ä–∏ –æ–±—Ä–∞–±–æ—Ç–∫–µ –∫–æ–º–∞–Ω–¥—ã `/start link_CODE` –Ω—É–∂–Ω–æ:
- –ü—Ä–æ–≤–µ—Ä–∏—Ç—å, —Å—É—â–µ—Å—Ç–≤—É–µ—Ç –ª–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å —Å —Ç–∞–∫–∏–º `telegram_id`
- –ï—Å–ª–∏ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç - –æ–±–Ω–æ–≤–∏—Ç—å –µ–≥–æ, –∞ –Ω–µ —Å–æ–∑–¥–∞–≤–∞—Ç—å –Ω–æ–≤–æ–≥–æ
- –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å `website_user_id` –∏–∑ —Ç–∞–±–ª–∏—Ü—ã `menohub_telegram_auth_codes`

### 2. –û–±–Ω–æ–≤–∏—Ç—å API endpoint –¥–ª—è –ø—Ä–∏–≤—è–∑–∫–∏ Telegram

–í `app/api/auth/link-telegram/generate-code/route.ts` —É–∂–µ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è `website_user_id`, —ç—Ç–æ –ø—Ä–∞–≤–∏–ª—å–Ω–æ.

### 3. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ª–æ–≥–∏–∫—É –≤ n8n

–£–±–µ–¥–∏—Ç—å—Å—è, —á—Ç–æ –≤ n8n workflow:
- –ü—Ä–∏ –ø–æ–ª—É—á–µ–Ω–∏–∏ `link_CODE` —Å–Ω–∞—á–∞–ª–∞ –ø—Ä–æ–≤–µ—Ä—è–µ—Ç—Å—è —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å
- –ï—Å–ª–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –Ω–∞–π–¥–µ–Ω –ø–æ `website_user_id` - –æ–±–Ω–æ–≤–ª—è–µ—Ç—Å—è –µ–≥–æ `telegram_id`
- –ï—Å–ª–∏ –Ω–µ –Ω–∞–π–¥–µ–Ω - —Å–æ–∑–¥–∞–µ—Ç—Å—è –Ω–æ–≤—ã–π (–Ω–æ —ç—Ç–æ –¥–æ–ª–∂–Ω–æ –±—ã—Ç—å —Ä–µ–¥–∫–æ)

## ‚úÖ –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø–æ—Å–ª–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è

### 1. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Å–≤—è–∑—å —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞ —Å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–º

```sql
SELECT 
    qr.id,
    qr.user_id,
    qr.test_type,
    qr.total_score,
    u.id as user_id_from_users,
    u.username,
    u.telegram_id,
    CASE 
        WHEN qr.user_id = u.id THEN 'MATCH ‚úÖ'
        ELSE 'MISMATCH ‚ùå'
    END as link_status
FROM menohub_quiz_results qr
LEFT JOIN menohub_users u ON qr.user_id = u.id
WHERE qr.id = 'd6c2df50-1f99-44d3-abc1-fcb78aa1fd52';
```

### 2. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π

```sql
SELECT 
    u.id,
    u.username,
    u.telegram_id,
    COUNT(qr.id) as quiz_count
FROM menohub_users u
LEFT JOIN menohub_quiz_results qr ON u.id = qr.user_id
WHERE u.id IN (110, 111)
GROUP BY u.id, u.username, u.telegram_id;
```

**–û–∂–∏–¥–∞–µ–º—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç:**
- –£ –æ–¥–Ω–æ–≥–æ –∏–∑ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π `quiz_count` –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å `1` (–∏–ª–∏ –±–æ–ª—å—à–µ)
- –£ –¥—Ä—É–≥–æ–≥–æ –º–æ–∂–µ—Ç –æ—Å—Ç–∞—Ç—å—Å—è `0` (–µ—Å–ª–∏ –æ–Ω –Ω–µ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è)

### 3. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –≤ –ª–∏—á–Ω–æ–º –∫–∞–±–∏–Ω–µ—Ç–µ

1. –û–±–Ω–æ–≤–∏—Ç–µ —Å—Ç—Ä–∞–Ω–∏—Ü—É –ª–∏—á–Ω–æ–≥–æ –∫–∞–±–∏–Ω–µ—Ç–∞ (Ctrl+F5)
2. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ, –æ—Ç–æ–±—Ä–∞–∂–∞–µ—Ç—Å—è –ª–∏ —Ä–µ–∑—É–ª—å—Ç–∞—Ç –∫–≤–∏–∑–∞ MRS
3. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É –≤ –¥–∞—à–±–æ—Ä–¥–µ

## üìù –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏

1. **–ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è id: 111** (helgasoul) –∫–∞–∫ –æ—Å–Ω–æ–≤–Ω–æ–π
2. **–û–±–Ω–æ–≤–∏—Ç–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç –∫–≤–∏–∑–∞** –Ω–∞ —ç—Ç–æ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
3. **–ü—Ä–æ–≤–µ—Ä—å—Ç–µ n8n workflow**, —á—Ç–æ–±—ã –≤ –±—É–¥—É—â–µ–º –Ω–µ —Å–æ–∑–¥–∞–≤–∞–ª–∏—Å—å –¥—É–±–ª–∏–∫–∞—Ç—ã
4. **–†–∞—Å—Å–º–æ—Ç—Ä–∏—Ç–µ –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å –æ–±—ä–µ–¥–∏–Ω–µ–Ω–∏—è** –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π, –µ—Å–ª–∏ –æ–±–∞ –∏—Å–ø–æ–ª—å–∑—É—é—Ç—Å—è

## üîÑ –ï—Å–ª–∏ –Ω—É–∂–Ω–æ –æ–±—ä–µ–¥–∏–Ω–∏—Ç—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π

–ï—Å–ª–∏ –æ–±–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –∏—Å–ø–æ–ª—å–∑—É—é—Ç—Å—è –∏ –Ω—É–∂–Ω–æ –æ–±—ä–µ–¥–∏–Ω–∏—Ç—å –∏—Ö –¥–∞–Ω–Ω—ã–µ:

1. –û–±–Ω–æ–≤–∏—Ç—å –≤—Å–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã –Ω–∞ –æ–¥–Ω–æ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è (–Ω–∞–ø—Ä–∏–º–µ—Ä, id: 111)
2. –û–±–Ω–æ–≤–∏—Ç—å telegram_id –≤ –æ—Å–Ω–æ–≤–Ω–æ–º –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ:
   ```sql
   UPDATE menohub_users
   SET telegram_id = 374683580
   WHERE id = 111
     AND telegram_id = 0;
   ```
3. –£–¥–∞–ª–∏—Ç—å –¥—É–±–ª–∏–∫–∞—Ç (–µ—Å–ª–∏ –Ω–µ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è):
   ```sql
   -- –í–ù–ò–ú–ê–ù–ò–ï: –£–¥–∞–ª–µ–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è —É–¥–∞–ª–∏—Ç –≤—Å–µ —Å–≤—è–∑–∞–Ω–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ!
   -- DELETE FROM menohub_users WHERE id = 110;
   ```

