# –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ –ø–ª–∞—Ç–Ω–æ–≥–æ –≥–∞–π–¥–∞ (EPUB)

## üìã –û–±–∑–æ—Ä

–ü–ª–∞—Ç–Ω—ã–π –≥–∞–π–¥ "–ü—Ä–æ—Ç–∏–≤–æ–≤–æ—Å–ø–∞–ª–∏—Ç–µ–ª—å–Ω–æ–µ –ø–∏—Ç–∞–Ω–∏–µ" –∑–∞ 399‚ÇΩ —Å –≥–µ–Ω–µ—Ä–∞—Ü–∏–µ–π —É–Ω–∏–∫–∞–ª—å–Ω–æ–π —Å—Å—ã–ª–∫–∏ –¥–ª—è —Å–∫–∞—á–∏–≤–∞–Ω–∏—è EPUB –ø–æ—Å–ª–µ –æ–ø–ª–∞—Ç—ã.

---

## ‚úÖ –†–µ—à–µ–Ω–∏—è (—É—Ç–≤–µ—Ä–∂–¥–µ–Ω–æ)

1. **–°—Ä–æ–∫ –¥–µ–π—Å—Ç–≤–∏—è —Å—Å—ã–ª–∫–∏:** 30 –¥–Ω–µ–π (—É–∫–∞–∑–∞–Ω–æ –≤ –æ—Ñ–µ—Ä—Ç–µ)
2. **–õ–∏–º–∏—Ç —Å–∫–∞—á–∏–≤–∞–Ω–∏–π:** 3 —Ä–∞–∑–∞
3. **–í–æ–∑–≤—Ä–∞—Ç —Å—Ä–µ–¥—Å—Ç–≤:** –ù–µ –ø—Ä–µ–¥—É—Å–º–æ—Ç—Ä–µ–Ω (—Å–æ–≥–ª–∞—Å–Ω–æ –∑–∞–∫–æ–Ω–æ–¥–∞—Ç–µ–ª—å—Å—Ç–≤—É –†–§ –æ —Ü–∏—Ñ—Ä–æ–≤—ã—Ö —Ç–æ–≤–∞—Ä–∞—Ö)
4. **Watermarking:** –î–∞, –¥–æ–±–∞–≤–ª—è–µ–º –≤ –º–µ—Ç–∞–¥–∞–Ω–Ω—ã–µ EPUB (—Å–º. `docs/EPUB_WATERMARKING.md`)
   - –£–Ω–∏–∫–∞–ª—å–Ω—ã–π purchase_id
   - –•–µ—à email –ø–æ–∫—É–ø–∞—Ç–µ–ª—è (SHA-256)
   - –î–∞—Ç–∞ –ø–æ–∫—É–ø–∫–∏
   - –ì–µ–Ω–µ—Ä–∞—Ü–∏—è –ø–µ—Ä—Å–æ–Ω–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω–æ–≥–æ EPUB –Ω–∞ –ª–µ—Ç—É –ø—Ä–∏ —Å–∫–∞—á–∏–≤–∞–Ω–∏–∏
5. **–•—Ä–∞–Ω–µ–Ω–∏–µ EPUB:** Supabase Storage
6. **–û—Ñ–µ—Ä—Ç–∞:** –®–∞–±–ª–æ–Ω —Å–æ–∑–¥–∞–Ω (—Å–º. `docs/OFFER_TEMPLATE.md`)
   - –¢—Ä–µ–±—É–µ—Ç –∑–∞–ø–æ–ª–Ω–µ–Ω–∏—è —Ä–µ–∫–≤–∏–∑–∏—Ç–æ–≤ –∫–æ–º–ø–∞–Ω–∏–∏
   - –¢—Ä–µ–±—É–µ—Ç —é—Ä–∏–¥–∏—á–µ—Å–∫–æ–π –ø—Ä–æ–≤–µ—Ä–∫–∏
   - –†–∞–∑–º–µ—â–µ–Ω–∏–µ –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü–µ `/legal/offer`

---

## üéØ –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏–π —Å—Ü–µ–Ω–∞—Ä–∏–π (User Flow)

```
1. –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –≤–∏–¥–∏—Ç –≥–∞–π–¥ –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü–µ /resources/guides
   ‚Üì
2. –í–∏–¥–∏—Ç –∫–Ω–æ–ø–∫—É "–ö—É–ø–∏—Ç—å –∑–∞ 399‚ÇΩ" (–≤–º–µ—Å—Ç–æ "–°–∫–∞—á–∞—Ç—å")
   ‚Üì
3. –ö–ª–∏–∫–∞–µ—Ç "–ö—É–ø–∏—Ç—å" ‚Üí –æ—Ç–∫—Ä—ã–≤–∞–µ—Ç—Å—è –º–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ/—Å—Ç—Ä–∞–Ω–∏—Ü–∞ —Å:
   - –ù–∞–∑–≤–∞–Ω–∏–µ –≥–∞–π–¥–∞
   - –¶–µ–Ω–∞: 399‚ÇΩ
   - –ß–µ–∫–±–æ–∫—Å: "–Ø —Å–æ–≥–ª–∞—Å–µ–Ω —Å –æ—Ñ–µ—Ä—Ç–æ–π" (–æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ)
   - –°—Å—ã–ª–∫–∞ –Ω–∞ –æ—Ñ–µ—Ä—Ç—É (–æ—Ç–∫—Ä—ã–≤–∞–µ—Ç—Å—è –≤ –Ω–æ–≤–æ–π –≤–∫–ª–∞–¥–∫–µ)
   - –ü–æ–ª–µ Email (–æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ)
   - –ü–æ–ª–µ –ò–º—è (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)
   ‚Üì
4. –ó–∞–ø–æ–ª–Ω—è–µ—Ç —Ñ–æ—Ä–º—É, —Å—Ç–∞–≤–∏—Ç –≥–∞–ª–æ—á–∫—É, –Ω–∞–∂–∏–º–∞–µ—Ç "–û–ø–ª–∞—Ç–∏—Ç—å"
   ‚Üì
5. –°–æ–∑–¥–∞–µ—Ç—Å—è –∑–∞–∫–∞–∑ –≤ –ë–î (—Å—Ç–∞—Ç—É—Å: pending)
   ‚Üì
6. –†–µ–¥–∏—Ä–µ–∫—Ç –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü—É –æ–ø–ª–∞—Ç—ã –Æ–ö–∞—Å—Å–∞
   ‚Üì
7. –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –æ–ø–ª–∞—á–∏–≤–∞–µ—Ç –Ω–∞ –Æ–ö–∞—Å—Å–∞
   ‚Üì
8. –Æ–ö–∞—Å—Å–∞ –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç webhook –Ω–∞ –Ω–∞—à —Å–µ—Ä–≤–µ—Ä
   ‚Üì
9. –ú—ã –æ–±–Ω–æ–≤–ª—è–µ–º —Å—Ç–∞—Ç—É—Å –∑–∞–∫–∞–∑–∞ (paid)
   ‚Üì
10. –ì–µ–Ω–µ—Ä–∏—Ä—É–µ–º —É–Ω–∏–∫–∞–ª—å–Ω—É—é —Å—Å—ã–ª–∫—É –¥–ª—è —Å–∫–∞—á–∏–≤–∞–Ω–∏—è:
    - UUID —Ç–æ–∫–µ–Ω (–Ω–∞–ø—Ä–∏–º–µ—Ä: abc123-def456-ghi789)
    - –°–æ—Ö—Ä–∞–Ω—è–µ–º –≤ –ë–î: resource_purchases.download_token
    - –°—Ä–æ–∫ –¥–µ–π—Å—Ç–≤–∏—è: 30 –¥–Ω–µ–π
    ‚Üì
11. –†–µ–¥–∏—Ä–µ–∫—Ç –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü—É —É—Å–ø–µ—à–Ω–æ–π –æ–ø–ª–∞—Ç—ã:
    - "–°–ø–∞—Å–∏–±–æ –∑–∞ –ø–æ–∫—É–ø–∫—É!"
    - –ö–Ω–æ–ø–∫–∞ "–°–∫–∞—á–∞—Ç—å –≥–∞–π–¥" (—Å —É–Ω–∏–∫–∞–ª—å–Ω–æ–π —Å—Å—ã–ª–∫–æ–π)
    - Email –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç—Å—è —Å —Å—Å—ã–ª–∫–æ–π –Ω–∞ —Å–∫–∞—á–∏–≤–∞–Ω–∏–µ
    ‚Üì
12. –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –∫–ª–∏–∫–∞–µ—Ç "–°–∫–∞—á–∞—Ç—å" –∏–ª–∏ –ø–µ—Ä–µ—Ö–æ–¥–∏—Ç –ø–æ —Å—Å—ã–ª–∫–µ –∏–∑ email
   ‚Üì
13. –ü—Ä–æ–≤–µ—Ä—è–µ–º —Ç–æ–∫–µ–Ω –≤ –ë–î:
    - –ï—Å–ª–∏ –≤–∞–ª–∏–¥–Ω—ã–π ‚Üí –≥–µ–Ω–µ—Ä–∏—Ä—É–µ–º –ø–µ—Ä—Å–æ–Ω–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã–π EPUB (—Å watermark)
    - –ï—Å–ª–∏ –Ω–µ–≤–∞–ª–∏–¥–Ω—ã–π/–∏—Å—Ç–µ–∫ ‚Üí –ø–æ–∫–∞–∑—ã–≤–∞–µ–º –æ—à–∏–±–∫—É
    ‚Üì
14. –ü–æ—Å–ª–µ —Å–∫–∞—á–∏–≤–∞–Ω–∏—è:
    - –£–≤–µ–ª–∏—á–∏–≤–∞–µ–º download_count
    - –ü—Ä–æ–≤–µ—Ä—è–µ–º –ª–∏–º–∏—Ç (–º–∞–∫—Å–∏–º—É–º 3 —Ä–∞–∑–∞)
```

---

## üóÑÔ∏è –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö

### 1. –†–∞—Å—à–∏—Ä–µ–Ω–∏–µ —Ç–∞–±–ª–∏—Ü—ã `menohub_resources`

```sql
ALTER TABLE menohub_resources ADD COLUMN IF NOT EXISTS is_paid BOOLEAN DEFAULT FALSE;
ALTER TABLE menohub_resources ADD COLUMN IF NOT EXISTS price_kopecks INTEGER; -- 39900 = 399‚ÇΩ
ALTER TABLE menohub_resources ADD COLUMN IF NOT EXISTS epub_file_path TEXT; -- –ü—É—Ç—å –∫ EPUB –≤ Supabase Storage
ALTER TABLE menohub_resources ADD COLUMN IF NOT EXISTS download_limit INTEGER DEFAULT 3; -- –õ–∏–º–∏—Ç —Å–∫–∞—á–∏–≤–∞–Ω–∏–π
```

### 2. –ù–æ–≤–∞—è —Ç–∞–±–ª–∏—Ü–∞ `menohub_resource_purchases`

```sql
CREATE TABLE menohub_resource_purchases (
    id UUID PRIMARY KEY DEFAULT uuid_generate_v4(),
    resource_id UUID NOT NULL REFERENCES menohub_resources(id) ON DELETE CASCADE,
    
    -- –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ –ø–æ–∫—É–ø–∞—Ç–µ–ª–µ
    email TEXT NOT NULL,
    name TEXT,
    user_id BIGINT REFERENCES menohub_users(id), -- –ï—Å–ª–∏ –∑–∞–ª–æ–≥–∏–Ω–µ–Ω —á–µ—Ä–µ–∑ Telegram
    
    -- –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ –ø–ª–∞—Ç–µ–∂–µ
    amount_kopecks INTEGER NOT NULL, -- 39900 = 399‚ÇΩ
    yookassa_payment_id TEXT UNIQUE, -- ID –ø–ª–∞—Ç–µ–∂–∞ –≤ –Æ–ö–∞—Å—Å–∞
    status TEXT NOT NULL DEFAULT 'pending', -- 'pending', 'paid', 'cancelled', 'refunded'
    
    -- –£–Ω–∏–∫–∞–ª—å–Ω–∞—è —Å—Å—ã–ª–∫–∞ –¥–ª—è —Å–∫–∞—á–∏–≤–∞–Ω–∏—è
    download_token TEXT UNIQUE NOT NULL, -- UUID —Ç–æ–∫–µ–Ω –¥–ª—è —Å—Å—ã–ª–∫–∏
    download_token_expires_at TIMESTAMPTZ NOT NULL, -- –°—Ä–æ–∫ –¥–µ–π—Å—Ç–≤–∏—è (30 –¥–Ω–µ–π)
    download_count INTEGER DEFAULT 0, -- –°–∫–æ–ª—å–∫–æ —Ä–∞–∑ —Å–∫–∞—á–∞–ª–∏
    max_downloads INTEGER DEFAULT 3, -- –ú–∞–∫—Å–∏–º—É–º —Å–∫–∞—á–∏–≤–∞–Ω–∏–π
    
    -- Timestamps
    created_at TIMESTAMPTZ DEFAULT NOW(),
    paid_at TIMESTAMPTZ,
    first_downloaded_at TIMESTAMPTZ,
    last_downloaded_at TIMESTAMPTZ,
    
    -- –ú–µ—Ç–∞–¥–∞–Ω–Ω—ã–µ
    metadata JSONB -- –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è (IP, user agent, etc.)
);

-- –ò–Ω–¥–µ–∫—Å—ã
CREATE INDEX idx_resource_purchases_resource_id ON menohub_resource_purchases(resource_id);
CREATE INDEX idx_resource_purchases_email ON menohub_resource_purchases(email);
CREATE INDEX idx_resource_purchases_user_id ON menohub_resource_purchases(user_id);
CREATE INDEX idx_resource_purchases_status ON menohub_resource_purchases(status);
CREATE INDEX idx_resource_purchases_download_token ON menohub_resource_purchases(download_token);
CREATE INDEX idx_resource_purchases_yookassa_payment_id ON menohub_resource_purchases(yookassa_payment_id);

-- RLS Policies
ALTER TABLE menohub_resource_purchases ENABLE ROW LEVEL SECURITY;

-- Service role –º–æ–∂–µ—Ç –¥–µ–ª–∞—Ç—å –≤—Å–µ
CREATE POLICY "Service role can manage purchases"
    ON menohub_resource_purchases
    FOR ALL
    USING (true)
    WITH CHECK (true);
```

---

## üîÑ API Routes

### 1. `POST /api/resources/[slug]/purchase`
–°–æ–∑–¥–∞–µ—Ç –∑–∞–∫–∞–∑ –∏ —Ä–µ–¥–∏—Ä–µ–∫—Ç–∏—Ç –Ω–∞ –Æ–ö–∞—Å—Å–∞

**Request:**
```json
{
  "email": "user@example.com",
  "name": "–ò–≤–∞–Ω –ò–≤–∞–Ω–æ–≤",
  "agreeToOffer": true
}
```

**Response:**
```json
{
  "orderId": "uuid",
  "paymentUrl": "https://yookassa.ru/checkout/...",
  "redirect": true
}
```

### 2. `POST /api/webhooks/yookassa`
Webhook –æ—Ç –Æ–ö–∞—Å—Å–∞ –¥–ª—è –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è —Å—Ç–∞—Ç—É—Å–∞ –ø–ª–∞—Ç–µ–∂–∞

**Request:** (–æ—Ç –Æ–ö–∞—Å—Å–∞)
```json
{
  "event": "payment.succeeded",
  "object": {
    "id": "payment_id",
    "status": "succeeded",
    "amount": { "value": "399.00" },
    "metadata": { "order_id": "uuid" }
  }
}
```

**Response:**
- –û–±–Ω–æ–≤–ª—è–µ—Ç —Å—Ç–∞—Ç—É—Å –∑–∞–∫–∞–∑–∞ –≤ –ë–î
- –ì–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç download_token
- –û—Ç–ø—Ä–∞–≤–ª—è–µ—Ç email —Å —Å—Å—ã–ª–∫–æ–π

### 3. `GET /api/resources/download/[token]`
–°–∫–∞—á–∏–≤–∞–Ω–∏–µ EPUB –ø–æ —Ç–æ–∫–µ–Ω—É

**Request:**
```
GET /api/resources/download/abc123-def456-ghi789
```

**Response:**
- –ü—Ä–æ–≤–µ—Ä—è–µ—Ç —Ç–æ–∫–µ–Ω –≤ –ë–î
- –ü—Ä–æ–≤–µ—Ä—è–µ—Ç —Å—Ä–æ–∫ –¥–µ–π—Å—Ç–≤–∏—è (30 –¥–Ω–µ–π)
- –ü—Ä–æ–≤–µ—Ä—è–µ—Ç –ª–∏–º–∏—Ç —Å–∫–∞—á–∏–≤–∞–Ω–∏–π (3 —Ä–∞–∑–∞)
- –ì–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç –ø–µ—Ä—Å–æ–Ω–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã–π EPUB —Å watermark
- –£–≤–µ–ª–∏—á–∏–≤–∞–µ—Ç download_count
- –û—Ç–¥–∞–µ—Ç EPUB —Ñ–∞–π–ª

---

## üìß Email —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è

### –ü–æ—Å–ª–µ —É—Å–ø–µ—à–Ω–æ–π –æ–ø–ª–∞—Ç—ã:

**–¢–µ–º–∞:** "–í–∞—à –≥–∞–π–¥ –≥–æ—Ç–æ–≤ –∫ —Å–∫–∞—á–∏–≤–∞–Ω–∏—é"

**–°–æ–¥–µ—Ä–∂–∞–Ω–∏–µ:**
```
–ó–¥—Ä–∞–≤—Å—Ç–≤—É–π—Ç–µ, [–ò–º—è]!

–°–ø–∞—Å–∏–±–æ –∑–∞ –ø–æ–∫—É–ø–∫—É –≥–∞–π–¥–∞ "–ü—Ä–æ—Ç–∏–≤–æ–≤–æ—Å–ø–∞–ª–∏—Ç–µ–ª—å–Ω–æ–µ –ø–∏—Ç–∞–Ω–∏–µ".

–í–∞—à–∞ —Å—Å—ã–ª–∫–∞ –¥–ª—è —Å–∫–∞—á–∏–≤–∞–Ω–∏—è:
[–ö–Ω–æ–ø–∫–∞: –°–∫–∞—á–∞—Ç—å –≥–∞–π–¥] ‚Üí /download/guide/[token]

–°—Å—ã–ª–∫–∞ –¥–µ–π—Å—Ç–≤–∏—Ç–µ–ª—å–Ω–∞ 30 –¥–Ω–µ–π.
–í—ã –º–æ–∂–µ—Ç–µ —Å–∫–∞—á–∞—Ç—å –≥–∞–π–¥ –¥–æ 3 —Ä–∞–∑.

–ï—Å–ª–∏ —É –≤–∞—Å –≤–æ–∑–Ω–∏–∫–ª–∏ –≤–æ–ø—Ä–æ—Å—ã, –Ω–∞–ø–∏—à–∏—Ç–µ –Ω–∞–º –Ω–∞ support@bezpauzy.com

–° —É–≤–∞–∂–µ–Ω–∏–µ–º,
–ö–æ–º–∞–Ω–¥–∞ –ë–µ–∑ |–ü–∞—É–∑—ã
```

---

## üé® UI/UX –ö–æ–º–ø–æ–Ω–µ–Ω—Ç—ã

### 1. –ö–Ω–æ–ø–∫–∞ "–ö—É–ø–∏—Ç—å" –≤–º–µ—Å—Ç–æ "–°–∫–∞—á–∞—Ç—å"

```tsx
// –í GuidesPageClient.tsx
{resource.isPaid ? (
  <BuyResourceButton resource={resource} />
) : (
  <DownloadResourceButton resource={resource} />
)}
```

### 2. –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ –ø–æ–∫—É–ø–∫–∏

**–ö–æ–º–ø–æ–Ω–µ–Ω—Ç:** `PurchaseModal.tsx`

**–°–æ–¥–µ—Ä–∂–∞–Ω–∏–µ:**
- –ù–∞–∑–≤–∞–Ω–∏–µ –≥–∞–π–¥–∞
- –¶–µ–Ω–∞: 399‚ÇΩ
- –§–æ—Ä–º–∞:
  - Email (–æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ)
  - –ò–º—è (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)
  - –ß–µ–∫–±–æ–∫—Å: "–Ø —Å–æ–≥–ª–∞—Å–µ–Ω —Å –æ—Ñ–µ—Ä—Ç–æ–π" (–æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ)
  - –°—Å—ã–ª–∫–∞ –Ω–∞ –æ—Ñ–µ—Ä—Ç—É
- –ö–Ω–æ–ø–∫–∞ "–û–ø–ª–∞—Ç–∏—Ç—å"

### 3. –°—Ç—Ä–∞–Ω–∏—Ü–∞ —É—Å–ø–µ—à–Ω–æ–π –æ–ø–ª–∞—Ç—ã

**Route:** `/purchase/success?orderId=uuid`

**–°–æ–¥–µ—Ä–∂–∞–Ω–∏–µ:**
- ‚úÖ "–°–ø–∞—Å–∏–±–æ –∑–∞ –ø–æ–∫—É–ø–∫—É!"
- –ù–∞–∑–≤–∞–Ω–∏–µ –≥–∞–π–¥–∞
- –ö–Ω–æ–ø–∫–∞ "–°–∫–∞—á–∞—Ç—å –≥–∞–π–¥" (—Å —Ç–æ–∫–µ–Ω–æ–º)
- –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ –ª–∏–º–∏—Ç–µ —Å–∫–∞—á–∏–≤–∞–Ω–∏–π (3 —Ä–∞–∑–∞, 30 –¥–Ω–µ–π)

### 4. –°—Ç—Ä–∞–Ω–∏—Ü–∞ —Å–∫–∞—á–∏–≤–∞–Ω–∏—è

**Route:** `/download/guide/[token]`

**–°–æ–¥–µ—Ä–∂–∞–Ω–∏–µ:**
- –ï—Å–ª–∏ —Ç–æ–∫–µ–Ω –≤–∞–ª–∏–¥–Ω—ã–π:
  - –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ —Å–∫–∞—á–∏–≤–∞–Ω–∏–µ EPUB
  - –ò–ª–∏ –∫–Ω–æ–ø–∫–∞ "–°–∫–∞—á–∞—Ç—å"
- –ï—Å–ª–∏ —Ç–æ–∫–µ–Ω –Ω–µ–≤–∞–ª–∏–¥–Ω—ã–π:
  - –û—à–∏–±–∫–∞: "–°—Å—ã–ª–∫–∞ –Ω–µ–¥–µ–π—Å—Ç–≤–∏—Ç–µ–ª—å–Ω–∞"
  - –ö–Ω–æ–ø–∫–∞ "–°–≤—è–∑–∞—Ç—å—Å—è —Å –ø–æ–¥–¥–µ—Ä–∂–∫–æ–π"

---

## üöÄ –ü–ª–∞–Ω —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏

### –≠—Ç–∞–ø 1: –ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö
- [ ] –†–∞—Å—à–∏—Ä–∏—Ç—å —Ç–∞–±–ª–∏—Ü—É `menohub_resources` (is_paid, price_kopecks, epub_file_path)
- [ ] –°–æ–∑–¥–∞—Ç—å —Ç–∞–±–ª–∏—Ü—É `menohub_resource_purchases`
- [ ] –°–æ–∑–¥–∞—Ç—å RLS policies

### –≠—Ç–∞–ø 2: –û—Ñ–µ—Ä—Ç–∞
- [ ] –°–æ–∑–¥–∞—Ç—å —Å—Ç—Ä–∞–Ω–∏—Ü—É `/legal/offer`
- [ ] –î–æ–±–∞–≤–∏—Ç—å –∫–æ–Ω—Ç–µ–Ω—Ç –æ—Ñ–µ—Ä—Ç—ã (–∏–∑ `docs/OFFER_TEMPLATE.md`)

### –≠—Ç–∞–ø 3: UI –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã
- [ ] –ö–æ–º–ø–æ–Ω–µ–Ω—Ç `BuyResourceButton`
- [ ] –ö–æ–º–ø–æ–Ω–µ–Ω—Ç `PurchaseModal`
- [ ] –°—Ç—Ä–∞–Ω–∏—Ü–∞ —É—Å–ø–µ—à–Ω–æ–π –æ–ø–ª–∞—Ç—ã
- [ ] –°—Ç—Ä–∞–Ω–∏—Ü–∞ —Å–∫–∞—á–∏–≤–∞–Ω–∏—è

### –≠—Ç–∞–ø 4: API Routes
- [ ] `POST /api/resources/[slug]/purchase`
- [ ] `POST /api/webhooks/yookassa`
- [ ] `GET /api/resources/download/[token]`

### –≠—Ç–∞–ø 5: –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å –Æ–ö–∞—Å—Å–∞
- [ ] –ù–∞—Å—Ç—Ä–æ–∏—Ç—å —Å–æ–∑–¥–∞–Ω–∏–µ –ø–ª–∞—Ç–µ–∂–∞
- [ ] –ù–∞—Å—Ç—Ä–æ–∏—Ç—å webhook –æ–±—Ä–∞–±–æ—Ç–∫—É
- [ ] –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –ø–ª–∞—Ç–µ–∂–µ–π

### –≠—Ç–∞–ø 6: Email —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è
- [ ] –®–∞–±–ª–æ–Ω email –ø–æ—Å–ª–µ –æ–ø–ª–∞—Ç—ã
- [ ] –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å Resend/SendGrid

### –≠—Ç–∞–ø 7: Watermarking EPUB
- [ ] –ë–∏–±–ª–∏–æ—Ç–µ–∫–∞ –¥–ª—è —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è EPUB
- [ ] –§—É–Ω–∫—Ü–∏—è –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ –ø–µ—Ä—Å–æ–Ω–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω–æ–≥–æ EPUB
- [ ] –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –º–µ—Ç–∞–¥–∞–Ω–Ω—ã—Ö (purchase_id, email hash, –¥–∞—Ç–∞)

### –≠—Ç–∞–ø 8: –ó–∞–≥—Ä—É–∑–∫–∞ EPUB
- [ ] –ó–∞–≥—Ä—É–∑–∏—Ç—å –±–∞–∑–æ–≤—ã–π EPUB —Ñ–∞–π–ª –≤ Supabase Storage
- [ ] –ù–∞—Å—Ç—Ä–æ–∏—Ç—å –∑–∞—â–∏—Ç—É –¥–æ—Å—Ç—É–ø–∞

### –≠—Ç–∞–ø 9: –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ
- [ ] –¢–µ—Å—Ç–æ–≤—ã–µ –ø–ª–∞—Ç–µ–∂–∏
- [ ] –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å–∫–∞—á–∏–≤–∞–Ω–∏—è
- [ ] –ü—Ä–æ–≤–µ—Ä–∫–∞ –ª–∏–º–∏—Ç–æ–≤
- [ ] –ü—Ä–æ–≤–µ—Ä–∫–∞ watermarking

---

## üìù –ü—Ä–∏–º–µ—á–∞–Ω–∏—è

- –ò—Å–ø–æ–ª—å–∑—É–µ–º —Å—É—â–µ—Å—Ç–≤—É—é—â—É—é –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—é —Å –Æ–ö–∞—Å—Å–∞ (–∫–∞–∫ –¥–ª—è –∫–Ω–∏–≥)
- –ú–æ–∂–Ω–æ –ø–µ—Ä–µ–∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –ª–æ–≥–∏–∫—É –∏–∑ `menohub_book_orders`
- EPUB —Ñ–∞–π–ª –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å –≥–æ—Ç–æ–≤ –ø–µ—Ä–µ–¥ –∑–∞–ø—É—Å–∫–æ–º
- –û—Ñ–µ—Ä—Ç–∞ –¥–æ–ª–∂–Ω–∞ –±—ã—Ç—å –ø—Ä–æ–≤–µ—Ä–µ–Ω–∞ —é—Ä–∏—Å—Ç–æ–º
- Watermarking: —Å–º. –ø–æ–¥—Ä–æ–±–Ω–æ—Å—Ç–∏ –≤ `docs/EPUB_WATERMARKING.md`
- –û—Ñ–µ—Ä—Ç–∞: —Å–º. —à–∞–±–ª–æ–Ω –≤ `docs/OFFER_TEMPLATE.md`

