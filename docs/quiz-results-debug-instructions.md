# Инструкции по диагностике проблемы с результатами квизов

## Способ 1: Использовать диагностический API endpoint

Я создал временный endpoint для диагностики. Выполните следующие шаги:

### Шаг 1: Откройте браузер и перейдите по адресу:
```
http://localhost:3000/api/debug/quiz-results
```
(или замените на ваш домен, если проект развернут)

### Шаг 2: Посмотрите ответ
Endpoint вернет JSON с информацией:
- Информация о сессии (есть ли сессия, какой userId)
- Информация о пользователе (найден ли в базе)
- Все результаты квизов для этого пользователя
- Статистика по базе данных
- Рекомендации по решению проблемы

### Шаг 3: Скопируйте ответ и отправьте мне
Это поможет понять, в чем проблема.

## Способ 2: Упрощенные SQL запросы

Если у вас есть доступ к Supabase Dashboard, выполните запросы по одному:

### Запрос 1: Проверить структуру таблиц
```sql
SELECT column_name, data_type 
FROM information_schema.columns 
WHERE table_name = 'menohub_quiz_results'
ORDER BY ordinal_position;
```

### Запрос 2: Посмотреть все результаты (первые 5)
```sql
SELECT id, user_id, email, test_type, total_score, created_at
FROM menohub_quiz_results
ORDER BY created_at DESC
LIMIT 5;
```

### Запрос 3: Найти вашего пользователя
```sql
SELECT id, username, telegram_id, created_at
FROM menohub_users
WHERE username = 'helgasoul' OR telegram_id = 374683580;
```

### Запрос 4: Найти результаты для вашего пользователя
(Сначала выполните запрос 3, чтобы узнать ваш id, затем замените YOUR_USER_ID)

```sql
SELECT *
FROM menohub_quiz_results
WHERE user_id = YOUR_USER_ID
ORDER BY created_at DESC;
```

## Способ 3: Проверка через Table Editor в Supabase

1. Откройте Supabase Dashboard
2. Перейдите в **Table Editor**
3. Выберите таблицу `menohub_quiz_results`
4. Посмотрите:
   - Какие колонки есть
   - Какие типы данных у колонок
   - Есть ли данные в таблице
   - Какие значения в колонке `user_id`

5. Выберите таблицу `menohub_users`
6. Найдите вашу запись по `username` или `telegram_id`
7. Запомните ваш `id`

8. Вернитесь к `menohub_quiz_results`
9. Отфильтруйте по вашему `user_id` (если знаете)
10. Посмотрите, есть ли результаты

## Что делать дальше

После получения информации:

1. **Если userId не определен:**
   - Проблема с сессией
   - Нужно проверить, как сохраняется сессия

2. **Если userId определен, но пользователь не найден:**
   - Проблема с поиском пользователя
   - Возможно, неправильный тип данных

3. **Если пользователь найден, но результатов нет:**
   - Результаты сохранены с другим user_id
   - Результаты сохранены с NULL user_id
   - Нужно найти результаты и связать их с пользователем

4. **Если результаты найдены:**
   - Проблема в коде отображения
   - Нужно проверить компоненты личного кабинета

## Если ничего не помогает

Отправьте мне:
1. Ответ от `/api/debug/quiz-results`
2. Скриншоты из Supabase Table Editor
3. Логи из консоли браузера (F12 → Console)
4. Логи из Network tab (F12 → Network → найдите запросы к `/api/quiz/get-results`)

