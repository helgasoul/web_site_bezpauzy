# –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ –¥–≤—É—Ö –∞–≥–µ–Ω—Ç–æ–≤

## üìä –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –∞–≥–µ–Ω—Ç–æ–≤ (–∫–∞–∫ –≤ n8n)

–í n8n workflow –±—ã–ª–æ **–î–í–ê –∞–≥–µ–Ω—Ç–∞**, –∏ —Ç–µ–ø–µ—Ä—å –æ–±–∞ —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω—ã:

### 1. –û—Å–Ω–æ–≤–Ω–æ–π –∞–≥–µ–Ω—Ç (AI Agent) - –¥–ª—è –æ—Ç–≤–µ—Ç–æ–≤ –Ω–∞ –≤–æ–ø—Ä–æ—Å—ã

**–§–∞–π–ª:** `lib/ai/main-agent.ts`

**–ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ:** –û—Ç–≤–µ—á–∞–µ—Ç –Ω–∞ –º–µ–¥–∏—Ü–∏–Ω—Å–∫–∏–µ –≤–æ–ø—Ä–æ—Å—ã –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è

**–ò–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç—ã:**
- `Vector_store` - –ø–æ–∏—Å–∫ –≤ –≤–µ–∫—Ç–æ—Ä–Ω–æ–π –±–∞–∑–µ –∑–Ω–∞–Ω–∏–π (`menohub_documents`)
- `Get_user_age` - –ø–æ–ª—É—á–µ–Ω–∏–µ –≤–æ–∑—Ä–∞—Å—Ç–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –¥–ª—è –ø–µ—Ä—Å–æ–Ω–∞–ª–∏–∑–∞—Ü–∏–∏
- `Update_city` - –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ –≥–æ—Ä–æ–¥–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è

**–ö–æ–≥–¥–∞ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è:**
- –û–±—ã—á–Ω—ã–µ –≤–æ–ø—Ä–æ—Å—ã –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
- –ú–µ–¥–∏—Ü–∏–Ω—Å–∫–∏–µ –≤–æ–ø—Ä–æ—Å—ã
- –í–æ–ø—Ä–æ—Å—ã –æ —Å–∏–º–ø—Ç–æ–º–∞—Ö, –ª–µ—á–µ–Ω–∏–∏, –∑–¥–æ—Ä–æ–≤—å–µ

**–û—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏:**
- –ò—Å–ø–æ–ª—å–∑—É–µ—Ç –≤–µ–∫—Ç–æ—Ä–Ω—ã–π –ø–æ–∏—Å–∫ –≤ –±–∞–∑–µ –∑–Ω–∞–Ω–∏–π
- –ü–µ—Ä—Å–æ–Ω–∞–ª–∏–∑–∏—Ä—É–µ—Ç –æ—Ç–≤–µ—Ç—ã –ø–æ –≤–æ–∑—Ä–∞—Å—Ç—É (40-45, 46-50, 51+)
- –§–æ—Ä–º–∏—Ä—É–µ—Ç —Å—Ç—Ä—É–∫—Ç—É—Ä–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –æ—Ç–≤–µ—Ç—ã —Å —Ä–∞–∑–¥–µ–ª–∞–º–∏
- –°—Ç—Ä–æ–≥–∏–π —Ñ–æ—Ä–º–∞—Ç –æ—Ç–≤–µ—Ç–∞ (–∫–∞–∫ –≤ n8n)

### 2. –ê–≥–µ–Ω—Ç –¥–ª—è –ø–æ–∏—Å–∫–∞ –≤—Ä–∞—á–µ–π (AI Agent1) - –¥–ª—è –ø–æ–∏—Å–∫–∞ –≤—Ä–∞—á–µ–π

**–§–∞–π–ª:** `lib/ai/agent.ts`

**–ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ:** –ü–æ–∏—Å–∫ –≤—Ä–∞—á–µ–π –ø–æ —Å–ø–µ—Ü–∏–∞–ª—å–Ω–æ—Å—Ç–∏ –∏ –≥–æ—Ä–æ–¥—É

**–ò–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç—ã:**
- `search_doctors` - –ø–æ–∏—Å–∫ –≤—Ä–∞—á–µ–π –≤ —Ç–∞–±–ª–∏—Ü–µ `menohub_doctors`

**–ö–æ–≥–¥–∞ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è:**
- –ó–∞–ø—Ä–æ—Å—ã —Ç–∏–ø–∞ "–Ω–∞–π–¥–∏ –≤—Ä–∞—á–∞", "–Ω—É–∂–µ–Ω —Å–ø–µ—Ü–∏–∞–ª–∏—Å—Ç"
- –ü–æ–∏—Å–∫ –∫–ª–∏–Ω–∏–∫
- –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏ –≤—Ä–∞—á–µ–π

**–û—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏:**
- –¢–æ–ª—å–∫–æ –ø–æ–∏—Å–∫ –≤ –±–∞–∑–µ –¥–∞–Ω–Ω—ã—Ö
- –§–∏–ª—å—Ç—Ä–∞—Ü–∏—è –ø–æ —Å–ø–µ—Ü–∏–∞–ª—å–Ω–æ—Å—Ç–∏ –∏ –≥–æ—Ä–æ–¥—É
- –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç —Å–ø–∏—Å–æ–∫ —Å –∫–æ–Ω—Ç–∞–∫—Ç–∞–º–∏

## üîÑ –õ–æ–≥–∏–∫–∞ –≤—ã–±–æ—Ä–∞ –∞–≥–µ–Ω—Ç–∞

**–§–∞–π–ª:** `lib/ai/message-processor.ts`

```typescript
// –ü—Ä–æ–≤–µ—Ä—è–µ–º, –Ω—É–∂–µ–Ω –ª–∏ –ø–æ–∏—Å–∫ –≤—Ä–∞—á–µ–π
if (isDoctorSearch) {
  // –ò—Å–ø–æ–ª—å–∑—É–µ–º –∞–≥–µ–Ω—Ç–∞ –¥–ª—è –ø–æ–∏—Å–∫–∞ –≤—Ä–∞—á–µ–π
  return runAgent(...)
}

// –ò–Ω–∞—á–µ –∏—Å–ø–æ–ª—å–∑—É–µ–º –æ—Å–Ω–æ–≤–Ω–æ–π –∞–≥–µ–Ω—Ç –¥–ª—è –æ—Ç–≤–µ—Ç–æ–≤
return runMainAgent(...)
```

## üìù –û—Ç–ª–∏—á–∏—è –æ—Ç n8n

### –í n8n –±—ã–ª–æ:
- **AI Agent**: Vector_store + Research (Perplexity) + Get_user_age + Update_city
- **AI Agent1**: search_doctors + research

### –°–µ–π—á–∞—Å:
- **–û—Å–Ω–æ–≤–Ω–æ–π –∞–≥–µ–Ω—Ç**: Vector_store + Get_user_age + Update_city (–±–µ–∑ Research)
- **–ê–≥–µ–Ω—Ç –≤—Ä–∞—á–µ–π**: search_doctors (–±–µ–∑ research)

**–ò–∑–º–µ–Ω–µ–Ω–∏—è:**
- –£–±—Ä–∞–Ω Research (Perplexity) - –≤—Å–µ –¥–∞–Ω–Ω—ã–µ —Ç–æ–ª—å–∫–æ –∏–∑ –ë–î
- –û—Å–Ω–æ–≤–Ω–æ–π –∞–≥–µ–Ω—Ç –∏—Å–ø–æ–ª—å–∑—É–µ—Ç –≤–µ–∫—Ç–æ—Ä–Ω—ã–π –ø–æ–∏—Å–∫ –≤–º–µ—Å—Ç–æ –æ–±—ã—á–Ω–æ–≥–æ RAG
- –û–±–∞ –∞–≥–µ–Ω—Ç–∞ —Ä–∞–±–æ—Ç–∞—é—Ç —Ç–æ–ª—å–∫–æ —Å –±–∞–∑–æ–π –¥–∞–Ω–Ω—ã—Ö

## üéØ –ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞

1. **–†–∞–∑–¥–µ–ª–µ–Ω–∏–µ –æ—Ç–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω–æ—Å—Ç–∏** - –∫–∞–∂–¥—ã–π –∞–≥–µ–Ω—Ç —Ä–µ—à–∞–µ—Ç —Å–≤–æ—é –∑–∞–¥–∞—á—É
2. **–°–ø–µ—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è** - –∞–≥–µ–Ω—Ç—ã –æ–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞–Ω—ã –ø–æ–¥ —Å–≤–æ–∏ –∑–∞–¥–∞—á–∏
3. **–ù–∞–¥–µ–∂–Ω–æ—Å—Ç—å** - –≤—Å–µ –¥–∞–Ω–Ω—ã–µ –∏–∑ –ø—Ä–æ–≤–µ—Ä–µ–Ω–Ω–æ–π –ë–î
4. **–ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å** - –±—ã—Å—Ç—Ä–µ–µ –±–µ–∑ –∏–Ω—Ç–µ—Ä–Ω–µ—Ç-–ø–æ–∏—Å–∫–∞

## üìã –¢–∞–±–ª–∏—Ü—ã –≤ Supabase

### –î–ª—è –æ—Å–Ω–æ–≤–Ω–æ–≥–æ –∞–≥–µ–Ω—Ç–∞:
- `menohub_documents` - –≤–µ–∫—Ç–æ—Ä–Ω–∞—è –±–∞–∑–∞ –∑–Ω–∞–Ω–∏–π (—Å embeddings)
- `menohub_users` - –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ (–≤–æ–∑—Ä–∞—Å—Ç, –≥–æ—Ä–æ–¥)

### –î–ª—è –∞–≥–µ–Ω—Ç–∞ –≤—Ä–∞—á–µ–π:
- `menohub_doctors` - –≤—Ä–∞—á–∏ (—Å–ø–µ—Ü–∏–∞–ª—å–Ω–æ—Å—Ç—å, –≥–æ—Ä–æ–¥, –∫–æ–Ω—Ç–∞–∫—Ç—ã)

## ‚úÖ –ß—Ç–æ —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω–æ

- ‚úÖ –û—Å–Ω–æ–≤–Ω–æ–π –∞–≥–µ–Ω—Ç —Å –≤–µ–∫—Ç–æ—Ä–Ω—ã–º –ø–æ–∏—Å–∫–æ–º
- ‚úÖ –ê–≥–µ–Ω—Ç –¥–ª—è –ø–æ–∏—Å–∫–∞ –≤—Ä–∞—á–µ–π
- ‚úÖ –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π –≤—ã–±–æ—Ä –∞–≥–µ–Ω—Ç–∞
- ‚úÖ –ò–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç—ã –¥–ª—è –æ–±–æ–∏—Ö –∞–≥–µ–Ω—Ç–æ–≤
- ‚úÖ –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è –≤ message-processor

## ‚ö†Ô∏è –í–∞–∂–Ω–æ

1. **–í–µ–∫—Ç–æ—Ä–Ω–∞—è –±–∞–∑–∞ –∑–Ω–∞–Ω–∏–π** (`menohub_documents`) –¥–æ–ª–∂–Ω–∞ –±—ã—Ç—å –Ω–∞—Å—Ç—Ä–æ–µ–Ω–∞ —Å embeddings
2. **Get_user_age** —Ç—Ä–µ–±—É–µ—Ç `telegram_id` –∏–ª–∏ `age` –≤ —Ç–∞–±–ª–∏—Ü–µ `menohub_users`
3. –û–±–∞ –∞–≥–µ–Ω—Ç–∞ –∏—Å–ø–æ–ª—å–∑—É—é—Ç OpenAI (–Ω—É–∂–µ–Ω `OPENAI_API_KEY`)
