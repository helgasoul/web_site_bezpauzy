# –ü–æ–ª–Ω–æ–µ —Ä—É–∫–æ–≤–æ–¥—Å—Ç–≤–æ –ø–æ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—é –ø—Ä–æ–±–ª–µ–º—ã —Å —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞–º–∏ –∫–≤–∏–∑–æ–≤

## üîç –ü—Ä–æ–±–ª–µ–º—ã –æ–±–Ω–∞—Ä—É–∂–µ–Ω—ã

1. ‚úÖ **–ù–µ—Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏–µ —Ç–∏–ø–æ–≤**: `user_id` –±—ã–ª `integer`, –∞ –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å `bigint` 
   - **–†–µ—à–µ–Ω–∏–µ**: –ú–∏–≥—Ä–∞—Ü–∏—è `014_fix_quiz_results_user_id_bigint.sql`

2. ‚úÖ **NULL user_id**: –†–µ–∑—É–ª—å—Ç–∞—Ç—ã —Å–æ—Ö—Ä–∞–Ω–µ–Ω—ã —Å `user_id = NULL`
   - **–†–µ—à–µ–Ω–∏–µ**: –û–±–Ω–æ–≤–∏—Ç—å –∑–∞–ø–∏—Å–∏ –≤—Ä—É—á–Ω—É—é (—Å–º. –Ω–∏–∂–µ)

## üìã –ü–æ—à–∞–≥–æ–≤—ã–π –ø–ª–∞–Ω –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è

### –®–∞–≥ 1: –ü—Ä–∏–º–µ–Ω–∏—Ç—å –º–∏–≥—Ä–∞—Ü–∏—é –¥–ª—è –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è —Ç–∏–ø–∞ (–µ—Å–ª–∏ –µ—â–µ –Ω–µ –ø—Ä–∏–º–µ–Ω–µ–Ω–∞)

1. –û—Ç–∫—Ä–æ–π—Ç–µ `supabase/migrations/014_fix_quiz_results_user_id_bigint.sql`
2. –°–∫–æ–ø–∏—Ä—É–π—Ç–µ SQL –∫–æ–¥
3. –í—ã–ø–æ–ª–Ω–∏—Ç–µ –≤ Supabase SQL Editor

### –®–∞–≥ 2: –ù–∞–π—Ç–∏ –≤–∞—à user_id

–í—ã–ø–æ–ª–Ω–∏—Ç–µ —ç—Ç–æ—Ç –∑–∞–ø—Ä–æ—Å:

```sql
SELECT id, username, telegram_id, email, created_at
FROM menohub_users
WHERE username = 'helgasoul'  -- –∏–ª–∏ –≤–∞—à telegram_id = 374683580
   OR email = 'o.s.puchkova@icloud.com'
ORDER BY created_at DESC;
```

**–ó–∞–ø–æ–º–Ω–∏—Ç–µ –∑–Ω–∞—á–µ–Ω–∏–µ `id`** (–Ω–∞–ø—Ä–∏–º–µ—Ä, `108`)

### –®–∞–≥ 3: –û–±–Ω–æ–≤–∏—Ç—å —Ä–µ–∑—É–ª—å—Ç–∞—Ç –∫–≤–∏–∑–∞

–ü–æ—Å–ª–µ —Ç–æ–≥–æ, –∫–∞–∫ —É–∑–Ω–∞–µ—Ç–µ –≤–∞—à `user_id`, –≤—ã–ø–æ–ª–Ω–∏—Ç–µ:

```sql
-- –í–ê–ñ–ù–û: –ó–∞–º–µ–Ω–∏—Ç–µ 108 –Ω–∞ –≤–∞—à —Ä–µ–∞–ª—å–Ω—ã–π user_id –∏–∑ —à–∞–≥–∞ 2

UPDATE menohub_quiz_results
SET user_id = 108  -- –≤–∞—à user_id
WHERE id = 'd6c2df50-1f99-44d3-abc1-fcb78aa1fd52'  -- ID —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞
  AND user_id IS NULL;
```

### –®–∞–≥ 4: –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Ä–µ–∑—É–ª—å—Ç–∞—Ç

```sql
SELECT 
    qr.id,
    qr.user_id,
    qr.test_type,
    qr.total_score,
    qr.severity,
    u.username,
    CASE 
        WHEN qr.user_id = u.id THEN 'MATCH ‚úÖ'
        ELSE 'MISMATCH ‚ùå'
    END as link_status
FROM menohub_quiz_results qr
LEFT JOIN menohub_users u ON qr.user_id = u.id
WHERE qr.id = 'd6c2df50-1f99-44d3-abc1-fcb78aa1fd52';
```

**–û–∂–∏–¥–∞–µ–º—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç:**
- `user_id` = –≤–∞—à ID (–Ω–∞–ø—Ä–∏–º–µ—Ä, `108`)
- `username` = –≤–∞—à username
- `link_status` = `MATCH ‚úÖ`

### –®–∞–≥ 5: –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –≤ –ª–∏—á–Ω–æ–º –∫–∞–±–∏–Ω–µ—Ç–µ

1. –û–±–Ω–æ–≤–∏—Ç–µ —Å—Ç—Ä–∞–Ω–∏—Ü—É –ª–∏—á–Ω–æ–≥–æ –∫–∞–±–∏–Ω–µ—Ç–∞ (Ctrl+F5)
2. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ, –æ—Ç–æ–±—Ä–∞–∂–∞–µ—Ç—Å—è –ª–∏ —Ä–µ–∑—É–ª—å—Ç–∞—Ç –∫–≤–∏–∑–∞ MRS
3. –ï—Å–ª–∏ –Ω–µ—Ç, –ø—Ä–æ–≤–µ—Ä—å—Ç–µ –∫–æ–Ω—Å–æ–ª—å –±—Ä–∞—É–∑–µ—Ä–∞ (F12)

## üîÑ –ï—Å–ª–∏ –µ—Å—Ç—å –Ω–µ—Å–∫–æ–ª—å–∫–æ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤ —Å NULL user_id

–ï—Å–ª–∏ —É –≤–∞—Å –Ω–µ—Å–∫–æ–ª—å–∫–æ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤ —Å `user_id = NULL`, –æ–±–Ω–æ–≤–∏—Ç–µ –∏—Ö –≤—Å–µ —Å—Ä–∞–∑—É:

```sql
-- –û–±–Ω–æ–≤–∏—Ç—å –≤—Å–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã —Å NULL user_id –ø–æ email
UPDATE menohub_quiz_results
SET user_id = 108  -- –≤–∞—à user_id
WHERE user_id IS NULL
  AND email = 'o.s.puchkova@icloud.com';
```

## ‚úÖ –ü–æ—Å–ª–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è

–ü–æ—Å–ª–µ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è –≤—Å–µ—Ö —à–∞–≥–æ–≤:
- ‚úÖ –¢–∏–ø—ã –¥–∞–Ω–Ω—ã—Ö –±—É–¥—É—Ç —Å–æ–≤–ø–∞–¥–∞—Ç—å (bigint)
- ‚úÖ –†–µ–∑—É–ª—å—Ç–∞—Ç—ã –±—É–¥—É—Ç —Å–≤—è–∑–∞–Ω—ã —Å –≤–∞—à–∏–º –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–º
- ‚úÖ –†–µ–∑—É–ª—å—Ç–∞—Ç—ã –ø–æ—è–≤—è—Ç—Å—è –≤ –ª–∏—á–Ω–æ–º –∫–∞–±–∏–Ω–µ—Ç–µ
- ‚úÖ –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –≤ –¥–∞—à–±–æ—Ä–¥–µ –±—É–¥–µ—Ç –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ–π

## üìù –ü—Ä–∏–º–µ—á–∞–Ω–∏—è

- –í—Å–µ SQL –∑–∞–ø—Ä–æ—Å—ã —Å–æ—Ö—Ä–∞–Ω–µ–Ω—ã –≤ `docs/quiz-results-update-null-user-id.sql`
- –ë—É–¥—å—Ç–µ –æ—Å—Ç–æ—Ä–æ–∂–Ω—ã –ø—Ä–∏ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–∏ UPDATE - –ø—Ä–æ–≤–µ—Ä—è–π—Ç–µ WHERE —É—Å–ª–æ–≤–∏—è
- –†–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è —Å–Ω–∞—á–∞–ª–∞ –≤—ã–ø–æ–ª–Ω–∏—Ç—å SELECT, —á—Ç–æ–±—ã —É–≤–∏–¥–µ—Ç—å, —á—Ç–æ –±—É–¥–µ—Ç –æ–±–Ω–æ–≤–ª–µ–Ω–æ

