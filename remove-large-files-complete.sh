#!/bin/bash

# –ü–æ–ª–Ω–æ–µ —É–¥–∞–ª–µ–Ω–∏–µ –±–æ–ª—å—à–∏—Ö PDF –∏–∑ Git (—Ö—Ä–∞–Ω–∏—Ç—å —Ç–æ–ª—å–∫–æ –ª–æ–∫–∞–ª—å–Ω–æ)

set -e

echo "üóëÔ∏è  –£–î–ê–õ–ï–ù–ò–ï –ë–û–õ–¨–®–ò–• PDF –ò–ó GIT"
echo "================================"
echo ""

# 1. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ø–æ—Å–ª–µ–¥–Ω–∏–π –∫–æ–º–º–∏—Ç
echo "üìã –®–∞–≥ 1: –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø–æ—Å–ª–µ–¥–Ω–µ–≥–æ –∫–æ–º–º–∏—Ç–∞..."
LAST_COMMIT=$(git log -1 --oneline)
echo "   –ü–æ—Å–ª–µ–¥–Ω–∏–π –∫–æ–º–º–∏—Ç: $LAST_COMMIT"
echo ""

# 2. –û—Ç–º–µ–Ω–∏—Ç—å –ø–æ—Å–ª–µ–¥–Ω–∏–π –∫–æ–º–º–∏—Ç (–Ω–æ —Å–æ—Ö—Ä–∞–Ω–∏—Ç—å –∏–∑–º–µ–Ω–µ–Ω–∏—è)
echo "‚Ü©Ô∏è  –®–∞–≥ 2: –û—Ç–º–µ–Ω–∞ –ø–æ—Å–ª–µ–¥–Ω–µ–≥–æ –∫–æ–º–º–∏—Ç–∞ (—Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –∏–∑–º–µ–Ω–µ–Ω–∏–π)..."
git reset --soft HEAD~1
echo "‚úÖ –ö–æ–º–º–∏—Ç –æ—Ç–º–µ–Ω–µ–Ω, –∏–∑–º–µ–Ω–µ–Ω–∏—è —Å–æ—Ö—Ä–∞–Ω–µ–Ω—ã"
echo ""

# 3. –£–¥–∞–ª–∏—Ç—å –±–æ–ª—å—à–∏–µ PDF –∏–∑ –∏–Ω–¥–µ–∫—Å–∞
echo "üóëÔ∏è  –®–∞–≥ 3: –£–¥–∞–ª–µ–Ω–∏–µ –±–æ–ª—å—à–∏—Ö PDF –∏–∑ Git –∏–Ω–¥–µ–∫—Å–∞..."
git rm --cached -r "litrature/–ó–∞–≥—Ä—É–∂–µ–Ω–Ω—ã–µ –≤ –ë–µ–∑|–ø–∞—É–∑—ã/" 2>/dev/null || echo "   –§–∞–π–ª—ã –Ω–µ –Ω–∞–π–¥–µ–Ω—ã –≤ –∏–Ω–¥–µ–∫—Å–µ"
echo "‚úÖ –ë–æ–ª—å—à–∏–µ —Ñ–∞–π–ª—ã —É–¥–∞–ª–µ–Ω—ã –∏–∑ –∏–Ω–¥–µ–∫—Å–∞ (–æ—Å—Ç–∞–ª–∏—Å—å –ª–æ–∫–∞–ª—å–Ω–æ)"
echo ""

# 4. –£–±–µ–¥–∏—Ç—å—Å—è, —á—Ç–æ .gitignore –ø—Ä–∞–≤–∏–ª—å–Ω—ã–π
echo "üìù –®–∞–≥ 4: –ü—Ä–æ–≤–µ—Ä–∫–∞ .gitignore..."
if ! grep -q "litrature/\*\*/\*.pdf" .gitignore 2>/dev/null; then
    echo "   ‚ö†Ô∏è  –û–±–Ω–æ–≤–ª—è—é .gitignore..."
    echo "" >> .gitignore
    echo "# Large PDF files (too big for GitHub - keep local only)" >> .gitignore
    echo "litrature/**/*.pdf" >> .gitignore
    echo "*.pdf" >> .gitignore
    echo "!public/**/*.pdf" >> .gitignore
fi
echo "‚úÖ .gitignore –Ω–∞—Å—Ç—Ä–æ–µ–Ω"
echo ""

# 5. –î–æ–±–∞–≤–∏—Ç—å —Ç–æ–ª—å–∫–æ –Ω—É–∂–Ω—ã–µ —Ñ–∞–π–ª—ã (–±–µ–∑ –±–æ–ª—å—à–∏—Ö PDF)
echo "üíæ –®–∞–≥ 5: –ü–æ–¥–≥–æ—Ç–æ–≤–∫–∞ –∫–æ–º–º–∏—Ç–∞ (–±–µ–∑ –±–æ–ª—å—à–∏—Ö PDF)..."
git add .gitignore
git add GITHUB_CHECKLIST.md check-github-status.sh 2>/dev/null || true
git add public/gyenicologist.jpg 2>/dev/null || true
echo "‚úÖ –§–∞–π–ª—ã –ø–æ–¥–≥–æ—Ç–æ–≤–ª–µ–Ω—ã"
echo ""

# 6. –ü–æ–∫–∞–∑–∞—Ç—å, —á—Ç–æ –±—É–¥–µ—Ç –∑–∞–∫–æ–º–º–∏—á–µ–Ω–æ
echo "üìä –®–∞–≥ 6: –§–∞–π–ª—ã –¥–ª—è –∫–æ–º–º–∏—Ç–∞:"
git status --short
echo ""

# 7. –ü–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ
read -p "–°–æ–∑–¥–∞—Ç—å –∫–æ–º–º–∏—Ç –±–µ–∑ –±–æ–ª—å—à–∏—Ö PDF? (y/n): " -n 1 -r
echo ""
if [[ ! $REPLY =~ ^[Yy]$ ]]; then
    echo "‚ùå –û—Ç–º–µ–Ω–µ–Ω–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–º"
    echo "   –í–æ—Å—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –ø–æ—Å–ª–µ–¥–Ω–∏–π –∫–æ–º–º–∏—Ç: git reset --hard ORIG_HEAD"
    exit 1
fi

# 8. –ó–∞–∫–æ–º–º–∏—Ç–∏—Ç—å
echo "üìù –®–∞–≥ 7: –°–æ–∑–¥–∞–Ω–∏–µ –∫–æ–º–º–∏—Ç–∞..."
git commit -m "chore: Move files to correct locations and add GitHub checklist (exclude large PDFs)"
echo "‚úÖ –ö–æ–º–º–∏—Ç —Å–æ–∑–¥–∞–Ω"
echo ""

# 9. –ü–æ–ø—Ä–æ–±–æ–≤–∞—Ç—å –æ—Ç–ø—Ä–∞–≤–∏—Ç—å
echo "üì§ –®–∞–≥ 8: –û—Ç–ø—Ä–∞–≤–∫–∞ –Ω–∞ GitHub..."
if git push origin main; then
    echo ""
    echo "‚úÖ –£–°–ü–ï–®–ù–û! –ö–æ–¥ –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω –Ω–∞ GitHub"
    echo "   –ë–æ–ª—å—à–∏–µ PDF —Ñ–∞–π–ª—ã –æ—Å—Ç–∞–ª–∏—Å—å –ª–æ–∫–∞–ª—å–Ω–æ –∏ –Ω–µ –±—É–¥—É—Ç –Ω–∞ GitHub"
else
    echo ""
    echo "‚ö†Ô∏è  –û—à–∏–±–∫–∞ –ø—Ä–∏ –æ—Ç–ø—Ä–∞–≤–∫–µ. –í–æ–∑–º–æ–∂–Ω–æ, –Ω—É–∂–Ω–æ –æ—á–∏—Å—Ç–∏—Ç—å –∏—Å—Ç–æ—Ä–∏—é:"
    echo "   git filter-branch --force --index-filter \\"
    echo "     'git rm --cached --ignore-unmatch \"litrature/–ó–∞–≥—Ä—É–∂–µ–Ω–Ω—ã–µ –≤ –ë–µ–∑|–ø–∞—É–∑—ã/*.pdf\"' \\"
    echo "     --prune-empty --tag-name-filter cat -- --all"
fi

echo ""
echo "‚úÖ –ì–æ—Ç–æ–≤–æ!"


